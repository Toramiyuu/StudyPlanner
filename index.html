<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IGCSE 2026 Study Planner</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=DM+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #080810;
  --surface: #0f0f1a;
  --surface2: #1a1a26;
  --surface3: #22222f;
  --border: #1e1e30;
  --text: #e8e8f0;
  --text2: #9999aa;
  --text3: #666678;
  --accent: #f0c040;
  --accent2: #e8a020;
  --green: #40d080;
  --red: #f06060;
  --blue: #60a0f0;
  --purple: #a070f0;
  --orange: #f08040;
  --pink: #f060a0;
  --cyan: #40d0d0;
  --teal: #40c0a0;
  --sidebar-bg: #0a0a16;
  --sidebar-w: 240px;
}
* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }
body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  min-height: 100vh;
  display: grid;
  grid-template-columns: var(--sidebar-w) 1fr;
}
::selection { background: var(--accent); color: var(--bg); }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

/* HEADER */
.hero {
  padding: 40px 0 36px;
  position: relative;
  margin-bottom: 8px;
}
.hero::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 400px;
  background: radial-gradient(ellipse at 30% 0%, rgba(240,192,64,0.06) 0%, transparent 60%),
              radial-gradient(ellipse at 70% 0%, rgba(96,160,240,0.04) 0%, transparent 50%);
  pointer-events: none;
  z-index: 0;
}
.hero * { position: relative; z-index: 1; }
.badge {
  display: inline-block;
  background: rgba(240,192,64,0.1);
  border: 1px solid rgba(240,192,64,0.2);
  color: var(--accent);
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  margin-bottom: 20px;
}
h1 {
  font-family: 'Syne', sans-serif;
  font-size: clamp(36px, 5vw, 56px);
  line-height: 1.1;
  margin-bottom: 12px;
  background: linear-gradient(135deg, #fff 0%, #ccc 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.subtitle {
  font-size: 18px;
  color: var(--text2);
  font-weight: 300;
  max-width: 600px;
}

/* COUNTDOWN */
.countdown-strip {
  display: flex;
  gap: 16px;
  margin-top: 32px;
  flex-wrap: wrap;
}
.countdown-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 16px 24px;
  text-align: center;
  min-width: 100px;
}
.countdown-card .num {
  font-family: 'JetBrains Mono', monospace;
  font-size: 32px;
  font-weight: 500;
  color: var(--accent);
}
.countdown-card .lbl {
  font-size: 11px;
  color: var(--text3);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-top: 4px;
}

/* MAIN */
main {
  padding: 40px;
  max-width: 1200px;
  margin: 0 auto;
}
.section { display: none; }
.section.active { display: block; animation: sectionIn 0.25s ease; }
@keyframes sectionIn { from { opacity:0; transform:translateX(20px); } to { opacity:1; transform:translateX(0); } }
@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

/* OVERVIEW SECTION */
.overview-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
  margin-top: 24px;
}
.subject-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 24px;
  cursor: pointer;
  transition: all 0.25s;
  position: relative;
  overflow: hidden;
}
.subject-card:hover {
  border-color: var(--accent);
  transform: translateY(-2px);
  box-shadow: 0 8px 30px rgba(240,192,64,0.08);
}
.subject-card .color-bar {
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
}
.subject-card .code {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text3);
  margin-bottom: 8px;
}
.subject-card .name {
  font-family: 'Syne', sans-serif;
  font-size: 20px;
  margin-bottom: 12px;
}
.subject-card .meta {
  display: flex;
  gap: 16px;
  font-size: 12px;
  color: var(--text2);
}
.subject-card .meta span { display: flex; align-items: center; gap: 4px; }

/* SUBJECT DETAIL */
.subject-header {
  margin-bottom: 32px;
}
.subject-header .back {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  color: var(--text3);
  font-size: 13px;
  cursor: pointer;
  margin-bottom: 16px;
  transition: color 0.2s;
}
.subject-header .back:hover { color: var(--accent); }
.subject-header h2 {
  font-family: 'Syne', sans-serif;
  font-size: 36px;
  margin-bottom: 6px;
}
.subject-header .syllabus-code {
  font-family: 'JetBrains Mono', monospace;
  color: var(--text3);
  font-size: 14px;
}

/* TABS inside subject */
.detail-tabs {
  display: flex;
  gap: 6px;
  margin-bottom: 28px;
  flex-wrap: wrap;
}
.detail-tab {
  padding: 8px 18px;
  font-size: 13px;
  font-weight: 500;
  color: var(--text2);
  cursor: pointer;
  border-radius: 20px;
  white-space: nowrap;
  transition: all 0.2s;
  background: var(--surface2);
  border: 1px solid var(--border);
}
.detail-tab:hover { color: var(--text); border-color: var(--accent); }
.detail-tab.active { color: var(--bg); background: var(--accent); border-color: var(--accent); }
.detail-panel { display: none; }
.detail-panel.active { display: block; animation: fadeIn 0.25s ease; }

/* PAPER CARDS */
.paper-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  margin-bottom: 16px;
}
.paper-card h4 {
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 4px;
}
.paper-card .paper-meta {
  font-size: 13px;
  color: var(--text2);
  margin-bottom: 16px;
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
}
.paper-card .paper-meta .tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
}

/* GRADE TABLE */
.grade-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
  margin: 16px 0;
}
.grade-table th {
  text-align: left;
  padding: 10px 12px;
  border-bottom: 1px solid var(--border);
  color: var(--text3);
  font-weight: 500;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.grade-table td {
  padding: 10px 12px;
  border-bottom: 1px solid rgba(42,42,58,0.5);
}
.grade-table tr:hover td { background: rgba(255,255,255,0.02); }
.grade-astar { color: var(--accent); font-weight: 600; }
.grade-a { color: var(--green); font-weight: 600; }

/* TOPIC LIST */
.topic-list {
  display: grid;
  gap: 8px;
}
.topic-item {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 14px 18px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
}
.topic-item:hover { border-color: var(--accent); }
.topic-item .topic-num {
  font-family: 'JetBrains Mono', monospace;
  color: var(--text3);
  font-size: 12px;
  min-width: 36px;
}
.topic-item .topic-name { flex: 1; }
.topic-item .topic-check {
  width: 20px; height: 20px;
  border: 2px solid var(--border);
  border-radius: 5px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  flex-shrink: 0;
}
.topic-item .topic-check.shaky {
  background: var(--accent);
  border-color: var(--accent);
}
.topic-item .topic-check.shaky::after {
  content: '~';
  color: var(--bg);
  font-size: 13px;
  font-weight: 700;
}
.topic-item .topic-check.confident {
  background: var(--green);
  border-color: var(--green);
}
.topic-item .topic-check.confident::after {
  content: 'âœ“';
  color: var(--bg);
  font-size: 12px;
  font-weight: 700;
}
/* confidence bar on subject cards */
.conf-bar {
  display: flex;
  height: 4px;
  border-radius: 2px;
  overflow: hidden;
  margin-top: 14px;
  background: var(--border);
}
.conf-bar .cb-shaky   { background: var(--accent); }
.conf-bar .cb-confident { background: var(--green); }
.conf-bar .cb-none    { background: var(--border); }
/* topic notes expansion */
.topic-item { flex-wrap: wrap; cursor: pointer; }
.topic-notes {
  display: none;
  width: 100%;
  margin-top: 10px;
  padding-top: 10px;
  border-top: 1px solid var(--border);
  font-size: 13px;
  color: var(--text2);
  line-height: 1.6;
}
.topic-notes.open { display: block; }
.topic-notes ul { padding-left: 18px; margin: 4px 0; }
.topic-notes li { margin-bottom: 3px; }
.topic-notes .tn-label {
  font-size: 11px;
  font-family: 'JetBrains Mono', monospace;
  color: var(--text3);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-top: 8px;
  margin-bottom: 4px;
}
.topic-notes .tn-label:first-child { margin-top: 0; }
.topic-notes .formula {
  font-family: 'JetBrains Mono', monospace;
  background: var(--surface3);
  padding: 2px 7px;
  border-radius: 4px;
  font-size: 12px;
  color: var(--cyan);
}
/* past papers hub */
.pp-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 16px;
  margin-top: 20px;
}
.pp-subject {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
}
.pp-subject h4 {
  font-family: 'Syne', sans-serif;
  font-size: 17px;
  margin-bottom: 4px;
}
.pp-subject .pp-code {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text3);
  margin-bottom: 14px;
}
.pp-links { display: flex; flex-direction: column; gap: 8px; }
.pp-link {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 9px 13px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  text-decoration: none;
  color: var(--text);
  font-size: 13px;
  transition: border-color 0.2s;
}
.pp-link:hover { border-color: var(--accent); color: var(--accent); }
.pp-link .pp-icon { font-size: 15px; flex-shrink: 0; }
.pp-link .pp-desc { font-size: 11px; color: var(--text3); }
/* score tracker */
.score-form {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 12px;
  margin-bottom: 28px;
}
.score-form label { display: flex; flex-direction: column; gap: 6px; font-size: 12px; color: var(--text2); }
.score-form input, .score-form select {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 8px 10px;
  color: var(--text);
  font-size: 13px;
  font-family: inherit;
}
.score-form input:focus, .score-form select:focus {
  outline: none;
  border-color: var(--accent);
}
.score-form .btn-log {
  align-self: end;
  padding: 9px 18px;
  background: var(--accent);
  color: var(--bg);
  border: none;
  border-radius: 6px;
  font-weight: 600;
  font-size: 13px;
  cursor: pointer;
}
.score-form .btn-log:hover { background: var(--accent2); }
.score-subject-block { margin-bottom: 28px; }
.score-subject-block h4 {
  font-family: 'Syne', sans-serif;
  font-size: 17px;
  margin-bottom: 12px;
}
.score-table { width: 100%; border-collapse: collapse; font-size: 13px; }
.score-table th {
  text-align: left;
  padding: 7px 10px;
  color: var(--text3);
  font-size: 11px;
  font-weight: 500;
  border-bottom: 1px solid var(--border);
}
.score-table td { padding: 9px 10px; border-bottom: 1px solid var(--border); }
.score-table .pct { font-family: 'JetBrains Mono', monospace; font-weight: 600; }
.score-table .pct.good { color: var(--green); }
.score-table .pct.ok   { color: var(--accent); }
.score-table .pct.low  { color: var(--red); }
.score-table .del-btn {
  background: none;
  border: none;
  color: var(--text3);
  cursor: pointer;
  font-size: 14px;
  padding: 2px 6px;
}
.score-table .del-btn:hover { color: var(--red); }
.grade-chip {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-weight: 600;
  font-family: 'JetBrains Mono', monospace;
}

/* EXAM TIMELINE */
.timeline {
  position: relative;
  padding-left: 24px;
}
.timeline::before {
  content: '';
  position: absolute;
  left: 6px;
  top: 0; bottom: 0;
  width: 2px;
  background: var(--border);
}
.timeline-item {
  position: relative;
  margin-bottom: 20px;
  padding-left: 24px;
}
.timeline-item::before {
  content: '';
  position: absolute;
  left: -22px;
  top: 6px;
  width: 10px; height: 10px;
  border-radius: 50%;
  background: var(--accent);
  border: 2px solid var(--bg);
}
.timeline-item .date {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--accent);
  margin-bottom: 4px;
}
.timeline-item .event {
  font-size: 14px;
  font-weight: 500;
}
.timeline-item .event-meta {
  font-size: 12px;
  color: var(--text3);
  margin-top: 2px;
}

/* TIPS */
.tip-card {
  background: rgba(240,192,64,0.05);
  border: 1px solid rgba(240,192,64,0.15);
  border-radius: 10px;
  padding: 18px 20px;
  margin-bottom: 12px;
  font-size: 14px;
}
.tip-card .tip-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--accent);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 6px;
}

/* PROGRESS BAR */
.progress-bar {
  background: var(--surface2);
  border-radius: 6px;
  height: 8px;
  overflow: hidden;
  margin: 8px 0;
}
.progress-fill {
  height: 100%;
  border-radius: 6px;
  background: linear-gradient(90deg, var(--accent), var(--green));
  transition: width 0.5s ease;
}

/* INFO GRID */
.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px;
  margin: 16px 0;
}
.info-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 16px;
}
.info-box .info-label {
  font-size: 11px;
  color: var(--text3);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 4px;
}
.info-box .info-value {
  font-size: 20px;
  font-weight: 600;
}

h3 {
  font-family: 'Syne', sans-serif;
  font-size: 22px;
  margin-bottom: 16px;
  margin-top: 24px;
}
h3:first-child { margin-top: 0; }

p { color: var(--text2); margin-bottom: 12px; font-size: 14px; }

.note {
  background: var(--surface2);
  border-left: 3px solid var(--blue);
  padding: 14px 18px;
  border-radius: 0 8px 8px 0;
  font-size: 13px;
  color: var(--text2);
  margin: 16px 0;
}

/* TRACKER SECTION */
.tracker-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 16px;
  margin-top: 20px;
}
.tracker-subject {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
}
.tracker-subject .ts-name {
  font-weight: 600;
  font-size: 15px;
  margin-bottom: 4px;
}
.tracker-subject .ts-code {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text3);
  margin-bottom: 12px;
}
.tracker-exam {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-top: 1px solid rgba(42,42,58,0.4);
  font-size: 13px;
}
.tracker-exam .te-date {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--accent);
}
.days-badge {
  font-size: 11px;
  padding: 3px 8px;
  border-radius: 10px;
  font-weight: 600;
}
.days-badge.urgent { background: rgba(240,96,96,0.15); color: var(--red); }
.days-badge.soon { background: rgba(240,128,64,0.15); color: var(--orange); }
.days-badge.ok { background: rgba(64,208,128,0.15); color: var(--green); }
.days-badge.done { background: rgba(128,128,128,0.15); color: var(--text2); text-decoration: line-through; }

@media (max-width: 768px) {
  body { display: block; }
  .app-shell { display: block; min-height: 100vh; }
  .sidebar { position: fixed; left: 0; top: 0; bottom: 0; width: var(--sidebar-w); transform: translateX(-100%); transition: transform 0.3s ease; z-index: 200; }
  .sidebar.open { transform: translateX(0); }
  .sidebar-toggle { display: flex; }
  .sidebar-overlay.active { display: block; }
  .hero, main { padding: 24px 20px; }
  .overview-grid { grid-template-columns: 1fr; }
  .info-grid { grid-template-columns: 1fr 1fr; }
  .tracker-grid { grid-template-columns: 1fr; }
  .countdown-strip { gap: 8px; }
  .countdown-card { padding: 12px 16px; min-width: 70px; }
  .countdown-card .num { font-size: 24px; }
  .tt-grid { grid-template-columns: 56px repeat(7,1fr); font-size: 10px; }
  .tt-cell { padding: 5px 4px; }
}

/* ===== VISUAL REFRESH ===== */
/* richer gradient on hero bg */
.hero::before {
  background: radial-gradient(ellipse at 20% 0%, rgba(240,192,64,0.10) 0%, transparent 55%),
              radial-gradient(ellipse at 80% 0%, rgba(96,160,240,0.08) 0%, transparent 50%),
              radial-gradient(ellipse at 50% 100%, rgba(160,112,240,0.05) 0%, transparent 60%);
}
/* subject card colour tints */
.subject-card { transition: all 0.25s; }
.subject-card[data-s="ict"]      { background: linear-gradient(135deg,var(--surface) 0%,rgba(96,160,240,0.09) 100%); border-color:rgba(96,160,240,0.25); }
.subject-card[data-s="cs"]       { background: linear-gradient(135deg,var(--surface) 0%,rgba(160,112,240,0.09) 100%); border-color:rgba(160,112,240,0.25); }
.subject-card[data-s="business"] { background: linear-gradient(135deg,var(--surface) 0%,rgba(64,208,128,0.09) 100%); border-color:rgba(64,208,128,0.25); }
.subject-card[data-s="engfirst"] { background: linear-gradient(135deg,var(--surface) 0%,rgba(240,192,64,0.09) 100%); border-color:rgba(240,192,64,0.25); }
.subject-card[data-s="englit"]   { background: linear-gradient(135deg,var(--surface) 0%,rgba(240,96,160,0.09) 100%); border-color:rgba(240,96,160,0.25); }
.subject-card[data-s="science"]  { background: linear-gradient(135deg,var(--surface) 0%,rgba(240,96,96,0.09) 100%); border-color:rgba(240,96,96,0.25); }
.subject-card[data-s="addmath"]  { background: linear-gradient(135deg,var(--surface) 0%,rgba(64,208,208,0.09) 100%); border-color:rgba(64,208,208,0.25); }
.subject-card[data-s="gp"]       { background: linear-gradient(135deg,var(--surface) 0%,rgba(64,192,160,0.09) 100%); border-color:rgba(64,192,160,0.25); }
/* stronger hover glow per subject */
.subject-card[data-s="ict"]:hover      { border-color:var(--blue);   box-shadow:0 8px 32px rgba(96,160,240,0.18); transform:translateY(-3px); }
.subject-card[data-s="cs"]:hover       { border-color:var(--purple); box-shadow:0 8px 32px rgba(160,112,240,0.18); transform:translateY(-3px); }
.subject-card[data-s="business"]:hover { border-color:var(--green);  box-shadow:0 8px 32px rgba(64,208,128,0.18); transform:translateY(-3px); }
.subject-card[data-s="engfirst"]:hover { border-color:var(--accent); box-shadow:0 8px 32px rgba(240,192,64,0.18); transform:translateY(-3px); }
.subject-card[data-s="englit"]:hover   { border-color:var(--pink);   box-shadow:0 8px 32px rgba(240,96,160,0.18); transform:translateY(-3px); }
.subject-card[data-s="science"]:hover  { border-color:var(--red);    box-shadow:0 8px 32px rgba(240,96,96,0.18); transform:translateY(-3px); }
.subject-card[data-s="addmath"]:hover  { border-color:var(--cyan);   box-shadow:0 8px 32px rgba(64,208,208,0.18); transform:translateY(-3px); }
.subject-card[data-s="gp"]:hover       { border-color:var(--teal);   box-shadow:0 8px 32px rgba(64,192,160,0.18); transform:translateY(-3px); }
/* thicker colour bar */
.subject-card .color-bar { height: 4px; }
/* conf-bar thicker + rounded segments */
.conf-bar { height: 6px; border-radius: 3px; gap: 2px; }
.conf-bar .cb-shaky, .conf-bar .cb-confident, .conf-bar .cb-none { border-radius: 2px; }
/* section headings */
.section > h3:first-child {
  font-family: 'Syne', sans-serif;
  font-size: 28px;
  margin-bottom: 8px;
  background: linear-gradient(90deg,var(--text) 0%,var(--text2) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* ===== TIMETABLE ===== */
.tt-nav {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 24px;
}
.tt-nav-btn {
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 8px 18px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 13px;
  font-family: inherit;
  transition: all 0.15s;
}
.tt-nav-btn:hover { border-color: var(--accent); color: var(--accent); }
.tt-week-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  color: var(--text2);
  flex: 1;
  text-align: center;
}
.tt-legend {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
}
.tt-legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--text2);
}
.tt-legend-dot {
  width: 10px; height: 10px;
  border-radius: 3px;
  flex-shrink: 0;
}
.tt-grid {
  display: grid;
  grid-template-columns: 72px repeat(7, 1fr);
  gap: 6px;
  font-size: 12px;
}
.tt-header {
  padding: 8px 6px;
  text-align: center;
  border-radius: 8px;
  font-weight: 600;
  font-size: 11px;
}
.tt-header.today {
  background: rgba(240,192,64,0.12);
  border: 1px solid rgba(240,192,64,0.3);
  color: var(--accent);
}
.tt-header.past { opacity: 0.4; }
.tt-header .tt-date { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 700; }
.tt-header .tt-dow  { font-size: 10px; color: var(--text3); margin-top: 2px; }
.tt-slot-label {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding-right: 10px;
  font-size: 11px;
  color: var(--text3);
  font-family: 'JetBrains Mono', monospace;
}
.tt-cell {
  border-radius: 8px;
  padding: 8px 7px;
  min-height: 62px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  font-size: 11px;
  border: 1px solid transparent;
  transition: transform 0.15s, box-shadow 0.15s;
}
.tt-cell:hover { transform: translateY(-1px); box-shadow: 0 4px 14px rgba(0,0,0,0.3); }
.tt-cell.rest {
  background: var(--surface);
  border-color: var(--border);
  align-items: center;
  justify-content: center;
  color: var(--text3);
  font-style: italic;
}
.tt-cell.empty {
  background: var(--surface);
  border-color: var(--border);
  opacity: 0.4;
}
.tt-cell.past { opacity: 0.45; }
.tt-subj {
  font-weight: 700;
  font-size: 12px;
  letter-spacing: 0.02em;
}
.tt-focus {
  font-size: 10px;
  opacity: 0.85;
  margin-top: 3px;
}
.tt-dur {
  font-size: 10px;
  opacity: 0.65;
  font-family: 'JetBrains Mono', monospace;
  margin-top: 5px;
}
.tt-exam-day {
  background: rgba(240,192,64,0.08) !important;
  border-color: rgba(240,192,64,0.35) !important;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  color: var(--accent);
  font-size: 11px;
  text-align: center;
}
.tt-exam-day::before { content: 'ðŸŽ¯'; display: block; font-size: 16px; margin-bottom: 3px; }
.tt-grade-note { font-size:11px; color:var(--green); margin-bottom:12px; font-style:italic; opacity:0.85; }
/* A* PANEL */
.astar-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(190px,1fr)); gap:10px; margin-bottom:28px; }
.astar-card { background:var(--surface); border:1px solid var(--border); border-radius:10px; padding:14px 16px; }
.astar-card.on-track { border-color:rgba(64,208,128,0.45); }
.astar-card.close    { border-color:rgba(240,192,64,0.45); }
.astar-card.at-risk  { border-color:rgba(240,96,96,0.45); }
.astar-card.no-data  { opacity:0.5; }
.astar-subj { font-size:11px; font-weight:600; color:var(--text2); text-transform:uppercase; letter-spacing:.06em; margin-bottom:6px; }
.astar-pct  { font-family:'JetBrains Mono',monospace; font-size:24px; font-weight:700; line-height:1; }
.astar-pct.on-track { color:var(--green); }
.astar-pct.close    { color:var(--accent); }
.astar-pct.at-risk  { color:var(--red); }
.astar-gap  { font-size:11px; color:var(--text3); margin-top:5px; }
.astar-bar  { height:4px; border-radius:2px; background:var(--surface3); margin-top:10px; overflow:hidden; }
.astar-bar-fill { height:100%; border-radius:2px; transition:width 0.5s; }
/* IMPORT PANEL */
.import-toggle { display:flex; align-items:center; gap:10px; background:var(--surface); border:1px dashed var(--border); border-radius:10px; padding:13px 18px; cursor:pointer; font-size:13px; color:var(--text2); margin-bottom:16px; transition:border-color 0.15s,color 0.15s; user-select:none; }
.import-toggle:hover { border-color:var(--accent); color:var(--text); }
.import-panel { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:20px; margin-bottom:24px; display:none; }
.import-panel.open { display:block; }
.import-split { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
@media(max-width:720px){ .import-split{grid-template-columns:1fr;} }
.import-preview { background:var(--surface2); border:1px solid var(--border); border-radius:8px; min-height:200px; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative; }
.import-preview img { width:100%; max-height:420px; object-fit:contain; border-radius:6px; }
.import-preview embed { width:100%; height:400px; border-radius:6px; }
.import-preview .placeholder { text-align:center; color:var(--text3); font-size:13px; padding:20px; line-height:1.6; }
.import-entry-table { width:100%; border-collapse:collapse; font-size:12px; }
.import-entry-table th { text-align:left; padding:6px 8px; color:var(--text3); font-size:10px; text-transform:uppercase; letter-spacing:.06em; border-bottom:1px solid var(--border); }
.import-entry-table td { padding:4px 3px; }
.import-entry-table input,.import-entry-table select { background:var(--surface2); border:1px solid var(--border); border-radius:4px; padding:5px 6px; color:var(--text); font-size:11px; width:100%; font-family:inherit; }
.import-entry-table input:focus,.import-entry-table select:focus { outline:none; border-color:var(--accent); }
.import-actions { display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
.btn-import { padding:9px 20px; background:var(--accent); color:var(--bg); border:none; border-radius:6px; font-weight:600; font-size:13px; cursor:pointer; }
.btn-import:hover { background:var(--accent2); }
.btn-import-sec { padding:9px 18px; background:transparent; color:var(--text2); border:1px solid var(--border); border-radius:6px; font-size:13px; cursor:pointer; }
.btn-import-sec:hover { border-color:var(--text); color:var(--text); }

/* ===== SIDEBAR LAYOUT ===== */
.sidebar {
  grid-column: 1;
  position: sticky;
  top: 0;
  height: 100vh;
  width: var(--sidebar-w);
  background: var(--sidebar-bg);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  z-index: 100;
}
.sidebar::-webkit-scrollbar { width: 4px; }
.sidebar::-webkit-scrollbar-track { background: transparent; }
.sidebar::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
.sidebar-logo {
  padding: 22px 20px 16px;
  font-family: 'Syne', sans-serif;
  font-size: 14px;
  font-weight: 700;
  color: var(--text);
  border-bottom: 1px solid var(--border);
  letter-spacing: 0.04em;
  flex-shrink: 0;
}
.sidebar-logo span {
  display: block;
  font-size: 10px;
  font-weight: 600;
  color: var(--accent);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 4px;
}
.sidebar-nav { flex: 1; padding: 8px 0 16px; overflow-y: auto; }
.sidebar-group { margin-bottom: 4px; }
.sidebar-group-label {
  padding: 10px 20px 4px;
  font-size: 10px;
  font-weight: 600;
  color: var(--text3);
  text-transform: uppercase;
  letter-spacing: 1.5px;
}
.sidebar-item {
  display: flex;
  align-items: center;
  gap: 9px;
  padding: 9px 20px 9px 17px;
  font-size: 13px;
  color: var(--text2);
  cursor: pointer;
  transition: all 0.15s;
  border-left: 3px solid transparent;
  user-select: none;
}
.sidebar-item:hover { color: var(--text); background: rgba(255,255,255,0.04); }
.sidebar-item.active {
  color: var(--accent);
  border-left-color: var(--accent);
  background: rgba(240,192,64,0.07);
}
.sidebar-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  flex-shrink: 0;
}
.sidebar-toggle {
  display: none;
  position: fixed;
  top: 12px;
  left: 12px;
  z-index: 300;
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text);
  width: 38px;
  height: 38px;
  border-radius: 8px;
  font-size: 18px;
  cursor: pointer;
  align-items: center;
  justify-content: center;
  line-height: 1;
}
.sidebar-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.65);
  z-index: 150;
}
.app-shell {
  grid-column: 2;
  min-height: 100vh;
  overflow-y: auto;
}
.app-shell::-webkit-scrollbar { width: 6px; }
.app-shell::-webkit-scrollbar-track { background: transparent; }
.app-shell::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
/* ===== NEW FEATURE CSS ===== */
.section-intro { color: var(--text2); font-size: 14px; margin: -12px 0 24px; line-height: 1.6; }
.section-intro .btn-print { margin-left: 12px; padding: 4px 12px; font-size: 12px; background: var(--surface2); border: 1px solid var(--border); color: var(--text2); border-radius: 6px; cursor: pointer; }
.section-intro .btn-print:hover { border-color: var(--accent); color: var(--accent); }
.btn-secondary { padding: 8px 16px; background: var(--surface2); border: 1px solid var(--border); color: var(--text2); border-radius: 8px; font-size: 13px; cursor: pointer; transition: all 0.15s; white-space: nowrap; }
.btn-secondary:hover { border-color: var(--accent); color: var(--text); }

/* GRADE CALCULATOR */
.gc-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 20px; }
.gc-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
.gc-card h4 { font-family: 'Syne', sans-serif; font-size: 16px; margin-bottom: 4px; color: var(--text); }
.gc-card .gc-subcode { font-size: 11px; color: var(--text3); font-family: 'JetBrains Mono', monospace; margin-bottom: 14px; }
.gc-paper-row { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.gc-paper-label { flex: 1; font-size: 12px; color: var(--text2); }
.gc-paper-input { width: 56px; padding: 5px 8px; background: var(--surface2); border: 1px solid var(--border); border-radius: 6px; color: var(--text); font-size: 13px; text-align: center; }
.gc-paper-input:focus { outline: none; border-color: var(--accent); }
.gc-paper-max { font-size: 11px; color: var(--text3); white-space: nowrap; }
.gc-results { margin-top: 14px; padding-top: 14px; border-top: 1px solid var(--border); }
.gc-grade-row { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; font-size: 13px; }
.gc-grade-chip { width: 30px; text-align: center; padding: 2px 0; border-radius: 4px; font-weight: 700; font-size: 12px; }
.gc-grade-chip.astar { background: rgba(240,192,64,0.2); color: var(--accent); }
.gc-grade-chip.a { background: rgba(96,160,240,0.2); color: var(--blue); }
.gc-grade-chip.b { background: rgba(64,208,128,0.15); color: var(--green); }
.gc-grade-chip.c { background: rgba(240,128,64,0.15); color: var(--orange); }
.gc-need { flex: 1; color: var(--text2); }
.gc-need strong { color: var(--text); }
.gc-need.achieved { color: var(--green); }
.gc-need.impossible { color: var(--red); }

/* FORMULA SHEET */
.fs-subject { margin-bottom: 28px; }
.fs-subject-title { font-family: 'Syne', sans-serif; font-size: 15px; font-weight: 700; color: var(--accent); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
.fs-subject-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.fs-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 10px; }
.fs-card { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 12px 14px; }
.fs-card-title { font-size: 11px; font-weight: 600; color: var(--text3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
.fs-formula { font-family: 'JetBrains Mono', monospace; font-size: 12px; color: var(--text); background: var(--surface2); padding: 4px 8px; border-radius: 4px; margin-bottom: 4px; }
@media print { .sidebar, .sidebar-toggle, .app-shell::-webkit-scrollbar, .pomo-widget, #pomodoroWidget { display: none !important; } .app-shell { display: block; } body { display: block; } main { padding: 20px; } .section { display: block !important; } .section:not(#formulae) { display: none !important; } }

/* FLASHCARDS */
.fc-controls { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 24px; align-items: center; }
.fc-controls select { padding: 8px 12px; background: var(--surface2); border: 1px solid var(--border); color: var(--text); border-radius: 8px; font-size: 13px; }
.fc-card { perspective: 1000px; cursor: pointer; width: 100%; max-width: 560px; margin: 0 auto; height: 260px; }
.fc-inner { position: relative; width: 100%; height: 100%; transform-style: preserve-3d; transition: transform 0.45s ease; }
.fc-inner.flipped { transform: rotateY(180deg); }
.fc-front, .fc-back { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 14px; padding: 28px 32px; display: flex; flex-direction: column; justify-content: center; }
.fc-front { background: var(--surface); border: 1px solid var(--border); }
.fc-back { background: var(--surface2); border: 1px solid var(--accent); transform: rotateY(180deg); overflow-y: auto; justify-content: flex-start; }
.fc-subj-tag { font-size: 10px; font-weight: 600; color: var(--text3); text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 10px; }
.fc-topic-name { font-family: 'Syne', sans-serif; font-size: 22px; font-weight: 700; color: var(--text); line-height: 1.3; }
.fc-tap-hint { font-size: 11px; color: var(--text3); margin-top: 16px; }
.fc-back-section { margin-bottom: 10px; }
.fc-back-label { font-size: 10px; font-weight: 600; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
.fc-back ul { margin: 0; padding-left: 16px; }
.fc-back li { font-size: 12px; color: var(--text2); margin-bottom: 3px; line-height: 1.5; }
.fc-back .formula { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--text); background: var(--bg); padding: 2px 6px; border-radius: 3px; display: inline-block; }
.fc-nav { display: flex; align-items: center; justify-content: center; gap: 16px; margin-top: 16px; }
.fc-counter { font-size: 13px; color: var(--text3); min-width: 60px; text-align: center; }
.fc-rate { display: flex; align-items: center; gap: 12px; margin-top: 14px; justify-content: center; flex-wrap: wrap; }
.fc-rate-label { font-size: 13px; color: var(--text2); }
.fc-type-badge { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; padding: 3px 8px; border-radius: 20px; display: inline-block; margin-bottom: 10px; }
.fc-type-def { background: rgba(212,167,98,0.15); color: var(--accent); }
.fc-type-formula { background: rgba(64,208,128,0.15); color: var(--green); }
.fc-type-fact { background: rgba(120,180,255,0.15); color: #78b4ff; }
.fc-topic-label { font-size: 11px; color: var(--text3); margin-bottom: 6px; }
.fc-question-text { font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 700; color: var(--text); line-height: 1.3; }
.fc-answer-content { font-size: 15px; color: var(--text2); line-height: 1.65; padding: 8px 0; }
.fc-answer-formula { font-family: 'JetBrains Mono', monospace; font-size: 14px; color: var(--green); background: var(--bg); padding: 12px 16px; border-radius: 8px; display: block; }
.btn-rate { padding: 8px 24px; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; border: none; transition: all 0.15s; }
.btn-rate.fail { background: rgba(240,96,96,0.15); color: var(--red); border: 1px solid var(--red); }
.btn-rate.fail:hover { background: rgba(240,96,96,0.3); }
.btn-rate.pass { background: rgba(64,208,128,0.15); color: var(--green); border: 1px solid var(--green); }
.btn-rate.pass:hover { background: rgba(64,208,128,0.3); }

/* REVIEW QUEUE */
.rq-empty { text-align: center; padding: 48px 20px; color: var(--text3); font-size: 14px; }
.rq-section { margin-bottom: 24px; }
.rq-section-title { font-size: 12px; font-weight: 600; color: var(--text3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
.rq-items { display: flex; flex-direction: column; gap: 6px; }
.rq-item { display: flex; align-items: center; gap: 12px; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; cursor: pointer; transition: border-color 0.15s; }
.rq-item:hover { border-color: var(--accent); }
.rq-item-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.rq-item-name { flex: 1; font-size: 13px; color: var(--text); }
.rq-item-interval { font-size: 11px; color: var(--text3); white-space: nowrap; }
.rq-item-overdue { font-size: 11px; color: var(--red); white-space: nowrap; }
.rq-stats { display: flex; gap: 16px; margin-bottom: 20px; flex-wrap: wrap; }
.rq-stat { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 10px 16px; font-size: 13px; color: var(--text2); }
.rq-stat strong { display: block; font-size: 20px; color: var(--accent); font-family: 'Syne', sans-serif; }

/* POMODORO WIDGET */
.sidebar-pomo-btn { margin: 8px 12px 16px; padding: 9px 14px; background: rgba(240,192,64,0.08); border: 1px solid rgba(240,192,64,0.25); border-radius: 8px; color: var(--accent); font-size: 12px; font-weight: 600; cursor: pointer; text-align: center; transition: all 0.15s; }
.sidebar-pomo-btn:hover { background: rgba(240,192,64,0.15); }
.sidebar-pomo-btn.active { background: rgba(240,192,64,0.2); border-color: var(--accent); }
.pomo-widget { position: fixed; bottom: 24px; right: 24px; width: 240px; background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 16px; z-index: 500; box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
.pomo-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
.pomo-title { font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700; color: var(--text); }
.pomo-close { background: none; border: none; color: var(--text3); font-size: 14px; cursor: pointer; padding: 0; line-height: 1; }
.pomo-close:hover { color: var(--text); }
.pomo-select { width: 100%; padding: 6px 10px; background: var(--surface2); border: 1px solid var(--border); color: var(--text); border-radius: 6px; font-size: 12px; margin-bottom: 12px; }
.pomo-time { font-family: 'JetBrains Mono', monospace; font-size: 40px; font-weight: 500; color: var(--accent); text-align: center; line-height: 1; margin-bottom: 4px; }
.pomo-phase { text-align: center; font-size: 11px; color: var(--text3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
.pomo-btns { display: flex; gap: 8px; margin-bottom: 10px; }
.pomo-btn { flex: 1; padding: 7px 0; border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; border: none; background: var(--accent); color: var(--bg); transition: all 0.15s; }
.pomo-btn:hover { opacity: 0.85; }
.pomo-btn.secondary { background: var(--surface2); color: var(--text2); border: 1px solid var(--border); }
.pomo-btn.secondary:hover { border-color: var(--accent); color: var(--text); }
.pomo-stats { font-size: 11px; color: var(--text3); text-align: center; line-height: 1.6; border-top: 1px solid var(--border); padding-top: 8px; }

/* Mobile sidebar overrides â€” must come AFTER sidebar base CSS */
@media (max-width: 768px) {
  .sidebar { position: fixed; left: 0; top: 0; bottom: 0; height: auto; width: var(--sidebar-w); transform: translateX(-100%); transition: transform 0.3s ease; z-index: 200; }
  .sidebar.open { transform: translateX(0); }
  .sidebar-toggle { display: flex; }
  .sidebar-overlay.active { display: block; }
}

/* ===== F1: STREAK HEATMAP ===== */
.streak-panel { margin-top: 32px; }
.streak-stats { display: flex; gap: 12px; margin-bottom: 14px; flex-wrap: wrap; }
.streak-stat { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 10px 18px; }
.streak-stat .ss-val { font-family: 'JetBrains Mono', monospace; font-size: 26px; font-weight: 700; color: var(--accent); }
.streak-stat .ss-lbl { font-size: 11px; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }
.streak-grid { display: grid; grid-template-columns: repeat(12, 14px); grid-template-rows: repeat(7, 14px); gap: 3px; grid-auto-flow: column; }
.streak-cell { width: 14px; height: 14px; border-radius: 3px; background: var(--surface2); }
.streak-cell.l1 { background: rgba(64,208,128,0.25); }
.streak-cell.l2 { background: rgba(64,208,128,0.5); }
.streak-cell.l3 { background: rgba(64,208,128,0.75); }
.streak-cell.l4 { background: var(--green); }
.streak-cell.today { outline: 2px solid var(--accent); outline-offset: 1px; }

/* ===== ZONE PICKER ===== */
.zone-modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.8); display:flex; align-items:center; justify-content:center; z-index:900; padding:16px; }
.zone-modal-overlay.hidden { display:none; }
.zone-modal { background:var(--surface); border:1px solid var(--border); border-radius:20px; padding:36px 28px; width:100%; max-width:460px; }
.zone-modal h2 { font-family:var(--font-display); font-size:20px; font-weight:700; margin-bottom:6px; }
.zone-modal p { color:var(--text2); font-size:13px; margin-bottom:20px; line-height:1.6; }
.zone-options { display:flex; flex-direction:column; gap:8px; }
.zone-option { background:var(--surface2); border:1.5px solid var(--border); border-radius:12px; padding:12px 16px; cursor:pointer; transition:all 0.15s; display:flex; align-items:center; gap:14px; }
.zone-option:hover { border-color:var(--accent); background:var(--surface3,#1a1a2e); }
.zone-option.selected { border-color:var(--accent); background:var(--surface3,#1a1a2e); }
.zo-badge { background:var(--accent); color:#000; font-weight:800; font-size:11px; padding:3px 8px; border-radius:6px; white-space:nowrap; min-width:52px; text-align:center; }
.zo-label { font-weight:600; font-size:13px; color:var(--text); }
.zo-region { font-size:11px; color:var(--text3,var(--muted)); margin-top:1px; }
.sidebar-zone { display:flex; align-items:center; justify-content:space-between; padding:8px 12px; margin:10px 8px 4px; background:var(--surface2); border-radius:8px; cursor:pointer; font-size:12px; color:var(--text2); border:1px solid var(--border); transition:border-color 0.15s; }
.sidebar-zone:hover { border-color:var(--accent); color:var(--text); }
.sidebar-zone-badge { background:var(--accent); color:#000; font-weight:800; font-size:11px; padding:2px 8px; border-radius:5px; }
.streak-label { font-size: 11px; color: var(--text3); margin-bottom: 8px; }

/* ===== F3: MOCK EXAM ===== */
.mock-timer-bar { height: 3px; background: var(--surface2); border-radius: 2px; margin-bottom: 16px; overflow: hidden; }
.mock-timer-fill { height: 100%; background: var(--accent); border-radius: 2px; transition: width 1s linear; }
.mock-header { text-align: center; padding: 8px 0 14px; }
.mock-header h4 { font-family: 'Syne', sans-serif; font-size: 20px; color: var(--text); }
.mock-header .mock-progress { font-size: 13px; color: var(--text3); margin-top: 4px; }
.mock-btns { display: flex; gap: 16px; justify-content: center; margin-top: 16px; }
.mock-results { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 24px; max-width: 480px; margin: 0 auto; text-align: center; }
.mock-results h4 { font-family: 'Syne', sans-serif; font-size: 22px; margin-bottom: 6px; }
.mock-score-big { font-family: 'JetBrains Mono', monospace; font-size: 48px; font-weight: 700; color: var(--accent); margin: 8px 0; line-height: 1; }
.mock-breakdown { width: 100%; border-collapse: collapse; margin: 16px 0; font-size: 13px; text-align: left; }
.mock-breakdown th { text-align: left; padding: 6px 10px; color: var(--text3); font-size: 11px; font-weight: 500; border-bottom: 1px solid var(--border); }
.mock-breakdown td { padding: 7px 10px; border-bottom: 1px solid rgba(42,42,58,0.4); }

/* ===== F4: EXAM BRIEFING MODAL ===== */
.exam-briefing-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 600; padding: 16px; }
.exam-briefing-modal.hidden { display: none; }
.eb-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 28px; max-width: 560px; width: 100%; max-height: 85vh; overflow-y: auto; position: relative; }
.eb-close { position: absolute; top: 14px; right: 14px; background: none; border: none; color: var(--text3); font-size: 20px; cursor: pointer; line-height: 1; padding: 4px 8px; border-radius: 4px; }
.eb-close:hover { color: var(--text); background: var(--surface2); }
.eb-subject { font-family: 'JetBrains Mono', monospace; font-size: 11px; color: var(--text3); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
.eb-title { font-family: 'Syne', sans-serif; font-size: 22px; margin-bottom: 4px; }
.eb-meta { font-size: 13px; color: var(--text2); margin-bottom: 20px; }
.eb-section { margin-bottom: 16px; }
.eb-section-label { font-size: 11px; font-weight: 600; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
.eb-chips { display: flex; flex-wrap: wrap; gap: 6px; }
.eb-chip { font-size: 11px; padding: 3px 10px; border-radius: 12px; border: 1px solid; }
.eb-chip.weak { background: rgba(240,96,96,0.1); border-color: rgba(240,96,96,0.3); color: var(--red); }
.eb-chip.amber { background: rgba(240,192,64,0.1); border-color: rgba(240,192,64,0.3); color: var(--accent); }
.eb-formula { font-family: 'JetBrains Mono', monospace; font-size: 12px; background: var(--surface2); padding: 3px 8px; border-radius: 4px; color: var(--cyan); display: inline-block; margin: 2px; }
.eb-strategy { font-size: 14px; color: var(--text2); line-height: 1.6; padding: 12px 16px; background: var(--surface2); border-radius: 8px; border-left: 3px solid var(--accent); }
.eb-actions { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
.tracker-exam { cursor: pointer; transition: background 0.15s; }
.tracker-exam:hover { background: rgba(240,192,64,0.04); border-radius: 4px; }
.btn-eb-primary { padding: 10px 20px; background: var(--accent); color: var(--bg); border: none; border-radius: 8px; font-weight: 600; font-size: 13px; cursor: pointer; }
.btn-eb-primary:hover { background: var(--accent2); }

/* ===== F5: PAPER LOG ===== */
.pl-form { display: flex; gap: 10px; flex-wrap: wrap; align-items: flex-end; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 16px; margin-bottom: 20px; }
.pl-form label { display: flex; flex-direction: column; gap: 5px; font-size: 11px; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; }
.pl-form input { background: var(--surface2); border: 1px solid var(--border); border-radius: 6px; padding: 7px 10px; color: var(--text); font-size: 13px; font-family: inherit; width: 110px; }
.pl-form select { background: var(--surface2); border: 1px solid var(--border); border-radius: 6px; padding: 7px 10px; color: var(--text); font-size: 13px; font-family: inherit; width: 240px; }
.pl-form input:focus, .pl-form select:focus { outline: none; border-color: var(--accent); }
.btn-pl-log { padding: 9px 18px; background: var(--accent); color: var(--bg); border: none; border-radius: 6px; font-weight: 600; font-size: 13px; cursor: pointer; }
.btn-pl-log:hover { background: var(--accent2); }
.pl-table { width: 100%; border-collapse: collapse; font-size: 13px; }
.pl-table th { text-align: left; padding: 7px 10px; color: var(--text3); font-size: 11px; font-weight: 500; border-bottom: 1px solid var(--border); text-transform: uppercase; letter-spacing: 0.5px; }
.pl-table td { padding: 9px 10px; border-bottom: 1px solid rgba(42,42,58,0.4); vertical-align: middle; }
.pl-table .pct { font-family: 'JetBrains Mono', monospace; font-weight: 600; }
.pl-table .pct.good { color: var(--green); }
.pl-table .pct.ok   { color: var(--accent); }
.pl-table .pct.low  { color: var(--red); }
.pl-empty { text-align: center; padding: 32px; color: var(--text3); font-size: 13px; }

/* ===== F6: TOPIC PERSONAL NOTES ===== */
.topic-note-btn { background: none; border: none; cursor: pointer; font-size: 14px; padding: 2px 5px; color: var(--text3); transition: color 0.15s; flex-shrink: 0; line-height: 1; }
.topic-note-btn:hover { color: var(--accent); }
.topic-note-btn.has-note { color: var(--accent); }
.topic-note-area { width: 100%; margin-top: 6px; padding: 8px; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 13px; resize: vertical; min-height: 60px; display: none; }
.topic-note-area.open { display: block; }
.topic-note-area:focus { outline: none; border-color: var(--accent); }
</style>
</head>
<body>

<button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()" aria-label="Menu">&#9776;</button>
<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

<aside class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <span>IGCSE 2026</span>
    Study Planner
  </div>
  <nav class="sidebar-nav">
    <div class="sidebar-group">
      <div class="sidebar-group-label">Dashboard</div>
      <div class="sidebar-item active" data-section="overview">Overview</div>
      <div class="sidebar-item" data-section="tracker">Exam Tracker</div>
    </div>
    <div class="sidebar-group">
      <div class="sidebar-group-label">Subjects</div>
      <div class="sidebar-item" data-section="ict"><span class="sidebar-dot" style="background:var(--blue)"></span>ICT</div>
      <div class="sidebar-item" data-section="cs"><span class="sidebar-dot" style="background:var(--purple)"></span>Computer Science</div>
      <div class="sidebar-item" data-section="business"><span class="sidebar-dot" style="background:var(--green)"></span>Business Studies</div>
      <div class="sidebar-item" data-section="engfirst"><span class="sidebar-dot" style="background:var(--accent)"></span>English 1st Lang</div>
      <div class="sidebar-item" data-section="englit"><span class="sidebar-dot" style="background:var(--pink)"></span>English Lit</div>
      <div class="sidebar-item" data-section="science"><span class="sidebar-dot" style="background:var(--red)"></span>Sciences</div>
      <div class="sidebar-item" data-section="addmath"><span class="sidebar-dot" style="background:var(--cyan)"></span>Add Maths</div>
      <div class="sidebar-item" data-section="gp"><span class="sidebar-dot" style="background:var(--teal)"></span>Global Perspectives</div>
    </div>
    <div class="sidebar-group">
      <div class="sidebar-group-label">Tools</div>
      <div class="sidebar-item" data-section="timetable">Timetable</div>
      <div class="sidebar-item" data-section="papers">Past Papers</div>
      <div class="sidebar-item" data-section="progress">Progress</div>
    </div>
    <div class="sidebar-group">
      <div class="sidebar-group-label">Study Tools</div>
      <div class="sidebar-item" data-section="flashcards">Flashcards</div>
      <div class="sidebar-item" data-section="reviewqueue">Review Queue</div>
      <div class="sidebar-item" data-section="gradecalc">Grade Calculator</div>
      <div class="sidebar-item" data-section="formulae">Formula Sheet</div>
    </div>
  </nav>
  <div class="sidebar-zone" onclick="document.getElementById('zoneModal').classList.remove('hidden')">
    <span>Exam Zone</span>
    <span class="sidebar-zone-badge" id="zoneChip">?</span>
  </div>
  <div class="sidebar-pomo-btn" id="pomoSidebarBtn" onclick="togglePomo()">â± Pomodoro</div>
</aside>

<div class="app-shell">
<main>

<!-- ========== OVERVIEW ========== -->
<div class="section active" id="overview">

  <div class="hero">
    <h1>IGCSE 2026<br>Study Planner</h1>
    <p class="subtitle">Cambridge CAIE Â· May/June 2026 Session Â· 8 Subjects Â· Complete exam intelligence & revision tracker</p>
    <div class="countdown-strip" id="countdown"></div>
  </div>

  <h3>Your 8 Subjects at a Glance</h3>
  <p>The May/June 2026 CAIE session â€” <span id="zoneLabel" style="color:var(--accent);font-weight:600;cursor:pointer" onclick="document.getElementById('zoneModal').classList.remove('hidden')">select your zone â–¾</span> â€” runs from 1 April (ICT practicals) to 9 June 2026, with results released on 20 August 2026. Below is every subject you're sitting with its syllabus code, number of papers, and total marks.</p>

  <div class="overview-grid">
    <div class="subject-card" data-s="ict" onclick="goToSubject('ict')">
      <div class="color-bar" style="background:linear-gradient(90deg,var(--blue),var(--cyan))"></div>
      <div class="code">0417</div>
      <div class="name">ICT</div>
      <div class="meta">
        <span>ðŸ“„ 3 Papers</span>
        <span>ðŸ“Š 220 marks</span>
        <span>ðŸ• ~5h total</span>
      </div>
      <div class="conf-bar" id="cb-ict"></div>
    </div>
    <div class="subject-card" data-s="cs" onclick="goToSubject('cs')">
      <div class="color-bar" style="background:linear-gradient(90deg,var(--purple),var(--blue))"></div>
      <div class="code">0478</div>
      <div class="name">Computer Science</div>
      <div class="meta">
        <span>ðŸ“„ 2 Papers</span>
        <span>ðŸ“Š 150 marks</span>
        <span>ðŸ• 3h 30m</span>
      </div>
      <div class="conf-bar" id="cb-cs"></div>
    </div>
    <div class="subject-card" data-s="business" onclick="goToSubject('business')">
      <div class="color-bar" style="background:linear-gradient(90deg,var(--green),var(--teal))"></div>
      <div class="code">0450</div>
      <div class="name">Business Studies</div>
      <div class="meta">
        <span>ðŸ“„ 2 Papers</span>
        <span>ðŸ“Š 160 marks</span>
        <span>ðŸ• 3h total</span>
      </div>
      <div class="conf-bar" id="cb-business"></div>
    </div>
    <div class="subject-card" data-s="engfirst" onclick="goToSubject('engfirst')">
      <div class="color-bar" style="background:linear-gradient(90deg,var(--accent),var(--orange))"></div>
      <div class="code">0500</div>
      <div class="name">English First Language</div>
      <div class="meta">
        <span>ðŸ“„ 2 Papers</span>
        <span>ðŸ“Š 160 marks</span>
        <span>ðŸ• ~3h 45m</span>
      </div>
    </div>
    <div class="subject-card" data-s="englit" onclick="goToSubject('englit')">
      <div class="color-bar" style="background:linear-gradient(90deg,var(--pink),var(--purple))"></div>
      <div class="code">0475</div>
      <div class="name">English Literature</div>
      <div class="meta">
        <span>ðŸ“„ 2â€“4 Papers</span>
        <span>ðŸ“Š 100 marks</span>
        <span>ðŸ• ~3h+</span>
      </div>
    </div>
    <div class="subject-card" data-s="science" onclick="goToSubject('science')">
      <div class="color-bar" style="background:linear-gradient(90deg,var(--red),var(--orange))"></div>
      <div class="code">0654</div>
      <div class="name">Co-ordinated Sciences (Double Award)</div>
      <div class="meta">
        <span>ðŸ“„ 3 Papers</span>
        <span>ðŸ“Š 220 marks</span>
        <span>ðŸ• ~4h 45m</span>
      </div>
      <div class="conf-bar" id="cb-science"></div>
    </div>
    <div class="subject-card" data-s="addmath" onclick="goToSubject('addmath')">
      <div class="color-bar" style="background:linear-gradient(90deg,var(--cyan),var(--blue))"></div>
      <div class="code">0606</div>
      <div class="name">Additional Mathematics</div>
      <div class="meta">
        <span>ðŸ“„ 2 Papers</span>
        <span>ðŸ“Š 160 marks</span>
        <span>ðŸ• 4h total</span>
      </div>
      <div class="conf-bar" id="cb-addmath"></div>
    </div>
    <div class="subject-card" data-s="gp" onclick="goToSubject('gp')">
      <div class="color-bar" style="background:linear-gradient(90deg,var(--teal),var(--green))"></div>
      <div class="code">0457</div>
      <div class="name">Global Perspectives</div>
      <div class="meta">
        <span>ðŸ“„ 3 Components</span>
        <span>ðŸ“Š 200 marks</span>
        <span>ðŸ• Exam + CW</span>
      </div>
      <div class="conf-bar" id="cb-gp"></div>
    </div>
  </div>

  <div class="note" style="margin-top:24px">
    <strong>Note on Grade Boundaries:</strong> The grade thresholds shown in each subject are from the June 2025 session (the most recent available data). Actual 2026 boundaries will be set after your exams are marked and may differ. Use these as approximate targets for your revision.
  </div>

  <div class="streak-panel">
    <h3>Study Habit Tracker</h3>
    <p>Every topic check, flashcard rating, and Pomodoro session contributes to your activity calendar.</p>
    <div class="streak-stats" id="streakStats"></div>
    <div class="streak-label">Last 12 weeks Â· left = older, right = this week Â· darker = more activity</div>
    <div class="streak-grid" id="streakGrid"></div>
  </div>
</div>

<!-- ========== EXAM TRACKER ========== -->
<div class="section" id="tracker">
  <h3>Exam Countdown Tracker</h3>
  <p>All exam dates for the May/June 2026 session from the <strong>Zone 4 final timetable</strong>. ICT practicals start as early as April. Papers are listed in chronological order per subject. Your school will sit one variant of each ICT practical paper â€” confirm which with your exam centre.</p>

  <div class="tracker-grid" id="trackerGrid"></div>

  <div class="note" style="margin-top:24px">
    <strong>Results Day:</strong> Thursday 20 August 2026. Dates are from the official Cambridge Zone 4 final timetable (v1, Oct 2025). AM/PM sessions shown â€” actual start times set by your centre's Key Times.
  </div>
</div>

<!-- ========== ICT ========== -->
<div class="section" id="ict">
  <div class="subject-header">
    <div class="back" onclick="goToSubject('overview')">â† Back to Overview</div>
    <h2>Information & Communication Technology</h2>
    <div class="syllabus-code">0417 Â· Syllabus 2026â€“2028</div>
  </div>

  <div class="detail-tabs">
    <div class="detail-tab active" data-panel="ict-papers">Papers & Marks</div>
    <div class="detail-tab" data-panel="ict-syllabus">Syllabus Topics</div>
    <div class="detail-tab" data-panel="ict-grades">Grade Boundaries</div>
    <div class="detail-tab" data-panel="ict-tips">Exam Strategy</div>
    <div class="detail-tab" data-panel="ict-paperlog" onclick="renderPaperLog('ict')">Paper Log</div>
    <button class="btn-secondary" style="margin-left:auto;font-size:12px;padding:6px 14px" onclick="printRevisionSheet('ict')">ðŸ–¨ï¸ Print Sheet</button>
  </div>

  <div class="detail-panel active" id="ict-papers">
    <div class="info-grid">
      <div class="info-box"><div class="info-label">Total Papers</div><div class="info-value">3</div></div>
      <div class="info-box"><div class="info-label">Total Marks</div><div class="info-value">220</div></div>
      <div class="info-box"><div class="info-label">Grades Available</div><div class="info-value">A*â€“G</div></div>
      <div class="info-box"><div class="info-label">Calculator</div><div class="info-value">N/A</div></div>
    </div>

    <div class="paper-card">
      <h4>Paper 1 â€” Theory</h4>
      <div class="paper-meta">
        <span class="tag">â± 1h 30min</span>
        <span class="tag">ðŸ“Š 80 marks</span>
        <span class="tag">ðŸ“ 40% weighting</span>
      </div>
      <p>Multiple-choice, short-answer & structured questions covering ALL theory sections (Sections 1â€“16). Each question set within a real-world ICT context.</p>
      <p><strong>Key topics:</strong> Input/output devices (OMR, OCR, RFID, NFC, biometrics), storage types, networks (LAN/WAN, protocols, internet), safety & security (encryption, firewalls, backups), impact of ICT (ethical, social, economic), and emerging technologies.</p>
    </div>
    <div class="paper-card">
      <h4>Paper 2 â€” Document Production, Databases & Presentations</h4>
      <div class="paper-meta">
        <span class="tag">â± 2h 30min</span>
        <span class="tag">ðŸ“Š 70 marks</span>
        <span class="tag">ðŸ“ 30% weighting</span>
      </div>
      <p>Practical test. You complete tasks using word processing, database, and presentation software. Tasks must be followed precisely â€” format, content, accuracy all credited. You produce evidence documents and printouts.</p>
      <p><strong>Covers:</strong> Section 17 (Document Production), Section 18 (Databases), Section 19 (Presentations).</p>
    </div>
    <div class="paper-card">
      <h4>Paper 3 â€” Spreadsheets & Data Manipulation</h4>
      <div class="paper-meta">
        <span class="tag">â± 2h 30min</span>
        <span class="tag">ðŸ“Š 70 marks</span>
        <span class="tag">ðŸ“ 30% weighting</span>
      </div>
      <p>Practical test covering spreadsheets, data analysis, and web authoring. You work with formulae, functions, charts, CSS stylesheets, and HTML.</p>
      <p><strong>Covers:</strong> Section 20 (Spreadsheets & Data Graphs), Section 21 (Web Authoring including CSS).</p>
    </div>
    <div class="note">Paper 1 carries 40% of your grade; Papers 2 and 3 each carry 30%. Paper 1 is 80 raw marks; Papers 2 and 3 are 70 raw marks each (220 total raw). File naming and correct save format are mark-bearing â€” don't lose easy marks.</div>
  </div>

  <div class="detail-panel" id="ict-syllabus">
    <h3>Theory Content (Paper 1)</h3>
    <div class="topic-list" id="ict-theory-topics"></div>
    <h3>Practical Content (Papers 2 & 3)</h3>
    <div class="topic-list" id="ict-practical-topics"></div>
  </div>

  <div class="detail-panel" id="ict-grades">
    <h3>Grade Boundaries (June 2025 Reference)</h3>
    <p>Based on June 2025 thresholds. Your 2026 boundaries will be set after marking.</p>
    <table class="grade-table">
      <tr><th>Grade</th><th>Approx. % Needed (Overall)</th><th>Meaning</th></tr>
      <tr><td class="grade-astar">A*</td><td>~80â€“85%+</td><td>Exceptional performance across all papers</td></tr>
      <tr><td class="grade-a">A</td><td>~68â€“75%</td><td>Strong command of theory + accurate practical work</td></tr>
      <tr><td>B</td><td>~55â€“65%</td><td>Good understanding with minor practical errors</td></tr>
      <tr><td>C</td><td>~42â€“50%</td><td>Adequate knowledge, some gaps in practical skills</td></tr>
      <tr><td>D</td><td>~35â€“40%</td><td>Basic understanding</td></tr>
    </table>
    <div class="note">ICT practical papers often have high grade boundaries because marks are awarded for precise output. File format, naming, and exact formatting are critical.</div>
  </div>

  <div class="detail-panel" id="ict-tips">
    <h3>Exam Strategy & Tips</h3>
    <div class="tip-card"><div class="tip-label">Paper 1 Strategy</div>Use correct terminology in every answer â€” "RAM", "protocol", "encryption", not vague terms. Every theory topic from Sections 1â€“16 is examinable. Practise past paper questions under timed conditions.</div>
    <div class="tip-card"><div class="tip-label">Practical Papers</div>Read each task instruction word-by-word. Follow formats exactly (font size, alignment, cell references). Always save in the correct file format. Name files exactly as instructed. Produce screenshots as evidence.</div>
    <div class="tip-card"><div class="tip-label">High-Frequency Topics</div>Spreadsheet functions (IF, VLOOKUP, COUNTIF), mail merge, database queries, CSS classes vs inline styles, and web page structure appear in almost every session.</div>
  </div>
  <div class="detail-panel" id="ict-paperlog"></div>
</div>

<!-- ========== COMPUTER SCIENCE ========== -->
<div class="section" id="cs">
  <div class="subject-header">
    <div class="back" onclick="goToSubject('overview')">â† Back to Overview</div>
    <h2>Computer Science</h2>
    <div class="syllabus-code">0478 Â· Syllabus 2026â€“2028</div>
  </div>

  <div class="detail-tabs">
    <div class="detail-tab active" data-panel="cs-papers">Papers & Marks</div>
    <div class="detail-tab" data-panel="cs-syllabus">Syllabus Topics</div>
    <div class="detail-tab" data-panel="cs-grades">Grade Boundaries</div>
    <div class="detail-tab" data-panel="cs-tips">Exam Strategy</div>
    <div class="detail-tab" data-panel="cs-paperlog" onclick="renderPaperLog('cs')">Paper Log</div>
    <button class="btn-secondary" style="margin-left:auto;font-size:12px;padding:6px 14px" onclick="printRevisionSheet('cs')">ðŸ–¨ï¸ Print Sheet</button>
  </div>

  <div class="detail-panel active" id="cs-papers">
    <div class="info-grid">
      <div class="info-box"><div class="info-label">Total Papers</div><div class="info-value">2</div></div>
      <div class="info-box"><div class="info-label">Total Marks</div><div class="info-value">150</div></div>
      <div class="info-box"><div class="info-label">Grades Available</div><div class="info-value">A*â€“G</div></div>
      <div class="info-box"><div class="info-label">Calculator</div><div class="info-value">Not Allowed</div></div>
    </div>
    <div class="paper-card">
      <h4>Paper 1 â€” Computer Systems</h4>
      <div class="paper-meta">
        <span class="tag">â± 1h 45min</span>
        <span class="tag">ðŸ“Š 75 marks</span>
        <span class="tag">ðŸ“ 50% weighting</span>
      </div>
      <p>Short-answer and structured questions on Topics 1â€“6: Data Representation, Data Transmission, Hardware, Software, The Internet, Automated & Emerging Technologies.</p>
      <p><strong>Most tested:</strong> Binary/hex conversions, logic gates, CPU architecture (fetch-decode-execute), types of memory, network protocols, cybersecurity, AI/robotics.</p>
    </div>
    <div class="paper-card">
      <h4>Paper 2 â€” Algorithms, Programming & Logic</h4>
      <div class="paper-meta">
        <span class="tag">â± 1h 45min</span>
        <span class="tag">ðŸ“Š 75 marks</span>
        <span class="tag">ðŸ“ 50% weighting</span>
      </div>
      <p>Short-answer, structured questions, and a final 15-mark scenario question. Topics 7â€“10: Algorithm Design, Programming, Databases, Boolean Logic.</p>
      <p><strong>Critical:</strong> The final scenario question (15 marks, ~30 min) requires writing a complete algorithm in pseudocode. Trace tables, dry runs, and correcting code are common throughout.</p>
    </div>
  </div>

  <div class="detail-panel" id="cs-syllabus">
    <h3>Paper 1: Computer Systems (Topics 1â€“6)</h3>
    <div class="topic-list" id="cs-topics1"></div>
    <h3>Paper 2: Algorithms & Programming (Topics 7â€“10)</h3>
    <div class="topic-list" id="cs-topics2"></div>
  </div>

  <div class="detail-panel" id="cs-grades">
    <h3>Grade Boundaries (June 2025 â€” Option AX: P1 Var 1 + P2 Var 1)</h3>
    <table class="grade-table">
      <tr><th>Grade</th><th>Overall /150</th><th>Approx %</th></tr>
      <tr><td class="grade-astar">A*</td><td>116</td><td>77%</td></tr>
      <tr><td class="grade-a">A</td><td>94</td><td>63%</td></tr>
      <tr><td>B</td><td>72</td><td>48%</td></tr>
      <tr><td>C</td><td>50</td><td>33%</td></tr>
      <tr><td>D</td><td>42</td><td>28%</td></tr>
      <tr><td>E</td><td>35</td><td>23%</td></tr>
    </table>
    <div class="note">These are from the June 2025 Option AX combination. Your paper variant may differ. Paper 1 A-grade threshold was 45/75 (60%), Paper 2 was 49/75 (65%).</div>
  </div>

  <div class="detail-panel" id="cs-tips">
    <h3>Exam Strategy & Tips</h3>
    <div class="tip-card"><div class="tip-label">Paper 1</div>Learn definitions precisely â€” examiners award marks for correct terminology like "ALU", "protocol", "compiler". Binary/hex questions are free marks with practice. Logic gates: draw truth tables for NAND, NOR, XOR â€” they appear every session.</div>
    <div class="tip-card"><div class="tip-label">Paper 2 â€” Scenario Question</div>Budget 30 minutes for the final 15-mark question. Write in proper pseudocode using the Cambridge notation (not Python). Show DECLARE statements, use proper indentation, and test your logic mentally before writing.</div>
    <div class="tip-card"><div class="tip-label">Trace Tables</div>Show every single step. One wrong variable value cascades errors. Use a ruler to keep rows aligned. Practice at least 10 past paper trace table questions before your exam.</div>
  </div>
  <div class="detail-panel" id="cs-paperlog"></div>
</div>

<!-- ========== BUSINESS STUDIES ========== -->
<div class="section" id="business">
  <div class="subject-header">
    <div class="back" onclick="goToSubject('overview')">â† Back to Overview</div>
    <h2>Business Studies</h2>
    <div class="syllabus-code">0450 Â· Syllabus 2026</div>
  </div>

  <div class="detail-tabs">
    <div class="detail-tab active" data-panel="bus-papers">Papers & Marks</div>
    <div class="detail-tab" data-panel="bus-syllabus">Syllabus Topics</div>
    <div class="detail-tab" data-panel="bus-grades">Grade Boundaries</div>
    <div class="detail-tab" data-panel="bus-tips">Exam Strategy</div>
    <div class="detail-tab" data-panel="bus-paperlog" onclick="renderPaperLog('business')">Paper Log</div>
    <button class="btn-secondary" style="margin-left:auto;font-size:12px;padding:6px 14px" onclick="printRevisionSheet('business')">ðŸ–¨ï¸ Print Sheet</button>
  </div>

  <div class="detail-panel active" id="bus-papers">
    <div class="info-grid">
      <div class="info-box"><div class="info-label">Total Papers</div><div class="info-value">2</div></div>
      <div class="info-box"><div class="info-label">Total Marks</div><div class="info-value">160</div></div>
      <div class="info-box"><div class="info-label">Grades Available</div><div class="info-value">A*â€“G</div></div>
      <div class="info-box"><div class="info-label">Calculator</div><div class="info-value">Allowed</div></div>
    </div>
    <div class="paper-card">
      <h4>Paper 1 â€” Short Answer & Data Response</h4>
      <div class="paper-meta">
        <span class="tag">â± 1h 30min</span>
        <span class="tag">ðŸ“Š 80 marks</span>
        <span class="tag">ðŸ“ 50% weighting</span>
      </div>
      <p>Four questions with short answers and structured data responses. Each question introduced by stimulus material (tables, graphs, images). Covers the entire syllabus. Tests AO1â€“AO4 (Knowledge, Application, Analysis, Evaluation).</p>
    </div>
    <div class="paper-card">
      <h4>Paper 2 â€” Case Study</h4>
      <div class="paper-meta">
        <span class="tag">â± 1h 30min</span>
        <span class="tag">ðŸ“Š 80 marks</span>
        <span class="tag">ðŸ“ 50% weighting</span>
      </div>
      <p>Four questions based on a case study provided as an insert. Appendices include data in tables, graphs, newspaper extracts, adverts. You MUST use the case context in every answer â€” generic theory scores limited marks.</p>
      <p><strong>Key skills:</strong> Break-even calculations, profit/loss, cash flow analysis, ratio interpretation. Always show working and include units.</p>
    </div>
  </div>

  <div class="detail-panel" id="bus-syllabus">
    <h3>All Syllabus Sections</h3>
    <div class="topic-list" id="bus-topics"></div>
  </div>

  <div class="detail-panel" id="bus-grades">
    <h3>Grade Boundaries (June 2025 Reference)</h3>
    <table class="grade-table">
      <tr><th>Grade</th><th>Approx. Overall %</th><th>Notes</th></tr>
      <tr><td class="grade-astar">A*</td><td>~78â€“85%</td><td>Strong evaluation skills + accurate calculations</td></tr>
      <tr><td class="grade-a">A</td><td>~65â€“72%</td><td>Good application to case study</td></tr>
      <tr><td>B</td><td>~52â€“60%</td><td>Solid knowledge with some analysis</td></tr>
      <tr><td>C</td><td>~40â€“48%</td><td>Adequate understanding of core concepts</td></tr>
    </table>
  </div>

  <div class="detail-panel" id="bus-tips">
    <h3>Exam Strategy & Tips</h3>
    <div class="tip-card"><div class="tip-label">Command Words</div>"Define" = precise 1â€“2 line definition. "Explain" = cause + effect. "Analyse" = develop with reference to the case. "Evaluate" = balanced discussion + justified recommendation. Match your answer to the verb.</div>
    <div class="tip-card"><div class="tip-label">Case Study (Paper 2)</div>Read the case thoroughly before answering. Use the company name, specific data, and context in EVERY answer. Own knowledge supports the case â€” it doesn't replace it. Practice reading pre-release material under timed conditions.</div>
    <div class="tip-card"><div class="tip-label">Calculations</div>Memorise: Break-even = Fixed Costs Ã· (Selling Price â€“ Variable Cost). Profit = Revenue â€“ Total Costs. Gross Profit Margin = (Gross Profit Ã· Revenue) Ã— 100. Always show your working and include currency/percentage symbols.</div>
  </div>
  <div class="detail-panel" id="bus-paperlog"></div>
</div>

<!-- ========== ENGLISH FIRST LANGUAGE ========== -->
<div class="section" id="engfirst">
  <div class="subject-header">
    <div class="back" onclick="goToSubject('overview')">â† Back to Overview</div>
    <h2>English â€” First Language</h2>
    <div class="syllabus-code">0500 Â· Syllabus 2024â€“2026</div>
  </div>

  <div class="detail-tabs">
    <div class="detail-tab active" data-panel="ef-papers">Papers & Marks</div>
    <div class="detail-tab" data-panel="ef-grades">Grade Boundaries</div>
    <div class="detail-tab" data-panel="ef-tips">Exam Strategy</div>
    <div class="detail-tab" data-panel="ef-paperlog" onclick="renderPaperLog('engfirst')">Paper Log</div>
    <button class="btn-secondary" style="margin-left:auto;font-size:12px;padding:6px 14px" onclick="printRevisionSheet('engfirst')">ðŸ–¨ï¸ Print Sheet</button>
  </div>

  <div class="detail-panel active" id="ef-papers">
    <div class="info-grid">
      <div class="info-box"><div class="info-label">Papers Required</div><div class="info-value">2</div></div>
      <div class="info-box"><div class="info-label">Grades Available</div><div class="info-value">A*â€“G</div></div>
      <div class="info-box"><div class="info-label">Optional Comp</div><div class="info-value">Speaking/Listening</div></div>
      <div class="info-box"><div class="info-label">Focus</div><div class="info-value">Reading + Writing</div></div>
    </div>
    <div class="paper-card">
      <h4>Paper 1 â€” Reading</h4>
      <div class="paper-meta">
        <span class="tag">â± 2 hours</span>
        <span class="tag">ðŸ“Š 80 marks</span>
        <span class="tag">ðŸ“ 50% weighting</span>
      </div>
      <p>Questions based on two or three texts. Tests explicit and implicit understanding, inference, analysis of writer's craft, and the ability to select and use information. Also includes a shorter writing task (summary or directed writing).</p>
      <p><strong>Assessment Objectives:</strong> R1 (explicit meanings), R2 (implicit meanings & attitudes), R3 (analysis of writer's effects), R5 (select & use information), plus W2, W3, W5 for the writing task.</p>
    </div>
    <div class="paper-card">
      <h4>Paper 2 â€” Directed Writing & Composition</h4>
      <div class="paper-meta">
        <span class="tag">â± 2 hours</span>
        <span class="tag">ðŸ“Š 80 marks</span>
        <span class="tag">ðŸ“ 50% weighting</span>
      </div>
      <p>Section A: Directed writing task using a reading text. Section B: Free composition â€” choice of descriptive or narrative writing. This is where the highest-quality creative writing is rewarded.</p>
      <p><strong>Key skills:</strong> Vocabulary range, sentence variety, structural control, accurate SPaG, vivid imagery, effective openings and endings.</p>
    </div>
    <div class="paper-card" style="border-color: var(--text3);">
      <h4>Component 4 â€” Speaking & Listening (Optional)</h4>
      <div class="paper-meta">
        <span class="tag">â± ~10â€“12 min</span>
        <span class="tag">ðŸ“ Separately endorsed</span>
      </div>
      <p>Does NOT contribute to your overall grade. Graded 1 (highest) to 5 separately. Only take if your school offers it and you want the endorsement on your certificate.</p>
    </div>
  </div>

  <div class="detail-panel" id="ef-grades">
    <h3>Grade Boundaries (June 2025 Reference)</h3>
    <table class="grade-table">
      <tr><th>Grade</th><th>Approx. Overall %</th><th>Notes</th></tr>
      <tr><td class="grade-astar">A*</td><td>~75â€“82%</td><td>Exceptional language control + sophisticated analysis</td></tr>
      <tr><td class="grade-a">A</td><td>~62â€“70%</td><td>Confident, fluent writing + strong reading comprehension</td></tr>
      <tr><td>B</td><td>~50â€“58%</td><td>Competent with occasional lapses in precision</td></tr>
      <tr><td>C</td><td>~38â€“45%</td><td>Adequate understanding and basic writing accuracy</td></tr>
    </table>
  </div>

  <div class="detail-panel" id="ef-tips">
    <h3>Exam Strategy & Tips</h3>
    <div class="tip-card"><div class="tip-label">Reading Paper</div>Quote precisely but briefly. Always explain the EFFECT of the writer's choice â€” don't just identify techniques. Use the PEE structure: Point â†’ Evidence â†’ Explanation of effect. For summary questions, be concise and avoid lifting whole sentences.</div>
    <div class="tip-card"><div class="tip-label">Composition</div>Plan for 5 minutes before writing. Use a variety of sentence lengths. Open with something striking â€” not "It was a dark and stormy night." End deliberately. Descriptive writing should engage ALL senses. Narrative should have a clear arc with tension.</div>
    <div class="tip-card"><div class="tip-label">SPaG Matters</div>Spelling, punctuation, and grammar are assessed in EVERY writing task. Use semicolons, colons, and dashes correctly for instant sophistication. Avoid comma splices â€” they're the most common error.</div>
  </div>
  <div class="detail-panel" id="ef-paperlog"></div>
</div>

<!-- ========== ENGLISH LITERATURE ========== -->
<div class="section" id="englit">
  <div class="subject-header">
    <div class="back" onclick="goToSubject('overview')">â† Back to Overview</div>
    <h2>Literature in English</h2>
    <div class="syllabus-code">0475 Â· Syllabus 2026</div>
  </div>

  <div class="detail-tabs">
    <div class="detail-tab active" data-panel="el-papers">Papers & Marks</div>
    <div class="detail-tab" data-panel="el-grades">Grade Boundaries</div>
    <div class="detail-tab" data-panel="el-tips">Exam Strategy</div>
    <div class="detail-tab" data-panel="el-paperlog" onclick="renderPaperLog('englit')">Paper Log</div>
    <button class="btn-secondary" style="margin-left:auto;font-size:12px;padding:6px 14px" onclick="printRevisionSheet('englit')">ðŸ–¨ï¸ Print Sheet</button>
  </div>

  <div class="detail-panel active" id="el-papers">
    <div class="info-grid">
      <div class="info-box"><div class="info-label">Compulsory</div><div class="info-value">Paper 1</div></div>
      <div class="info-box"><div class="info-label">Choose From</div><div class="info-value">3 Routes</div></div>
      <div class="info-box"><div class="info-label">Grades</div><div class="info-value">A*â€“G</div></div>
      <div class="info-box"><div class="info-label">Texts</div><div class="info-value">Set Texts</div></div>
    </div>
    <div class="paper-card">
      <h4>Paper 1 â€” Poetry & Prose (Compulsory)</h4>
      <div class="paper-meta">
        <span class="tag">â± 1h 30min</span>
        <span class="tag">ðŸ“Š 50 marks</span>
        <span class="tag">ðŸ“ 50% weighting</span>
      </div>
      <p>Two questions on two set texts: one poetry and one prose. Questions require close analysis of language, structure, and themes. You must demonstrate detailed knowledge of the text and offer a personal, informed response.</p>
    </div>
    <div class="paper-card">
      <h4>Paper 2 â€” Drama (Option A)</h4>
      <div class="paper-meta">
        <span class="tag">â± 1h 30min</span>
        <span class="tag">ðŸ“Š 50 marks</span>
        <span class="tag">ðŸ“ 50% weighting</span>
      </div>
      <p>Two questions on two drama texts (closed book). OR you can take the Paper 3 + Paper 4 / Coursework route instead.</p>
    </div>
    <div class="paper-card" style="border-color: var(--text3)">
      <h4>Alternative Route: Paper 3 (Open Text) + Paper 4 (Unseen) or Coursework</h4>
      <div class="paper-meta">
        <span class="tag">Paper 3: 45min, 25 marks (25%)</span>
        <span class="tag">Paper 4: 1h 15min, 25 marks (25%)</span>
      </div>
      <p>Paper 3: One drama question (open book). Paper 4: One unseen critical commentary question. OR Paper 3 + Component 5 (Coursework). Check with your school which route you're taking.</p>
    </div>
  </div>

  <div class="detail-panel" id="el-grades">
    <h3>Grade Boundaries (June 2025 Reference)</h3>
    <table class="grade-table">
      <tr><th>Grade</th><th>Approx. Overall %</th><th>Notes</th></tr>
      <tr><td class="grade-astar">A*</td><td>~75â€“82%</td><td>Sophisticated personal response + precise textual analysis</td></tr>
      <tr><td class="grade-a">A</td><td>~60â€“70%</td><td>Confident engagement with texts, well-supported arguments</td></tr>
      <tr><td>B</td><td>~48â€“56%</td><td>Good knowledge with some analytical depth</td></tr>
      <tr><td>C</td><td>~36â€“44%</td><td>Adequate understanding of themes and characters</td></tr>
    </table>
  </div>

  <div class="detail-panel" id="el-tips">
    <h3>Exam Strategy & Tips</h3>
    <div class="tip-card"><div class="tip-label">Know Your Texts</div>There is no substitute for knowing your set texts inside out. Memorise 3â€“5 key quotes per character/theme for each text. Practise writing about them under timed conditions. You cannot bring texts into Paper 1 or Paper 2.</div>
    <div class="tip-card"><div class="tip-label">Personal Response</div>Examiners want YOUR interpretation, not a textbook answer. Use phrases like "This suggestsâ€¦", "The reader might feelâ€¦", "This creates an atmosphere ofâ€¦". Avoid retelling the plot â€” analyse, don't narrate.</div>
    <div class="tip-card"><div class="tip-label">Language Analysis</div>Comment on specific word choices, imagery, metre (for poetry), and dramatic techniques (for drama). Always link technique â†’ effect on reader â†’ broader theme.</div>
  </div>
  <div class="detail-panel" id="el-paperlog"></div>
</div>

<!-- ========== COMBINED SCIENCE ========== -->
<div class="section" id="science">
  <div class="subject-header">
    <div class="back" onclick="goToSubject('overview')">â† Back to Overview</div>
    <h2>Co-ordinated Sciences (Double Award)</h2>
    <div class="syllabus-code">0654 Â· Syllabus 2025â€“2027</div>
  </div>

  <div class="detail-tabs">
    <div class="detail-tab active" data-panel="sci-papers">Papers & Marks</div>
    <div class="detail-tab" data-panel="sci-syllabus">Syllabus Topics</div>
    <div class="detail-tab" data-panel="sci-grades">Grade Boundaries</div>
    <div class="detail-tab" data-panel="sci-tips">Exam Strategy</div>
    <div class="detail-tab" data-panel="sci-paperlog" onclick="renderPaperLog('science')">Paper Log</div>
    <button class="btn-secondary" style="margin-left:auto;font-size:12px;padding:6px 14px" onclick="printRevisionSheet('science')">ðŸ–¨ï¸ Print Sheet</button>
  </div>

  <div class="detail-panel active" id="sci-papers">
    <div class="info-grid">
      <div class="info-box"><div class="info-label">Papers (Extended)</div><div class="info-value">3</div></div>
      <div class="info-box"><div class="info-label">Total Marks</div><div class="info-value">220</div></div>
      <div class="info-box"><div class="info-label">Award</div><div class="info-value">Double (2 grades)</div></div>
      <div class="info-box"><div class="info-label">Calculator</div><div class="info-value">Allowed</div></div>
    </div>
    <div class="note">Co-ordinated Sciences is a <strong>Double Award</strong> â€” you receive TWO IGCSE grades (e.g. A*A*, AB, etc.). Extended candidates take Paper 2 + Paper 4 + Paper 5 or 6, eligible for grades A*A* to GG. Core candidates take Paper 1 + Paper 3 + Paper 5/6 (max grade CC).</div>
    <div class="paper-card">
      <h4>Paper 2 â€” Multiple Choice (Extended)</h4>
      <div class="paper-meta">
        <span class="tag">â± 45 min</span>
        <span class="tag">ðŸ“Š 40 marks</span>
        <span class="tag">ðŸ“ 30% weighting</span>
      </div>
      <p>40 four-option MCQs covering Core + Supplement content across Biology, Chemistry, and Physics.</p>
    </div>
    <div class="paper-card">
      <h4>Paper 4 â€” Theory (Extended)</h4>
      <div class="paper-meta">
        <span class="tag">â± 2 hours</span>
        <span class="tag">ðŸ“Š 120 marks</span>
        <span class="tag">ðŸ“ 50% weighting</span>
      </div>
      <p>Short-answer and structured questions covering all three sciences (Core + Supplement). This is the heaviest paper at 50% â€” focus your revision here. Questions test knowledge, application, and data handling.</p>
    </div>
    <div class="paper-card">
      <h4>Paper 5 â€” Practical Test OR Paper 6 â€” Alternative to Practical</h4>
      <div class="paper-meta">
        <span class="tag">â± P5: 2h | P6: 1h 30m</span>
        <span class="tag">ðŸ“Š 60 marks</span>
        <span class="tag">ðŸ“ 20% weighting</span>
      </div>
      <p>Paper 5: Hands-on practical exam (6â€“7 exercises across all three sciences, one planning question). Paper 6: Written alternative testing experimental skills without lab work. Your school chooses which one you sit.</p>
    </div>
  </div>

  <div class="detail-panel" id="sci-syllabus">
    <h3>Biology Topics (B1â€“B19)</h3>
    <div class="topic-list" id="sci-bio-topics"></div>
    <h3>Chemistry Topics (C1â€“C12)</h3>
    <div class="topic-list" id="sci-chem-topics"></div>
    <h3>Physics Topics (P1â€“P6)</h3>
    <div class="topic-list" id="sci-phys-topics"></div>
  </div>

  <div class="detail-panel" id="sci-grades">
    <h3>Grade Boundaries (June 2025 Reference â€” Extended)</h3>
    <table class="grade-table">
      <tr><th>Grade</th><th>Approx. Overall %</th><th>Notes</th></tr>
      <tr><td class="grade-astar">A*A*</td><td>~78â€“85%</td><td>Excellent across all three sciences + strong practical skills</td></tr>
      <tr><td class="grade-a">AA</td><td>~65â€“72%</td><td>Confident recall + accurate application</td></tr>
      <tr><td>BB</td><td>~52â€“60%</td><td>Good understanding with minor gaps</td></tr>
      <tr><td>CC</td><td>~38â€“48%</td><td>Adequate knowledge across sciences</td></tr>
    </table>
    <div class="note">Co-ordinated Sciences awards TWO grades. Boundaries above are approximate based on June 2025 data. The two grades can differ (e.g. AB) depending on your performance across sciences.</div>
  </div>

  <div class="detail-panel" id="sci-tips">
    <h3>Exam Strategy & Tips</h3>
    <div class="tip-card"><div class="tip-label">Paper 4 is King (50%)</div>At 120 marks and 2 hours, Paper 4 is where your grade is largely decided. Practise structured questions under timed conditions. Show all working for calculations â€” method marks are available even if the final answer is wrong.</div>
    <div class="tip-card"><div class="tip-label">Balance Your Revision</div>Don't neglect any of the three sciences. Physics (especially calculations) is often where students lose marks. Dedicate roughly equal time to Bio, Chem, and Physics. The MCQ paper covers all three equally.</div>
    <div class="tip-card"><div class="tip-label">Supplement Content</div>Extended paper questions often focus heavily on Supplement material (the starred content). Prioritise learning these topics â€” they separate A*A*/AA from BB/CC.</div>
    <div class="tip-card"><div class="tip-label">Practical Skills</div>Whether Paper 5 or 6: know how to draw graphs correctly (labels, units, line of best fit), record measurements with correct significant figures, identify variables (independent, dependent, controlled), and evaluate experimental procedures. The planning question can come from any science.</div>
  </div>
  <div class="detail-panel" id="sci-paperlog"></div>
</div>

<!-- ========== ADDITIONAL MATHS ========== -->
<div class="section" id="addmath">
  <div class="subject-header">
    <div class="back" onclick="goToSubject('overview')">â† Back to Overview</div>
    <h2>Additional Mathematics</h2>
    <div class="syllabus-code">0606 Â· Syllabus 2025â€“2027</div>
  </div>

  <div class="detail-tabs">
    <div class="detail-tab active" data-panel="am-papers">Papers & Marks</div>
    <div class="detail-tab" data-panel="am-syllabus">Syllabus Topics</div>
    <div class="detail-tab" data-panel="am-grades">Grade Boundaries</div>
    <div class="detail-tab" data-panel="am-tips">Exam Strategy</div>
    <div class="detail-tab" data-panel="am-paperlog" onclick="renderPaperLog('addmath')">Paper Log</div>
    <button class="btn-secondary" style="margin-left:auto;font-size:12px;padding:6px 14px" onclick="printRevisionSheet('addmath')">ðŸ–¨ï¸ Print Sheet</button>
  </div>

  <div class="detail-panel active" id="am-papers">
    <div class="info-grid">
      <div class="info-box"><div class="info-label">Total Papers</div><div class="info-value">2</div></div>
      <div class="info-box"><div class="info-label">Total Marks</div><div class="info-value">160</div></div>
      <div class="info-box"><div class="info-label">Grades Available</div><div class="info-value">A*â€“E only</div></div>
      <div class="info-box"><div class="info-label">Formula Booklet</div><div class="info-value">None!</div></div>
    </div>
    <div class="paper-card">
      <h4>Paper 1 â€” Non-Calculator</h4>
      <div class="paper-meta">
        <span class="tag">â± 2 hours</span>
        <span class="tag">ðŸ“Š 80 marks</span>
        <span class="tag">ðŸ“ 50% weighting</span>
        <span class="tag" style="color:var(--red)">ðŸš« No Calculator</span>
      </div>
      <p>Strong emphasis on algebraic manipulation and exact values. Questions range from short single-topic items to multi-part problems. Full syllabus is examinable. You must recall ALL formulae and identities.</p>
    </div>
    <div class="paper-card">
      <h4>Paper 2 â€” Calculator</h4>
      <div class="paper-meta">
        <span class="tag">â± 2 hours</span>
        <span class="tag">ðŸ“Š 80 marks</span>
        <span class="tag">ðŸ“ 50% weighting</span>
        <span class="tag" style="color:var(--green)">âœ… Calculator Allowed</span>
      </div>
      <p>Often contains real-life application problems and kinematics. Same syllabus coverage as Paper 1. Calculator reduces arithmetic burden but doesn't replace understanding.</p>
    </div>
    <div class="note" style="border-left-color:var(--red)"><strong>Critical:</strong> No formula booklet is provided for 0606. You MUST memorise differentiation/integration rules, trig identities, binomial theorem, and all key formulae. Unsupported calculator answers get zero marks â€” always show working.</div>
  </div>

  <div class="detail-panel" id="am-syllabus">
    <h3>All Topics</h3>
    <div class="topic-list" id="am-topics"></div>
  </div>

  <div class="detail-panel" id="am-grades">
    <h3>Grade Boundaries (June 2025 Reference)</h3>
    <table class="grade-table">
      <tr><th>Grade</th><th>Approx. Overall %</th><th>Notes</th></tr>
      <tr><td class="grade-astar">A*</td><td>~80â€“88%</td><td>Near-flawless algebraic manipulation + calculus</td></tr>
      <tr><td class="grade-a">A</td><td>~65â€“75%</td><td>Strong across all topic areas</td></tr>
      <tr><td>B</td><td>~50â€“60%</td><td>Good understanding, occasional errors in harder topics</td></tr>
      <tr><td>C</td><td>~38â€“48%</td><td>Sound on core topics, struggles with multi-step problems</td></tr>
      <tr><td>D</td><td>~28â€“35%</td><td>Basic competence</td></tr>
      <tr><td>E</td><td>~20â€“25%</td><td>Minimum pass â€” below this is Unclassified</td></tr>
    </table>
    <div class="note">Add Maths only awards grades A*â€“E. There are no F or G grades. If you don't reach the E threshold, you receive U (Unclassified).</div>
  </div>

  <div class="detail-panel" id="am-tips">
    <h3>Exam Strategy & Tips</h3>
    <div class="tip-card"><div class="tip-label">Paper 1 (No Calculator)</div>Practice surds, exact trig values (sin 30Â°, cos 45Â°, etc.), and algebraic long division without a calculator. Every Paper 1 requires you to leave answers in exact form (e.g., 3âˆš2, not 4.243).</div>
    <div class="tip-card"><div class="tip-label">Calculus</div>Differentiation and integration appear in every single paper. Know: power rule, chain rule, product rule, trig derivatives, area under curves, stationary points, tangent/normal equations. Practice setting up equations from word problems.</div>
    <div class="tip-card"><div class="tip-label">"Hence" and "Show That"</div>"Hence" means USE your previous answer. "Show that" means the answer is given â€” you must prove it step-by-step. If you can't do part (a), you can still attempt part (b) using the given result.</div>
  </div>
  <div class="detail-panel" id="am-paperlog"></div>
</div>

<!-- ========== GLOBAL PERSPECTIVES ========== -->
<div class="section" id="gp">
  <div class="subject-header">
    <div class="back" onclick="goToSubject('overview')">â† Back to Overview</div>
    <h2>Global Perspectives</h2>
    <div class="syllabus-code">0457 Â· Syllabus 2025â€“2027</div>
  </div>

  <div class="detail-tabs">
    <div class="detail-tab active" data-panel="gp-papers">Components & Marks</div>
    <div class="detail-tab" data-panel="gp-syllabus">Topics</div>
    <div class="detail-tab" data-panel="gp-grades">Grade Boundaries</div>
    <div class="detail-tab" data-panel="gp-tips">Exam Strategy</div>
    <div class="detail-tab" data-panel="gp-paperlog" onclick="renderPaperLog('gp')">Paper Log</div>
    <button class="btn-secondary" style="margin-left:auto;font-size:12px;padding:6px 14px" onclick="printRevisionSheet('gp')">ðŸ–¨ï¸ Print Sheet</button>
  </div>

  <div class="detail-panel active" id="gp-papers">
    <div class="info-grid">
      <div class="info-box"><div class="info-label">Components</div><div class="info-value">3</div></div>
      <div class="info-box"><div class="info-label">Total Marks</div><div class="info-value">200</div></div>
      <div class="info-box"><div class="info-label">Grades</div><div class="info-value">A*â€“G</div></div>
      <div class="info-box"><div class="info-label">Coursework</div><div class="info-value">65%</div></div>
    </div>
    <div class="paper-card">
      <h4>Component 1 â€” Written Exam</h4>
      <div class="paper-meta">
        <span class="tag">â± 1h 25min</span>
        <span class="tag">ðŸ“Š 70 marks</span>
        <span class="tag">ðŸ“ 35% weighting</span>
      </div>
      <p>Four compulsory questions based on source documents about a global issue. Sources may include articles, data sets, personal testimonies, and images. You analyse, evaluate arguments, and make reasoned judgements.</p>
      <p><strong>Q1 (~14 marks):</strong> Identify/describe patterns from data. <strong>Q2 (~20 marks):</strong> Analyse arguments. <strong>Q3 (~16 marks):</strong> Evaluate quality of arguments. <strong>Q4 (~20 marks):</strong> Assess actions and explain judgements with evidence.</p>
    </div>
    <div class="paper-card">
      <h4>Component 2 â€” Individual Report</h4>
      <div class="paper-meta">
        <span class="tag">ðŸ“Š 60 marks</span>
        <span class="tag">ðŸ“ 30% weighting</span>
        <span class="tag">ðŸ“ 1500â€“2000 words</span>
      </div>
      <p>A research essay on a global question from the topic list. Must be your own work. Externally marked by Cambridge. Choose a topic you're genuinely interested in â€” quality of research and personal reflection matter.</p>
    </div>
    <div class="paper-card">
      <h4>Component 3 â€” Team Project</h4>
      <div class="paper-meta">
        <span class="tag">ðŸ“Š 70 marks</span>
        <span class="tag">ðŸ“ 35% weighting</span>
        <span class="tag">ðŸ¤ Collaborative</span>
      </div>
      <p>A team-based project: Explanation of Research & Planning (300â€“400 words, team), Evidence of Action (team), and a Reflective Paper (750â€“1000 words, individual). Internally assessed, externally moderated.</p>
    </div>
  </div>

  <div class="detail-panel" id="gp-syllabus">
    <h3>Topic List</h3>
    <p>The exam and coursework draw from these global topics. You study a selection, not all of them.</p>
    <div class="topic-list" id="gp-topics"></div>
  </div>

  <div class="detail-panel" id="gp-grades">
    <h3>Grade Boundaries (June 2025 Reference)</h3>
    <table class="grade-table">
      <tr><th>Grade</th><th>Approx. Overall %</th><th>Notes</th></tr>
      <tr><td class="grade-astar">A*</td><td>~78â€“85%</td><td>Outstanding critical analysis + excellent research</td></tr>
      <tr><td class="grade-a">A</td><td>~65â€“72%</td><td>Strong evaluation and well-structured arguments</td></tr>
      <tr><td>B</td><td>~52â€“60%</td><td>Good analysis with clear reasoning</td></tr>
      <tr><td>C</td><td>~40â€“48%</td><td>Adequate skills demonstration</td></tr>
    </table>
  </div>

  <div class="detail-panel" id="gp-tips">
    <h3>Exam Strategy & Tips</h3>
    <div class="tip-card"><div class="tip-label">Written Exam</div>You're assessed on SKILLS, not knowledge of the topic. Read sources carefully before writing. For Q4: always give reasons AND evidence for your judgements. Balanced, evaluative responses score highest.</div>
    <div class="tip-card"><div class="tip-label">Individual Report</div>Stay within 1500â€“2000 words. Structure clearly: introduction, research findings, analysis, personal reflection, conclusion. Use a variety of sources (not just websites â€” include academic articles, reports, data). Cite everything.</div>
    <div class="tip-card"><div class="tip-label">Team Project</div>Keep the Explanation of Research & Planning under 400 words â€” marks stop at 400. Evidence of Action should show what you DID, not just your research. Your Reflective Paper is individual â€” focus on YOUR contribution and learning.</div>
  </div>
  <div class="detail-panel" id="gp-paperlog"></div>
</div>

<!-- ========== TIMETABLE ========== -->
<div class="section" id="timetable">
  <h3>Study Timetable</h3>
  <p>Auto-generated daily schedule weighted by exam proximity and topic count. ICT practicals are prioritised before April â€” scroll right on smaller screens.</p>
  <div class="tt-nav">
    <button class="tt-nav-btn" onclick="ttPrev()">â† Prev</button>
    <div class="tt-week-label" id="ttLabel"></div>
    <button class="tt-nav-btn" onclick="ttNext()">Next â†’</button>
  </div>
  <div id="ttGradeNote" class="tt-grade-note"></div>
  <div class="tt-legend" id="ttLegend"></div>
  <div class="tt-grid" id="ttGrid"></div>
</div>

<!-- ========== PAST PAPERS ========== -->
<div class="section" id="papers">
  <h3>Past Papers Hub</h3>
  <p>Official Cambridge IGCSE past papers are published on the Cambridge International website. Free access is also available via the resource sites below. Papers from 2019â€“2024 are the most useful for the current syllabus.</p>
  <div class="note" style="margin-bottom:24px">
    <strong>Best approach:</strong> Work through the most recent 3â€“4 sessions under timed conditions, then check every answer against the mark scheme before moving to an older paper. Use examiner reports to understand why marks are awarded the way they are.
  </div>
  <div class="pp-grid" id="ppGrid"></div>
</div>

<!-- ========== PROGRESS ========== -->
<div class="section" id="progress">
  <h3>Progress Tracker</h3>
  <p>Log your past paper scores here. Your percentage and predicted grade are shown automatically using June 2025 grade boundaries as a reference.</p>

  <div id="astarPanel"></div>

  <div class="import-toggle" onclick="toggleImportPanel()">
    ðŸ“¤ Import Grades from Image / PDF â€” upload your results to enter scores side-by-side
  </div>
  <div class="import-panel" id="importPanel">
    <p style="color:var(--text3);font-size:12px;margin-bottom:16px">Upload a photo or PDF of your grades report. View it on the left while you fill in your scores on the right.</p>
    <div class="import-split">
      <div>
        <input type="file" id="importFile" accept="image/*,.pdf" onchange="onImportFile(event)" style="font-size:12px;color:var(--text2);margin-bottom:12px;display:block">
        <div class="import-preview" id="importPreview">
          <div class="placeholder">ðŸ“„ Upload an image or PDF<br>to preview your grades here</div>
        </div>
      </div>
      <div>
        <p style="font-size:12px;color:var(--text3);margin-bottom:10px">Fill in while viewing your sheet:</p>
        <table class="import-entry-table" id="importTable"></table>
        <div class="import-actions">
          <button class="btn-import" onclick="importAllScores()">Import Filled Scores</button>
          <button class="btn-import-sec" onclick="clearImportForm()">Clear</button>
        </div>
      </div>
    </div>
  </div>

  <div class="score-form" id="scoreForm">
    <label>Subject
      <select id="sf-subject" onchange="onSubjectChange()">
        <option value="ict">ICT (0417)</option>
        <option value="cs">Computer Science (0478)</option>
        <option value="business">Business Studies (0450)</option>
        <option value="engfirst">English 1st Lang (0500)</option>
        <option value="englit">English Lit (0475)</option>
        <option value="science">Co-ord Sciences (0654)</option>
        <option value="addmath">Add Maths (0606)</option>
        <option value="gp">Global Perspectives (0457)</option>
      </select>
    </label>
    <label>Paper
      <select id="sf-paper" onchange="onPaperChange()"></select>
    </label>
    <label>Session
      <input id="sf-session" type="text" placeholder="e.g. June 2024">
    </label>
    <label>Score
      <input id="sf-score" type="number" min="0" placeholder="e.g. 62">
    </label>
    <label>Out of
      <input id="sf-max" type="number" min="1" placeholder="e.g. 80">
    </label>
    <button class="btn-log" onclick="logScore()">Log Score</button>
  </div>

  <div id="scoreResults"></div>
</div>

<!-- ========== GRADE CALCULATOR ========== -->
<div class="section" id="gradecalc">
  <h3>Grade Calculator</h3>
  <p class="section-intro">Enter scores for papers you've already sat (or predicted scores) to see what you need on remaining papers to hit each grade.</p>
  <div class="gc-grid" id="gcGrid"></div>
</div>

<!-- ========== FORMULA SHEET ========== -->
<div class="section" id="formulae">
  <h3>Formula Sheet</h3>
  <p class="section-intro">Every formula from your revision notes, grouped by subject. <button class="btn-print" onclick="window.print()">ðŸ–¨ Print</button></p>
  <div id="formulaSheet"></div>
</div>

<!-- ========== FLASHCARDS ========== -->
<div class="section" id="flashcards">
  <h3>Flashcards</h3>
  <p class="section-intro">Flip through topic cards to test your recall. Quiz mode pulls 5 random cards â€” rate yourself to update your review schedule.</p>
  <div class="fc-controls">
    <select id="fcSubject" onchange="initFlashcards()">
      <option value="all">All Subjects</option>
      <option value="ict">ICT</option>
      <option value="cs">Computer Science</option>
      <option value="business">Business Studies</option>
      <option value="science">Sciences</option>
      <option value="addmath">Add Maths</option>
      <option value="gp">Global Perspectives</option>
    </select>
    <button class="btn-secondary" onclick="startQuiz()">âš¡ Quiz Mode (5 cards)</button>
    <button class="btn-secondary" onclick="shuffleFlashcards()">ðŸ”€ Shuffle</button>
    <button class="btn-secondary" onclick="startMockExam()">ðŸ“ Mock Exam (20 cards)</button>
  </div>
  <div id="fcDeck">
    <div class="fc-card" id="fcCard" onclick="flipCard()">
      <div class="fc-inner" id="fcInner">
        <div class="fc-front" id="fcFront"></div>
        <div class="fc-back" id="fcBack"></div>
      </div>
    </div>
    <div class="fc-nav">
      <button class="btn-secondary" onclick="prevCard()">â† Prev</button>
      <span id="fcCounter" class="fc-counter">1 / 1</span>
      <button class="btn-secondary" onclick="nextCard()">Next â†’</button>
    </div>
    <div class="fc-rate" id="fcRate" style="display:none">
      <span class="fc-rate-label">How did you do?</span>
      <button class="btn-rate fail" onclick="rateCard(false)">âœ— Missed it</button>
      <button class="btn-rate pass" onclick="rateCard(true)">âœ“ Got it</button>
    </div>
  </div>
</div>

<!-- ========== REVIEW QUEUE ========== -->
<div class="section" id="reviewqueue">
  <h3>Review Queue</h3>
  <p class="section-intro">Topics due for review today based on your spaced repetition schedule. Complete them to keep your intervals on track.</p>
  <div id="rqContent"></div>
</div>

</main>

<!-- EXAM BRIEFING MODAL -->
<div id="examBriefing" class="exam-briefing-modal hidden" onclick="closeExamBriefingOverlay(event)">
  <div class="eb-card">
    <button class="eb-close" onclick="closeExamBriefing()">âœ•</button>
    <div id="ebContent"></div>
  </div>
</div>

<!-- ZONE PICKER MODAL -->
<div id="zoneModal" class="zone-modal-overlay hidden" onclick="closeZoneModalOverlay(event)">
  <div class="zone-modal">
    <h2>ðŸŒ Select Your Exam Zone</h2>
    <p>Cambridge runs exams at different times across the world. Pick the zone your school is in â€” exam dates and paper codes will update automatically.</p>
    <div class="zone-options">
      <div class="zone-option" onclick="applyZone('Z1')"><span class="zo-badge">Zone 1</span><div><div class="zo-label">UK, Europe &amp; Middle East</div><div class="zo-region">United Kingdom Â· Germany Â· France Â· UAE Â· Saudi Arabia</div></div></div>
      <div class="zone-option" onclick="applyZone('Z2')"><span class="zo-badge">Zone 2</span><div><div class="zo-label">Americas &amp; Caribbean</div><div class="zo-region">USA Â· Canada Â· Mexico Â· Brazil Â· Caribbean islands</div></div></div>
      <div class="zone-option" onclick="applyZone('Z3')"><span class="zo-badge">Zone 3</span><div><div class="zo-label">East &amp; Southern Africa</div><div class="zo-region">Kenya Â· Tanzania Â· Uganda Â· Zimbabwe Â· South Africa</div></div></div>
      <div class="zone-option" onclick="applyZone('Z4')"><span class="zo-badge">Zone 4</span><div><div class="zo-label">South &amp; East Asia</div><div class="zo-region">India Â· Singapore Â· Malaysia Â· China Â· Hong Kong Â· Pakistan</div></div></div>
      <div class="zone-option" onclick="applyZone('Z5')"><span class="zo-badge">Zone 5</span><div><div class="zo-label">West Africa</div><div class="zo-region">Nigeria Â· Ghana Â· Sierra Leone Â· Cameroon Â· Gambia</div></div></div>
    </div>
  </div>
</div>

<!-- POMODORO WIDGET -->
<div id="pomodoroWidget" class="pomo-widget" style="display:none">
  <div class="pomo-header">
    <span class="pomo-title" id="pomoTitle">Study Session</span>
    <button class="pomo-close" onclick="hidePomo()">âœ•</button>
  </div>
  <div class="pomo-subject-row">
    <select id="pomoSubject" class="pomo-select">
      <option value="ict">ICT</option>
      <option value="cs">Computer Science</option>
      <option value="business">Business Studies</option>
      <option value="engfirst">English 1st Lang</option>
      <option value="englit">English Lit</option>
      <option value="science">Sciences</option>
      <option value="addmath">Add Maths</option>
      <option value="gp">Global Perspectives</option>
    </select>
  </div>
  <div class="pomo-time" id="pomoTime">25:00</div>
  <div class="pomo-phase" id="pomoPhase">Focus</div>
  <div class="pomo-btns">
    <button class="pomo-btn" id="pomoStartBtn" onclick="pomoStartStop()">â–¶ Start</button>
    <button class="pomo-btn secondary" onclick="pomoReset()">â†º Reset</button>
  </div>
  <div class="pomo-stats" id="pomoStats"></div>
</div>

</div><!-- end .app-shell -->

<script>
// ========== DATA ==========
const subjects = {
  ict: {
    name: 'ICT', code: '0417', color: 'var(--blue)',
    exams: [
      { paper: 'Paper 2 (Practical â€“ Documents/DB)', date: 'Wed 1 Apr 2026', iso: '2026-04-01', session: 'Practical window', duration: '2h 30m', code: '0417/21' },
      { paper: 'Paper 3 (Practical â€“ Spreadsheets/Web)', date: 'Thu 2 Apr 2026', iso: '2026-04-02', session: 'Practical window', duration: '2h 30m', code: '0417/31' },
      { paper: 'Paper 2 Var 2 (Practical â€“ Documents/DB)', date: 'Thu 16 Apr 2026', iso: '2026-04-16', session: 'Practical window', duration: '2h 30m', code: '0417/22' },
      { paper: 'Paper 3 Var 2 (Practical â€“ Spreadsheets/Web)', date: 'Tue 21 Apr 2026', iso: '2026-04-21', session: 'Practical window', duration: '2h 30m', code: '0417/32' },
      { paper: 'Paper 1 (Theory)', date: 'Thu 7 May 2026', iso: '2026-05-07', session: 'PM', duration: '1h 30m', code: '0417/12' },
    ]
  },
  cs: {
    name: 'Computer Science', code: '0478', color: 'var(--purple)',
    exams: [
      { paper: 'Paper 1 (Computer Systems)', date: 'Wed 13 May 2026', iso: '2026-05-13', session: 'AM', duration: '1h 45m', code: '0478/12' },
      { paper: 'Paper 2 (Algorithms & Programming)', date: 'Wed 20 May 2026', iso: '2026-05-20', session: 'AM', duration: '1h 45m', code: '0478/22' },
    ]
  },
  business: {
    name: 'Business Studies', code: '0450', color: 'var(--green)',
    exams: [
      { paper: 'Paper 1 (Short Answer & Data)', date: 'Mon 11 May 2026', iso: '2026-05-11', session: 'AM', duration: '1h 30m', code: '0450/12' },
      { paper: 'Paper 2 (Case Study)', date: 'Mon 18 May 2026', iso: '2026-05-18', session: 'AM', duration: '1h 30m', code: '0450/22' },
    ]
  },
  engfirst: {
    name: 'English First Language', code: '0500', color: 'var(--accent)',
    exams: [
      { paper: 'Paper 1 (Reading)', date: 'Wed 6 May 2026', iso: '2026-05-06', session: 'AM', duration: '2h', code: '0500/12' },
      { paper: 'Paper 2 (Directed Writing & Composition)', date: 'Fri 15 May 2026', iso: '2026-05-15', session: 'AM', duration: '2h', code: '0500/22' },
    ]
  },
  englit: {
    name: 'English Literature', code: '0475', color: 'var(--pink)',
    exams: [
      { paper: 'Paper 1 (Poetry & Prose)', date: 'Fri 8 May 2026', iso: '2026-05-08', session: 'PM', duration: '1h 30m', code: '0475/12' },
      { paper: 'Paper 2 (Drama â€“ Closed Book)', date: 'Mon 11 May 2026', iso: '2026-05-11', session: 'PM', duration: '1h 30m', code: '0475/22' },
      { paper: 'Paper 3 (Drama â€“ Open Text)', date: 'Mon 11 May 2026', iso: '2026-05-11', session: 'PM', duration: '45m', code: '0475/32' },
      { paper: 'Paper 4 (Unseen)', date: 'Mon 11 May 2026', iso: '2026-05-11', session: 'PM', duration: '1h 15m', code: '0475/42' },
    ]
  },
  science: {
    name: 'Co-ordinated Sciences', code: '0654', color: 'var(--red)',
    exams: [
      { paper: 'Paper 4 (Theory Extended)', date: 'Thu 7 May 2026', iso: '2026-05-07', session: 'AM', duration: '2h', code: '0654/42' },
      { paper: 'Paper 5 (Practical)', date: 'Tue 12 May 2026', iso: '2026-05-12', session: 'AM', duration: '2h', code: '0654/52' },
      { paper: 'Paper 6 (Alt to Practical)', date: 'Tue 12 May 2026', iso: '2026-05-12', session: 'AM', duration: '1h 30m', code: '0654/62' },
      { paper: 'Paper 2 (MCQ Extended)', date: 'Wed 3 Jun 2026', iso: '2026-06-03', session: 'AM', duration: '45m', code: '0654/22' },
    ]
  },
  addmath: {
    name: 'Additional Mathematics', code: '0606', color: 'var(--cyan)',
    exams: [
      { paper: 'Paper 1 (No Calculator)', date: 'Mon 18 May 2026', iso: '2026-05-18', session: 'AM', duration: '2h', code: '0606/12' },
      { paper: 'Paper 2 (Calculator)', date: 'Tue 26 May 2026', iso: '2026-05-26', session: 'AM', duration: '2h', code: '0606/22' },
    ]
  },
  gp: {
    name: 'Global Perspectives', code: '0457', color: 'var(--teal)',
    exams: [
      { paper: 'Component 1 (Written Exam)', date: 'Wed 6 May 2026', iso: '2026-05-06', session: 'PM', duration: '1h 25m', code: '0457/12' },
      { paper: 'Component 2 (Individual Report)', date: 'Coursework deadline', iso: null, session: 'â€”', duration: 'N/A', code: 'â€”' },
      { paper: 'Component 3 (Team Project)', date: 'Coursework deadline', iso: null, session: 'â€”', duration: 'N/A', code: 'â€”' },
    ]
  }
};

// ========== ZONE DATA ==========
const ICT_PRACTICALS = [
  {paper:'Paper 2 (Practical â€“ Documents/DB)',date:'Wed 1 Apr 2026',iso:'2026-04-01',session:'Practical window',duration:'2h 30m',code:'0417/21'},
  {paper:'Paper 3 (Practical â€“ Spreadsheets/Web)',date:'Thu 2 Apr 2026',iso:'2026-04-02',session:'Practical window',duration:'2h 30m',code:'0417/31'},
  {paper:'Paper 2 Var 2 (Practical â€“ Documents/DB)',date:'Thu 16 Apr 2026',iso:'2026-04-16',session:'Practical window',duration:'2h 30m',code:'0417/22'},
  {paper:'Paper 3 Var 2 (Practical â€“ Spreadsheets/Web)',date:'Tue 21 Apr 2026',iso:'2026-04-21',session:'Practical window',duration:'2h 30m',code:'0417/32'},
];
const GP_COURSEWORK = [
  {paper:'Component 2 (Individual Report)',date:'Coursework deadline',iso:null,session:'â€”',duration:'N/A',code:'â€”'},
  {paper:'Component 3 (Team Project)',date:'Coursework deadline',iso:null,session:'â€”',duration:'N/A',code:'â€”'},
];
const ZONE_INFO = {
  Z1:{label:'Zone 1',region:'UK, Europe & Middle East'},
  Z2:{label:'Zone 2',region:'Americas & Caribbean'},
  Z3:{label:'Zone 3',region:'East & Southern Africa'},
  Z4:{label:'Zone 4',region:'South & East Asia'},
  Z5:{label:'Zone 5',region:'West Africa'},
};
const zoneExams = {
  Z1:{
    ict:     [{paper:'Paper 1 (Theory)',date:'Thu 7 May 2026',iso:'2026-05-07',session:'AM',duration:'1h 30m',code:'0417/11'}],
    cs:      [{paper:'Paper 1 (Computer Systems)',date:'Wed 13 May 2026',iso:'2026-05-13',session:'PM',duration:'1h 45m',code:'0478/13'},{paper:'Paper 2 (Algorithms & Programming)',date:'Wed 20 May 2026',iso:'2026-05-20',session:'PM',duration:'1h 45m',code:'0478/23'}],
    business:[{paper:'Paper 1 (Short Answer & Data)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'PM',duration:'1h 30m',code:'0450/13'},{paper:'Paper 2 (Case Study)',date:'Mon 18 May 2026',iso:'2026-05-18',session:'PM',duration:'1h 30m',code:'0450/23'}],
    engfirst:[{paper:'Paper 1 (Reading)',date:'Tue 5 May 2026',iso:'2026-05-05',session:'PM',duration:'2h',code:'0500/13'},{paper:'Paper 2 (Directed Writing & Composition)',date:'Fri 15 May 2026',iso:'2026-05-15',session:'PM',duration:'2h',code:'0500/23'}],
    englit:  [{paper:'Paper 1 (Poetry & Prose)',date:'Fri 8 May 2026',iso:'2026-05-08',session:'AM',duration:'1h 30m',code:'0475/11'},{paper:'Paper 2 (Drama â€“ Closed Book)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'AM',duration:'1h 30m',code:'0475/21'},{paper:'Paper 3 (Drama â€“ Open Text)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'AM',duration:'45m',code:'0475/31'},{paper:'Paper 4 (Unseen)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'AM',duration:'1h 15m',code:'0475/41'}],
    science: [{paper:'Paper 4 (Theory Extended)',date:'Thu 7 May 2026',iso:'2026-05-07',session:'PM',duration:'2h',code:'0654/43'},{paper:'Paper 5 (Practical)',date:'Tue 12 May 2026',iso:'2026-05-12',session:'PM',duration:'2h',code:'0654/53'},{paper:'Paper 6 (Alt to Practical)',date:'Tue 12 May 2026',iso:'2026-05-12',session:'PM',duration:'1h 30m',code:'0654/63'},{paper:'Paper 2 (MCQ Extended)',date:'Wed 3 Jun 2026',iso:'2026-06-03',session:'PM',duration:'45m',code:'0654/23'}],
    addmath: [{paper:'Paper 1 (No Calculator)',date:'Mon 18 May 2026',iso:'2026-05-18',session:'PM',duration:'2h',code:'0606/13'},{paper:'Paper 2 (Calculator)',date:'Tue 26 May 2026',iso:'2026-05-26',session:'PM',duration:'2h',code:'0606/23'}],
    gp:      [{paper:'Component 1 (Written Exam)',date:'Wed 6 May 2026',iso:'2026-05-06',session:'AM',duration:'1h 25m',code:'0457/11'}],
  },
  Z2:{
    ict:     [{paper:'Paper 1 (Theory)',date:'Thu 7 May 2026',iso:'2026-05-07',session:'PM',duration:'1h 30m',code:'0417/11'}],
    cs:      [{paper:'Paper 1 (Computer Systems)',date:'Wed 13 May 2026',iso:'2026-05-13',session:'AM',duration:'1h 45m',code:'0478/11'},{paper:'Paper 2 (Algorithms & Programming)',date:'Wed 20 May 2026',iso:'2026-05-20',session:'AM',duration:'1h 45m',code:'0478/21'}],
    business:[{paper:'Paper 1 (Short Answer & Data)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'AM',duration:'1h 30m',code:'0450/11'},{paper:'Paper 2 (Case Study)',date:'Mon 18 May 2026',iso:'2026-05-18',session:'AM',duration:'1h 30m',code:'0450/21'}],
    engfirst:[{paper:'Paper 1 (Reading)',date:'Wed 6 May 2026',iso:'2026-05-06',session:'AM',duration:'2h',code:'0500/11'},{paper:'Paper 2 (Directed Writing & Composition)',date:'Thu 21 May 2026',iso:'2026-05-21',session:'AM',duration:'2h',code:'0500/21'}],
    englit:  [{paper:'Paper 1 (Poetry & Prose)',date:'Fri 8 May 2026',iso:'2026-05-08',session:'PM',duration:'1h 30m',code:'0475/11'},{paper:'Paper 2 (Drama â€“ Closed Book)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'PM',duration:'1h 30m',code:'0475/21'},{paper:'Paper 3 (Drama â€“ Open Text)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'PM',duration:'45m',code:'0475/31'},{paper:'Paper 4 (Unseen)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'PM',duration:'1h 15m',code:'0475/41'}],
    science: [{paper:'Paper 4 (Theory Extended)',date:'Thu 7 May 2026',iso:'2026-05-07',session:'AM',duration:'2h',code:'0654/41'},{paper:'Paper 5 (Practical)',date:'Tue 12 May 2026',iso:'2026-05-12',session:'AM',duration:'2h',code:'0654/51'},{paper:'Paper 6 (Alt to Practical)',date:'Tue 12 May 2026',iso:'2026-05-12',session:'AM',duration:'1h 30m',code:'0654/61'},{paper:'Paper 2 (MCQ Extended)',date:'Wed 3 Jun 2026',iso:'2026-06-03',session:'AM',duration:'45m',code:'0654/21'}],
    addmath: [{paper:'Paper 1 (No Calculator)',date:'Mon 18 May 2026',iso:'2026-05-18',session:'AM',duration:'2h',code:'0606/11'},{paper:'Paper 2 (Calculator)',date:'Tue 26 May 2026',iso:'2026-05-26',session:'AM',duration:'2h',code:'0606/21'}],
    gp:      [{paper:'Component 1 (Written Exam)',date:'Wed 6 May 2026',iso:'2026-05-06',session:'PM',duration:'1h 25m',code:'0457/11'}],
  },
  Z3:{
    ict:     [{paper:'Paper 1 (Theory)',date:'Thu 7 May 2026',iso:'2026-05-07',session:'AM',duration:'1h 30m',code:'0417/12'}],
    cs:      [{paper:'Paper 1 (Computer Systems)',date:'Wed 13 May 2026',iso:'2026-05-13',session:'PM',duration:'1h 45m',code:'0478/11'},{paper:'Paper 2 (Algorithms & Programming)',date:'Wed 20 May 2026',iso:'2026-05-20',session:'PM',duration:'1h 45m',code:'0478/21'}],
    business:[{paper:'Paper 1 (Short Answer & Data)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'PM',duration:'1h 30m',code:'0450/11'},{paper:'Paper 2 (Case Study)',date:'Mon 18 May 2026',iso:'2026-05-18',session:'PM',duration:'1h 30m',code:'0450/21'}],
    engfirst:[{paper:'Paper 1 (Reading)',date:'Wed 6 May 2026',iso:'2026-05-06',session:'PM',duration:'2h',code:'0500/11'},{paper:'Paper 2 (Directed Writing & Composition)',date:'Thu 21 May 2026',iso:'2026-05-21',session:'PM',duration:'2h',code:'0500/21'}],
    englit:  [{paper:'Paper 1 (Poetry & Prose)',date:'Fri 8 May 2026',iso:'2026-05-08',session:'AM',duration:'1h 30m',code:'0475/12'},{paper:'Paper 2 (Drama â€“ Closed Book)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'AM',duration:'1h 30m',code:'0475/22'},{paper:'Paper 3 (Drama â€“ Open Text)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'AM',duration:'45m',code:'0475/32'},{paper:'Paper 4 (Unseen)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'AM',duration:'1h 15m',code:'0475/42'}],
    science: [{paper:'Paper 4 (Theory Extended)',date:'Thu 7 May 2026',iso:'2026-05-07',session:'PM',duration:'2h',code:'0654/41'},{paper:'Paper 5 (Practical)',date:'Tue 12 May 2026',iso:'2026-05-12',session:'PM',duration:'2h',code:'0654/51'},{paper:'Paper 6 (Alt to Practical)',date:'Tue 12 May 2026',iso:'2026-05-12',session:'PM',duration:'1h 30m',code:'0654/61'},{paper:'Paper 2 (MCQ Extended)',date:'Wed 3 Jun 2026',iso:'2026-06-03',session:'PM',duration:'45m',code:'0654/21'}],
    addmath: [{paper:'Paper 1 (No Calculator)',date:'Mon 18 May 2026',iso:'2026-05-18',session:'PM',duration:'2h',code:'0606/11'},{paper:'Paper 2 (Calculator)',date:'Tue 26 May 2026',iso:'2026-05-26',session:'PM',duration:'2h',code:'0606/21'}],
    gp:      [{paper:'Component 1 (Written Exam)',date:'Wed 6 May 2026',iso:'2026-05-06',session:'AM',duration:'1h 25m',code:'0457/12'}],
  },
  Z4:{
    ict:     [{paper:'Paper 1 (Theory)',date:'Thu 7 May 2026',iso:'2026-05-07',session:'PM',duration:'1h 30m',code:'0417/12'}],
    cs:      [{paper:'Paper 1 (Computer Systems)',date:'Wed 13 May 2026',iso:'2026-05-13',session:'AM',duration:'1h 45m',code:'0478/12'},{paper:'Paper 2 (Algorithms & Programming)',date:'Wed 20 May 2026',iso:'2026-05-20',session:'AM',duration:'1h 45m',code:'0478/22'}],
    business:[{paper:'Paper 1 (Short Answer & Data)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'AM',duration:'1h 30m',code:'0450/12'},{paper:'Paper 2 (Case Study)',date:'Mon 18 May 2026',iso:'2026-05-18',session:'AM',duration:'1h 30m',code:'0450/22'}],
    engfirst:[{paper:'Paper 1 (Reading)',date:'Wed 6 May 2026',iso:'2026-05-06',session:'AM',duration:'2h',code:'0500/12'},{paper:'Paper 2 (Directed Writing & Composition)',date:'Fri 15 May 2026',iso:'2026-05-15',session:'AM',duration:'2h',code:'0500/22'}],
    englit:  [{paper:'Paper 1 (Poetry & Prose)',date:'Fri 8 May 2026',iso:'2026-05-08',session:'PM',duration:'1h 30m',code:'0475/12'},{paper:'Paper 2 (Drama â€“ Closed Book)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'PM',duration:'1h 30m',code:'0475/22'},{paper:'Paper 3 (Drama â€“ Open Text)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'PM',duration:'45m',code:'0475/32'},{paper:'Paper 4 (Unseen)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'PM',duration:'1h 15m',code:'0475/42'}],
    science: [{paper:'Paper 4 (Theory Extended)',date:'Thu 7 May 2026',iso:'2026-05-07',session:'AM',duration:'2h',code:'0654/42'},{paper:'Paper 5 (Practical)',date:'Tue 12 May 2026',iso:'2026-05-12',session:'AM',duration:'2h',code:'0654/52'},{paper:'Paper 6 (Alt to Practical)',date:'Tue 12 May 2026',iso:'2026-05-12',session:'AM',duration:'1h 30m',code:'0654/62'},{paper:'Paper 2 (MCQ Extended)',date:'Wed 3 Jun 2026',iso:'2026-06-03',session:'AM',duration:'45m',code:'0654/22'}],
    addmath: [{paper:'Paper 1 (No Calculator)',date:'Mon 18 May 2026',iso:'2026-05-18',session:'AM',duration:'2h',code:'0606/12'},{paper:'Paper 2 (Calculator)',date:'Tue 26 May 2026',iso:'2026-05-26',session:'AM',duration:'2h',code:'0606/22'}],
    gp:      [{paper:'Component 1 (Written Exam)',date:'Wed 6 May 2026',iso:'2026-05-06',session:'PM',duration:'1h 25m',code:'0457/12'}],
  },
  Z5:{
    ict:     [{paper:'Paper 1 (Theory)',date:'Thu 7 May 2026',iso:'2026-05-07',session:'AM',duration:'1h 30m',code:'0417/13'}],
    cs:      [{paper:'Paper 1 (Computer Systems)',date:'Wed 13 May 2026',iso:'2026-05-13',session:'PM',duration:'1h 45m',code:'0478/12'},{paper:'Paper 2 (Algorithms & Programming)',date:'Wed 20 May 2026',iso:'2026-05-20',session:'PM',duration:'1h 45m',code:'0478/22'}],
    business:[{paper:'Paper 1 (Short Answer & Data)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'PM',duration:'1h 30m',code:'0450/12'},{paper:'Paper 2 (Case Study)',date:'Mon 18 May 2026',iso:'2026-05-18',session:'PM',duration:'1h 30m',code:'0450/22'}],
    engfirst:[{paper:'Paper 1 (Reading)',date:'Wed 6 May 2026',iso:'2026-05-06',session:'PM',duration:'2h',code:'0500/12'},{paper:'Paper 2 (Directed Writing & Composition)',date:'Fri 15 May 2026',iso:'2026-05-15',session:'PM',duration:'2h',code:'0500/22'}],
    englit:  [{paper:'Paper 1 (Poetry & Prose)',date:'Fri 8 May 2026',iso:'2026-05-08',session:'AM',duration:'1h 30m',code:'0475/13'},{paper:'Paper 2 (Drama â€“ Closed Book)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'AM',duration:'1h 30m',code:'0475/23'},{paper:'Paper 3 (Drama â€“ Open Text)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'AM',duration:'45m',code:'0475/33'},{paper:'Paper 4 (Unseen)',date:'Mon 11 May 2026',iso:'2026-05-11',session:'AM',duration:'1h 15m',code:'0475/43'}],
    science: [{paper:'Paper 4 (Theory Extended)',date:'Thu 7 May 2026',iso:'2026-05-07',session:'PM',duration:'2h',code:'0654/42'},{paper:'Paper 5 (Practical)',date:'Tue 12 May 2026',iso:'2026-05-12',session:'PM',duration:'2h',code:'0654/52'},{paper:'Paper 6 (Alt to Practical)',date:'Tue 12 May 2026',iso:'2026-05-12',session:'PM',duration:'1h 30m',code:'0654/62'},{paper:'Paper 2 (MCQ Extended)',date:'Wed 3 Jun 2026',iso:'2026-06-03',session:'PM',duration:'45m',code:'0654/22'}],
    addmath: [{paper:'Paper 1 (No Calculator)',date:'Mon 18 May 2026',iso:'2026-05-18',session:'PM',duration:'2h',code:'0606/12'},{paper:'Paper 2 (Calculator)',date:'Tue 26 May 2026',iso:'2026-05-26',session:'PM',duration:'2h',code:'0606/22'}],
    gp:      [{paper:'Component 1 (Written Exam)',date:'Tue 5 May 2026',iso:'2026-05-05',session:'AM',duration:'1h 25m',code:'0457/13'}],
  },
};

// ========== TOPICS DATA ==========
const topicData = {
  'ict-theory-topics': [
    ['1','Types & Components of Computer Systems'],['2','Input & Output Devices'],['3','Storage Devices & Media'],
    ['4','Networks & Effects of Using Them'],['5','Effects of Using ICT'],['6','ICT Applications'],
    ['7','The Systems Life Cycle'],['8','Safety & Security'],['9','Audiences'],
    ['10','Communication'],['11','File Management'],['12','Images'],
    ['13','Layout'],['14','Styles'],['15','Proofing'],['16','Graphs & Charts']
  ],
  'ict-practical-topics': [
    ['17','Document Production'],['18','Databases'],['19','Presentations'],
    ['20','Spreadsheets & Data Graphs'],['21','Web Authoring (HTML/CSS)']
  ],
  'cs-topics1': [
    ['1','Data Representation (binary, hex, ASCII, images, sound)'],
    ['2','Data Transmission (methods, error detection, encryption)'],
    ['3','Hardware (CPU, memory, input/output, storage)'],
    ['4','Software (OS, translators, utilities, IDE)'],
    ['5','The Internet & Its Uses (WWW, URLs, HTTP/S, browsers)'],
    ['6','Automated & Emerging Technologies (sensors, robotics, AI)']
  ],
  'cs-topics2': [
    ['7','Algorithm Design & Problem-Solving (flowcharts, pseudocode, decomposition)'],
    ['8','Programming (variables, loops, arrays, procedures, file handling)'],
    ['9','Databases (tables, queries, primary keys, SQL basics)'],
    ['10','Boolean Logic (gates: NOT, AND, OR, NAND, NOR, XOR; truth tables)']
  ],
  'bus-topics': [
    ['1','Understanding Business Activity (purpose, classification, enterprise)'],
    ['2','People in Business (motivation, recruitment, training, org structure)'],
    ['3','Marketing (segmentation, research, 4Ps, competition)'],
    ['4','Operations Management (production methods, quality, location)'],
    ['5','Financial Information (cash flow, income statements, balance sheets)'],
    ['6','External Influences (government, economy, environment, globalisation, MNCs)']
  ],
  'sci-bio-topics': [
    ['B1','Characteristics of Living Organisms'],['B2','Cells'],['B3','Movement Into & Out of Cells'],
    ['B4','Biological Molecules'],['B5','Enzymes'],['B6','Plant Nutrition'],['B7','Human Nutrition'],
    ['B8','Transport in Plants'],['B9','Transport in Animals'],['B10','Diseases & Immunity'],
    ['B11','Gas Exchange in Humans'],['B12','Respiration'],['B13','Coordination & Response'],
    ['B14','Drugs'],['B15','Reproduction'],['B16','Inheritance'],['B17','Variation & Selection'],
    ['B18','Organisms & Their Environment'],['B19','Human Influences on Ecosystems']
  ],
  'sci-chem-topics': [
    ['C1','States of Matter'],['C2','Atoms, Elements & Compounds'],['C3','Stoichiometry'],
    ['C4','Electrochemistry'],['C5','Chemical Energetics'],['C6','Chemical Reactions'],
    ['C7','Acids, Bases & Salts'],['C8','The Periodic Table'],['C9','Metals'],
    ['C10','Chemistry of the Environment'],['C11','Organic Chemistry'],['C12','Experimental Techniques & Chemical Analysis']
  ],
  'sci-phys-topics': [
    ['P1','Motion, Forces & Energy'],['P2','Thermal Physics'],
    ['P3','Waves (light, sound, EM spectrum)'],['P4','Electricity & Magnetism'],
    ['P5','Nuclear Physics & Radioactivity'],['P6','Space Physics']
  ],
  'am-topics': [
    ['1','Functions (notation, inverse, composite)'],
    ['2','Quadratic Functions (completing square, discriminant)'],
    ['3','Equations, Inequalities & Graphs'],
    ['4','Indices & Surds'],
    ['5','Factors of Polynomials (remainder/factor theorem)'],
    ['6','Simultaneous Equations (linear & non-linear)'],
    ['7','Logarithmic & Exponential Functions'],
    ['8','Straight Line Graphs'],
    ['9','Circular Measure (radians, arc length, sector area)'],
    ['10','Trigonometry (identities, equations, graphs)'],
    ['11','Permutations & Combinations'],
    ['12','Binomial Theorem'],
    ['13','Vectors in 2D'],
    ['14','Matrices (operations, determinant, inverse)'],
    ['15','Differentiation (power, chain, product/quotient rules)'],
    ['16','Integration (definite, area under curve)'],
    ['17','Kinematics (displacement, velocity, acceleration)']
  ],
  'gp-topics': [
    ['1','Demographic Change'],['2','Education for All'],['3','Employment'],
    ['4','Fuel & Energy'],['5','Globalisation'],['6','Law & Criminality'],
    ['7','Migration'],['8','Poverty & Inequality'],['9','Sport & Recreation'],
    ['10','Sustainability'],['11','Technology & the Digital World'],['12','Tradition, Culture & Identity'],
    ['13','Transport & Infrastructure'],['14','Water, Food & Agriculture'],
    ['15','Conflict & Peace'],['16','Disease & Health'],['17','Human Rights'],['18','Language & Communication']
  ]
};

// ========== COUNTDOWN ==========
function updateCountdown() {
  const examStart = new Date('2026-04-01T00:00:00');
  const now = new Date();
  const diff = examStart - now;
  const days = Math.floor(diff / (1000*60*60*24));
  const hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
  const mins = Math.floor((diff % (1000*60*60)) / (1000*60));

  document.getElementById('countdown').innerHTML = `
    <div class="countdown-card"><div class="num">${days}</div><div class="lbl">Days</div></div>
    <div class="countdown-card"><div class="num">${hours}</div><div class="lbl">Hours</div></div>
    <div class="countdown-card"><div class="num">${mins}</div><div class="lbl">Minutes</div></div>
    <div class="countdown-card" style="border-color:var(--accent)"><div class="num" style="font-size:14px;color:var(--text2)">until first exam</div><div class="lbl">ICT Practical Â· 1 Apr 2026</div></div>
  `;
}
updateCountdown();
setInterval(updateCountdown, 60000);

// ========== NAVIGATION ==========
function navigateTo(id) {
  document.querySelectorAll('.sidebar-item').forEach(t => {
    t.classList.toggle('active', t.dataset.section === id);
  });
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  const shell = document.querySelector('.app-shell');
  if (shell) shell.scrollTo({ top: 0, behavior: 'smooth' });
  closeSidebar();
}

document.querySelectorAll('.sidebar-item').forEach(item => {
  item.addEventListener('click', () => navigateTo(item.dataset.section));
});

function goToSubject(id) {
  navigateTo(id);
}

// ========== MOBILE SIDEBAR ==========
function openSidebar() {
  document.getElementById('sidebar').classList.add('open');
  document.getElementById('sidebarOverlay').classList.add('active');
}
function closeSidebar() {
  document.getElementById('sidebar').classList.remove('open');
  document.getElementById('sidebarOverlay').classList.remove('active');
}
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  if (sidebar.classList.contains('open')) closeSidebar(); else openSidebar();
}

// ========== DETAIL TABS ==========
document.querySelectorAll('.detail-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    const parent = tab.closest('.section');
    parent.querySelectorAll('.detail-tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    parent.querySelectorAll('.detail-panel').forEach(p => p.classList.remove('active'));
    parent.querySelector('#' + tab.dataset.panel).classList.add('active');
  });
});

// ========== TOPIC NOTES DATA ==========
const topicNotes = {
  // ICT Theory
  'ict-theory-topics-1': {
    defs: ['Computer system = hardware + software + data working together to perform tasks'],
    facts: ['Input â†’ Process â†’ Output â†’ Storage (IPO model)', 'Embedded systems have dedicated functions (e.g. washing machine controller)', 'GUI vs CLI: GUI uses icons/windows, CLI uses typed commands']
  },
  'ict-theory-topics-2': {
    defs: ['Input device: hardware that sends data into the computer', 'Output device: hardware that receives processed data from the computer'],
    facts: ['OMR reads pencil marks; OCR reads printed text; MICR reads magnetic ink (cheques)', 'NFC operates within ~10 cm; RFID can be passive (no battery) or active', 'Biometrics: fingerprint, iris, voice â€” used for authentication']
  },
  'ict-theory-topics-3': {
    defs: ['Primary storage: RAM/ROM â€” directly accessed by CPU; fast, limited', 'Secondary storage: persistent after power off (HDD, SSD, optical, flash)'],
    facts: ['RAM = volatile (loses data without power); ROM = non-volatile', 'SSD faster than HDD, no moving parts, more expensive per GB', 'Cloud storage: remote servers accessed via internet']
  },
  'ict-theory-topics-4': {
    defs: ['Network: two or more devices connected to share resources/data', 'LAN = Local Area Network (single building); WAN = Wide Area Network (multiple sites)'],
    facts: ['Bus, star, mesh topologies â€” star most common in schools', 'Bandwidth = max data transfer rate; latency = delay', 'Wi-Fi uses radio waves; Ethernet uses cables', 'IP address identifies device; MAC address identifies NIC']
  },
  'ict-theory-topics-8': {
    defs: ['Encryption: converting data into unreadable form using a key', 'Firewall: monitors and controls incoming/outgoing network traffic based on rules'],
    facts: ['Phishing: fake emails/sites to steal credentials', 'Strong password: 8+ chars, uppercase, lowercase, number, symbol', 'Two-factor authentication (2FA) adds extra security layer', 'Backup: copy stored separately to restore after data loss']
  },
  // ICT Practical
  'ict-practical-topics-20': {
    defs: ['Cell reference: identifies a cell (e.g. B4); absolute reference locks it ($B$4)'],
    facts: ['=IF(condition, true_value, false_value)', '=VLOOKUP(lookup_val, table_range, col_index, FALSE)', '=COUNTIF(range, criteria)', '=SUMIF(range, criteria, sum_range)', 'Always use cell references in formulae, not hardcoded values']
  },
  'ict-practical-topics-21': {
    defs: ['HTML tag: <tagname>content</tagname>', 'CSS class: .classname { property: value; }'],
    facts: ['Internal CSS: inside <style> tags in <head>', 'External CSS: separate .css file linked with <link>', 'div = block element; span = inline element', 'Class selector (.) applies to multiple elements; id (#) must be unique']
  },
  // CS
  'cs-topics1-1': {
    defs: ['Bit: single binary digit (0 or 1)', 'Byte: 8 bits', 'ASCII: 7-bit standard encoding 128 characters'],
    facts: ['Binary to denary: sum of place values (128, 64, 32, 16, 8, 4, 2, 1)', 'Hex digits: 0â€“9 then A(10) B(11) C(12) D(13) E(14) F(15)', 'Convert binary â†’ hex: group into nibbles (4 bits)', 'Image resolution: more pixels = higher quality, larger file size', 'Colour depth: bits per pixel; 8-bit = 256 colours; 24-bit = 16.7M colours'],
    formulae: ['File size (image) = width Ã— height Ã— colour depth (bits)']
  },
  'cs-topics1-3': {
    defs: ['CPU: Central Processing Unit â€” carries out instructions', 'RAM: Random Access Memory â€” volatile, stores running programs/data', 'ROM: Read-Only Memory â€” non-volatile, stores boot instructions'],
    facts: ['Fetch-Decode-Execute cycle: PC â†’ MAR â†’ MDR â†’ IR â†’ CU â†’ ALU', 'Clock speed (GHz), number of cores, cache size all affect CPU performance', 'Cache: small fast memory inside/near CPU; L1 fastest, L3 largest']
  },
  'cs-topics2-7': {
    defs: ['Algorithm: step-by-step solution to a problem', 'Decomposition: breaking a problem into smaller sub-problems', 'Abstraction: removing unnecessary detail to focus on what matters'],
    facts: ['Pseudocode uses plain English structure â€” no fixed syntax', 'Flowchart shapes: oval=start/end, parallelogram=I/O, rectangle=process, diamond=decision', 'Trace table: manually follow through algorithm tracking variable values']
  },
  'cs-topics2-8': {
    defs: ['Variable: named storage location whose value can change', 'Constant: named value that cannot change during execution'],
    facts: ['FOR loop: known number of iterations', 'WHILE loop: pre-condition check', 'REPEAT-UNTIL: post-condition (always runs at least once)', 'Procedure: named block of code, no return value', 'Function: named block, returns a value', 'Array index starts at 0 (usually)'],
    formulae: ['Array declaration: DECLARE name : ARRAY[0:n-1] OF DataType']
  },
  'cs-topics2-10': {
    defs: ['Boolean logic: operations on TRUE/FALSE values using gates'],
    facts: ['NOT: inverts; AND: both true â†’ true; OR: either true â†’ true', 'NAND = NOT(AND); NOR = NOT(OR); XOR = one but not both', 'Truth table: list all input combinations, show output'],
    formulae: ['NAND(A,B) = NOT(A AND B)', 'XOR(A,B) = (A OR B) AND NOT(A AND B)']
  },
  // Business
  'bus-topics-1': {
    defs: ['Business: organisation that produces goods/services to satisfy needs/wants', 'Entrepreneur: person who takes risk to start a business seeking profit'],
    facts: ['Primary sector: extracting raw materials', 'Secondary: manufacturing', 'Tertiary: services', 'Sole trader: unlimited liability; limited company: liability limited to investment', 'Stakeholders: anyone with interest in the business (internal/external)']
  },
  'bus-topics-3': {
    defs: ['Market: buyers and sellers of a product', 'Market research: collecting data about customers and competitors'],
    facts: ['4Ps: Product, Price, Place, Promotion', 'Primary research: surveys/interviews (new data); secondary: existing data', 'Price skimming: high initial price; penetration: low to gain share', 'USP = Unique Selling Point']
  },
  'bus-topics-4': {
    defs: ['Production: process of making goods/services', 'Productivity: output per worker per time period'],
    facts: ['Job production: one-off items (high quality, expensive)', 'Batch production: groups of identical items', 'Flow production: continuous, automated (mass market)', 'Quality control: checking finished products; quality assurance: building quality in']
  },
  'bus-topics-5': {
    defs: ['Revenue: income from sales = price Ã— quantity', 'Profit = Revenue âˆ’ Total Costs', 'Fixed costs: do not change with output (rent)', 'Variable costs: change with output (raw materials)'],
    formulae: ['Break-even output = Fixed Costs Ã· (Selling Price âˆ’ Variable Cost per unit)', 'Profit = Revenue âˆ’ Total Costs', 'Gross profit = Revenue âˆ’ Cost of Sales']
  },
  // Science: Biology
  'sci-bio-topics-1': {
    defs: ['Cell: basic structural and functional unit of life'],
    facts: ['Animal cell: cell membrane, cytoplasm, nucleus, mitochondria, ribosomes', 'Plant cell adds: cell wall (cellulose), vacuole, chloroplasts', 'Diffusion: net movement from high â†’ low concentration (no energy needed)', 'Osmosis: diffusion of water across partially permeable membrane'],
    formulae: ['Magnification = image size Ã· actual size']
  },
  'sci-bio-topics-3': {
    defs: ['Photosynthesis: process where plants make glucose using light energy'],
    formulae: ['6COâ‚‚ + 6Hâ‚‚O â†’ Câ‚†Hâ‚â‚‚Oâ‚† + 6Oâ‚‚ (in light, with chlorophyll)', 'Aerobic respiration: Câ‚†Hâ‚â‚‚Oâ‚† + 6Oâ‚‚ â†’ 6COâ‚‚ + 6Hâ‚‚O + energy', 'Anaerobic (animals): glucose â†’ lactic acid + energy', 'Anaerobic (yeast): glucose â†’ ethanol + COâ‚‚ + energy'],
    facts: ['Limiting factors for photosynthesis: light intensity, COâ‚‚ concentration, temperature']
  },
  // Science: Chemistry
  'sci-chem-topics-1': {
    defs: ['Element: pure substance of one type of atom', 'Compound: two or more elements chemically combined', 'Mixture: substances mixed but not chemically combined â€” can be separated physically'],
    facts: ['Proton: +1 charge, in nucleus', 'Neutron: no charge, in nucleus', 'Electron: âˆ’1 charge, shells', 'Atomic number = protons; mass number = protons + neutrons', 'Isotopes: same element, different neutron count (same protons)']
  },
  'sci-chem-topics-7': {
    defs: ['Acid: produces Hâº ions in water; pH < 7', 'Alkali: produces OHâ» ions in water; pH > 7', 'Salt: formed when acid reacts with base/metal/carbonate'],
    facts: ['Neutralisation: acid + alkali â†’ salt + water', 'acid + metal â†’ salt + hydrogen', 'acid + carbonate â†’ salt + water + COâ‚‚', 'Universal indicator shows pH; litmus only acid/alkali', 'Strong acid fully ionises (HCl, Hâ‚‚SOâ‚„, HNOâ‚ƒ)']
  },
  // Science: Physics
  'sci-phys-topics-1': {
    defs: ['Speed: distance per unit time', 'Velocity: speed in a given direction (vector)', 'Acceleration: rate of change of velocity'],
    formulae: ['s = d/t  (speed = distance Ã· time)', 'a = (vâˆ’u)/t  (acceleration)', 'F = ma  (Newton\'s 2nd Law)', 'W = mg  (weight = mass Ã— g, where g = 10 N/kg)', 'KE = Â½mvÂ²', 'GPE = mgh', 'Momentum = mv', 'p = F/A  (pressure = force Ã· area)']
  },
  'sci-phys-topics-4': {
    defs: ['Electrical current: rate of flow of charge', 'Voltage (p.d.): energy transferred per unit charge', 'Resistance: opposition to current flow'],
    formulae: ['V = IR  (Ohm\'s Law)', 'P = IV = IÂ²R = VÂ²/R', 'E = Pt  (energy = power Ã— time)', 'Q = It  (charge = current Ã— time)', 'Series: R_total = Râ‚+Râ‚‚; V shared; I same', '1/R_total = 1/Râ‚+1/Râ‚‚ (parallel); I shared; V same']
  },
  // Add Maths
  'am-topics-1': {
    defs: ['Function: each input maps to exactly one output', 'fâ»Â¹(x): inverse function â€” swaps x and y, then rearrange'],
    facts: ['Domain: set of input values; Range: set of output values', 'Composite fg(x) means f(g(x)) â€” apply g first', 'For fâ»Â¹ to exist as a function, f must be one-to-one'],
    formulae: ['To find inverse: let y=f(x), swap xâ†”y, rearrange for y']
  },
  'am-topics-2': {
    defs: ['Quadratic: axÂ² + bx + c = 0', 'Discriminant (Î”): determines nature of roots'],
    formulae: ['x = (âˆ’b Â± âˆš(bÂ²âˆ’4ac)) / 2a', 'Discriminant: Î” = bÂ²âˆ’4ac', 'Î” > 0: two real distinct roots', 'Î” = 0: one repeated root', 'Î” < 0: no real roots', 'Completing square: a(x+p)Â²+q where p=b/2a'],
    facts: ['Vertex at x = âˆ’b/2a', 'a>0: U-shape (min); a<0: âˆ©-shape (max)']
  },
  'am-topics-7': {
    formulae: ['aË£ = e^(x ln a)', 'log_a(x) = ln(x)/ln(a)', 'log(AB) = log A + log B', 'log(A/B) = log A âˆ’ log B', 'log(Aâ¿) = n log A', 'ln(eË£) = x; e^(ln x) = x'],
    facts: ['ln = natural log (base e)', 'log without base = logâ‚â‚€', 'Exponential growth: y = Ae^(kt); decay: k < 0']
  },
  'am-topics-10': {
    formulae: ['sinÂ²Î¸ + cosÂ²Î¸ = 1', '1 + tanÂ²Î¸ = secÂ²Î¸', '1 + cotÂ²Î¸ = cosecÂ²Î¸', 'sin(AÂ±B) = sinA cosB Â± cosA sinB', 'cos(AÂ±B) = cosA cosB âˆ“ sinA sinB', 'tan(AÂ±B) = (tanAÂ±tanB)/(1âˆ“tanA tanB)', 'sin2A = 2sinA cosA', 'cos2A = cosÂ²A âˆ’ sinÂ²A = 1âˆ’2sinÂ²A = 2cosÂ²Aâˆ’1'],
    facts: ['CAST diagram: All positive (1st), Sin (2nd), Tan (3rd), Cos (4th)', 'Period of sinx/cosx = 360Â°; tanx = 180Â°', 'Amplitude: coefficient of trig function']
  },
  'am-topics-15': {
    formulae: ['d/dx(xâ¿) = nxâ¿â»Â¹', 'd/dx(eË£) = eË£', 'd/dx(ln x) = 1/x', 'd/dx(sin x) = cos x', 'd/dx(cos x) = âˆ’sin x', 'Chain rule: dy/dx = (dy/du)(du/dx)', 'Product rule: d/dx(uv) = u(dv/dx) + v(du/dx)', 'Quotient rule: d/dx(u/v) = (v(du/dx)âˆ’u(dv/dx))/vÂ²'],
    facts: ['Set dy/dx = 0 to find stationary points', 'dÂ²y/dxÂ² > 0: minimum; < 0: maximum']
  },
  'am-topics-16': {
    formulae: ['âˆ«xâ¿ dx = xâ¿âºÂ¹/(n+1) + c  (n â‰  âˆ’1)', 'âˆ«eË£ dx = eË£ + c', 'âˆ«1/x dx = ln|x| + c', 'âˆ«sin x dx = âˆ’cos x + c', 'âˆ«cos x dx = sin x + c', 'Area = âˆ«[a to b] y dx  (above x-axis)'],
    facts: ['Definite integral: substitute limits b then a, subtract', 'Area below x-axis comes out negative â€” take absolute value', 'Always add +c for indefinite integrals']
  },
  'am-topics-14': {
    formulae: ['Matrix addition: add corresponding elements', 'Scalar multiply: multiply every element by k', 'AB: row of A Ã— column of B (only if cols of A = rows of B)', 'det(A) = ad âˆ’ bc  for 2Ã—2', 'Aâ»Â¹ = (1/det) Ã— [d âˆ’b; âˆ’c a]'],
    facts: ['AAâ»Â¹ = I (identity matrix)', 'det = 0: matrix is singular (no inverse)', 'AX = B â†’ X = Aâ»Â¹B']
  },
  // â€”â€”â€” NEW: ICT Theory â€”â€”â€”
  'ict-theory-topics-5': {
    defs: ['ICT effect: social, economic, environmental or ethical impact of information technology'],
    facts: ['Teleworking: working from home using ICT â€” reduces commuting, saves office costs', 'Online shopping: 24/7 access, global reach; replaces physical stores', 'E-learning: education via digital platforms; accessible anytime but lacks face-to-face', 'Digital divide: gap between those with and without access to technology', 'Health risks of ICT: RSI (repetitive strain), eye strain, obesity from long screen time', 'Privacy concern: personal data collected by websites and apps']
  },
  'ict-theory-topics-6': {
    defs: ['ICT application: specific use of technology to solve a problem or provide a service'],
    facts: ['Finance/banking: online transactions, ATMs, fraud detection algorithms', 'Healthcare: electronic patient records, diagnostic imaging, robotic surgery', 'Education: virtual classrooms, interactive whiteboards, online assessments', 'Retail: EPOS systems, stock management systems, online ordering', 'Government: e-voting, digital ID, automated tax returns', 'Transport: GPS navigation, automated ticketing, traffic management', 'Entertainment: streaming services, virtual reality, online gaming']
  },
  'ict-theory-topics-7': {
    defs: ['Systems Life Cycle: structured process for developing or replacing an information system', 'Feasibility study: analysis of whether a proposed system is practical and worthwhile'],
    facts: ['Stages: Analysis â†’ Design â†’ Development/Testing â†’ Implementation â†’ Evaluation', 'Analysis: identify problems, gather requirements via interviews, questionnaires, observation', 'Design: create file structures, user interface mockups, algorithms, and test plans', 'Testing: use normal, extreme, and erroneous test data to verify the system works correctly', 'Implementation methods: direct changeover (risky), parallel running (safe, costly), phased/pilot rollout', 'Evaluation: compare system against original requirements; identify improvements needed']
  },
  'ict-theory-topics-9': {
    defs: ['Audience: the intended users of a document, website, or system', 'Accessibility: design that allows all users, including those with disabilities, to use a system'],
    facts: ['Audience factors to consider: age, technical expertise, language, and disability', 'Accessibility features: alt text for images, adjustable font size, screen reader compatibility', 'High colour contrast helps visually impaired users read content', 'Clear navigation benefits beginners; keyboard shortcuts benefit experienced users', 'Localisation: adapting content for language, currency, and date formats of different regions']
  },
  'ict-theory-topics-10': {
    defs: ['Email: electronic message system using SMTP to send and POP3/IMAP to receive', 'VoIP: Voice over Internet Protocol â€” real-time voice communication over the internet'],
    facts: ['Email protocols: SMTP (sending), POP3 (download to device), IMAP (sync on server)', 'Instant messaging: real-time text; video conferencing adds live video and audio', 'Spam: unsolicited bulk email; phishing is a targeted form of spam', 'FTP: File Transfer Protocol â€” transferring files between computers on a network', 'HTTP transfers web pages; HTTPS adds SSL/TLS encryption for security', 'Social media: platforms for sharing content; raises concerns about privacy and misinformation']
  },
  'ict-theory-topics-11': {
    defs: ['File: named collection of data stored on a storage medium', 'Compression: reducing file size by encoding data more efficiently'],
    facts: ['Common file types: .docx (document), .pdf (portable), .jpg/.png (images), .mp3 (audio), .csv (data)', 'Lossless compression: no data lost â€” exact original recovered (ZIP, PNG)', 'Lossy compression: some data permanently removed â€” smaller file but lower quality (JPEG, MP3)', 'File permissions: read, write, execute â€” control who can access or modify files', 'Backup types: full (all files), incremental (changes since last backup), differential (changes since last full)', 'Hierarchical folder structure organises files in directories and subdirectories']
  },
  'ict-theory-topics-12': {
    defs: ['Pixel: smallest unit of a digital image (picture element)', 'Resolution: number of pixels per unit area â€” higher resolution means more detail'],
    facts: ['Raster/bitmap images: made of pixels (JPEG, PNG, BMP) â€” quality degrades when enlarged', 'Vector images: made of mathematical paths (SVG) â€” scale without quality loss', 'Colour depth: bits per pixel; 8-bit = 256 colours; 24-bit = 16.7M colours (true colour)', 'Higher resolution and colour depth produce larger file sizes', 'JPEG: lossy, best for photographs; PNG: lossless, supports transparency; GIF: limited colours, supports animation'],
    formulae: ['File size (image) = width (px) Ã— height (px) Ã— colour depth (bits)']
  },
  'ict-theory-topics-13': {
    defs: ['Layout: arrangement of text, images, and other elements on a page or screen'],
    facts: ['Headers and footers appear on every page â€” contain page numbers, titles, or dates', 'Margins: white space around page content; consistent margins look professional', 'Columns: multi-column layout aids readability for newsletters and newspapers', 'Templates: pre-designed layouts ensure consistency across a document', 'House style: an organisation\'s standard design guide covering fonts, colours, and logo placement', 'Consistent formatting throughout a document improves readability and professionalism']
  },
  'ict-theory-topics-14': {
    defs: ['Style: named set of formatting attributes (font, size, colour) applied to text'],
    facts: ['Paragraph styles (Heading 1, Body Text) maintain a clear visual hierarchy', 'Applying styles rather than manual formatting makes global changes easy', 'Serif fonts (e.g. Times New Roman) suit print; sans-serif (e.g. Arial) suit screens', 'Text formatting attributes include: bold, italic, underline, colour, and alignment', 'CSS in web design: .class { property: value; } separates style from content', 'Cascading in CSS: styles inherit from parent elements; more specific rules override less specific ones']
  },
  'ict-theory-topics-15': {
    defs: ['Proofreading: carefully checking a document for errors before publishing or distributing', 'Spell check: automated tool that compares words against a dictionary'],
    facts: ['Spell check finds misspelt words but not wrongly used words (e.g. their vs there)', 'Grammar check highlights potential grammar issues but is not always accurate', 'Find and Replace: search for specific text and change it throughout a document', 'Track Changes: records edits by different users for review and collaborative editing', 'Validation: checking data meets specific rules (e.g. number within allowed range)', 'Verification: confirming data was entered correctly (e.g. double-entry, visual check)']
  },
  'ict-theory-topics-16': {
    defs: ['Chart/Graph: visual representation of data to show patterns, trends, and comparisons'],
    facts: ['Bar chart: comparing discrete categories â€” bars should not touch', 'Line graph: showing trends over time â€” data points joined by lines', 'Pie chart: showing proportions of a whole â€” each slice angle is proportional to the value', 'Scatter graph: shows correlation between two variables', 'Every chart must have a title, labelled axes (with units), and a legend if needed', 'Choosing the right chart type depends on the data type and the message you want to show']
  },
  // â€”â€”â€” NEW: ICT Practical â€”â€”â€”
  'ict-practical-topics-17': {
    defs: ['Word processing: creating, editing, and formatting text documents', 'Mail merge: combining a template document with a data source to produce personalised copies'],
    facts: ['Styles: named formatting sets â€” apply to headings and body text for consistency', 'Tables: rows and columns to organise data; can have formatted borders and shading', 'Headers/footers contain page numbers, dates, or document title and appear on every page', 'Mail merge uses a data source (e.g. CSV/database) with merge fields in the template document', 'Save as PDF to preserve formatting when sharing with people using different software', 'Track changes and comments are collaboration tools used during document review']
  },
  'ict-practical-topics-18': {
    defs: ['Database: organised collection of structured data stored and accessed electronically', 'Query: a request to retrieve or manipulate records in a database that meet specific criteria'],
    facts: ['Tables contain records (rows) and fields (columns)', 'Primary key: unique identifier field in each table (e.g. StudentID) â€” no duplicates allowed', 'Foreign key: field that references the primary key of another table â€” links related tables', 'Forms: user-friendly interface for entering and viewing data in a table', 'Reports: formatted output summarising query results for printing or presenting', 'Wildcards in queries: * matches any number of characters; ? matches a single character', 'Logical operators: AND, OR, NOT, BETWEEN, LIKE used to filter query results']
  },
  'ict-practical-topics-19': {
    defs: ['Presentation software: tool for creating slideshows (e.g. Microsoft PowerPoint)'],
    facts: ['Slide layout: title, content, two-content etc. â€” choose to suit the slide\'s purpose', 'Animation: movement effects applied to individual elements on a slide', 'Transitions: effects between slides â€” keep subtle to avoid distracting the audience', 'Too much text per slide reduces effectiveness; use short bullet points and visuals instead', 'Slide master: controls the design of all slides â€” change once, updates automatically', 'Speaker notes: notes visible only to the presenter, not displayed to the audience', 'File formats: .pptx (editable), .pdf (portable read-only), .ppsx (auto-play show)']
  },
  // â€”â€”â€” NEW: Computer Science â€”â€”â€”
  'cs-topics1-2': {
    defs: ['Data transmission: the process of sending data between devices or systems', 'Protocol: agreed set of rules for how data is formatted, sent, and received between systems'],
    facts: ['Serial transmission: bits sent one at a time along a single channel â€” reliable over long distances', 'Parallel transmission: multiple bits sent simultaneously â€” faster but only over short distances', 'Simplex: one direction only (keyboard â†’ computer)', 'Half-duplex: both directions but not simultaneously (walkie-talkie)', 'Full-duplex: both directions at the same time (telephone call)', 'Parity check: an extra parity bit is added so total number of 1s is always even (or odd) to detect errors', 'Check digit: extra digit calculated from the other digits to detect entry errors (used in ISBN, barcodes)'],
    formulae: ['Even parity: total count of 1 bits (data + parity bit) must be even']
  },
  'cs-topics1-4': {
    defs: ['Operating system: software that manages hardware resources and provides an interface for programs', 'Compiler: translates an entire high-level program into machine code in one step before execution'],
    facts: ['OS functions: process management, memory management, file management, device management, user interface', 'Interpreter: translates and executes high-level code line-by-line â€” slower but easier to debug', 'Assembler: converts assembly language (mnemonics like MOV, ADD) into machine code (binary)', 'High-level language: human-readable (Python, Java) â€” needs translation; portable across machines', 'Low-level language: close to machine code (Assembly) â€” fast but hardware-specific', 'IDE: Integrated Development Environment provides editor, compiler/interpreter, and debugger in one tool']
  },
  'cs-topics1-5': {
    defs: ['URL: Uniform Resource Locator â€” the address of a resource on the internet', 'DNS: Domain Name System â€” translates human-readable domain names into IP addresses'],
    facts: ['HTTP: HyperText Transfer Protocol â€” transfers web pages; HTTPS adds SSL/TLS encryption', 'Web browser: client software that sends HTTP requests and renders HTML/CSS/JS responses', 'Web server: software that responds to HTTP requests by serving files to clients', 'Cloud computing: using remote servers accessed over the internet for storage, processing, or software', 'Streaming: data delivered continuously in real time â€” user does not wait for full download', 'IoT: Internet of Things â€” everyday objects with sensors connected to the internet to send/receive data']
  },
  'cs-topics1-6': {
    defs: ['Sensor: device that detects a physical input (temperature, light, motion) and converts it to a signal', 'Actuator: output device that causes a physical effect in response to a control signal (motor, valve, LED)'],
    facts: ['Microcontroller: small computer on a single chip; reads sensors and controls actuators', 'Feedback loop: sensor readings are used to adjust system behaviour (e.g. thermostat)', 'Robotics: programmable machines that use sensors and actuators to interact with the physical world', 'Artificial Intelligence: systems that perform tasks normally needing human intelligence (recognition, decisions)', 'Machine learning: AI systems that learn and improve by being trained on large sets of data', 'Expert systems: simulate the decision-making of a human expert using a knowledge base and rules']
  },
  'cs-topics2-9': {
    defs: ['DBMS: Database Management System â€” software that creates, manages, and provides access to databases', 'Primary key: a field that uniquely identifies every record in a table â€” no two records can have the same value'],
    facts: ['Table: organises data into rows (records) and columns (fields)', 'Foreign key: a field in one table that references the primary key of another table â€” links related data', 'SELECT fieldnames FROM table WHERE condition: basic SQL query structure to retrieve data', 'INSERT INTO table VALUES (â€¦): SQL command to add a new record', 'UPDATE table SET field=value WHERE condition: SQL to modify existing records', 'DELETE FROM table WHERE condition: SQL to remove records', 'ORDER BY field ASC/DESC: sorts query results; LIKE uses % as wildcard']
  },
  // â€”â€”â€” NEW: Business Studies â€”â€”â€”
  'bus-topics-2': {
    defs: ['Motivation: the internal and external factors that drive a person to work and put in effort', 'Organisational structure: the way a business arranges roles, responsibilities, and communication'],
    facts: ['Taylor (Scientific Management): money is the main motivator â€” pay workers more for higher output', 'Maslow\'s Hierarchy: Physiological â†’ Safety â†’ Social â†’ Esteem â†’ Self-actualisation needs', 'Herzberg Two-Factor Theory: hygiene factors prevent dissatisfaction (pay, conditions); motivators create satisfaction (achievement, recognition)', 'Delegation: passing authority to a subordinate to complete tasks and make decisions', 'Span of control: number of staff directly managed by one manager', 'Flat structure: few management layers â€” wide span of control, faster communication', 'Tall structure: many layers â€” narrow span of control, slower communication up the hierarchy']
  },
  'bus-topics-6': {
    defs: ['External influence: factor outside the business that affects its operations and decisions', 'Globalisation: increasing economic, cultural, and political interconnection of the world'],
    facts: ['Government policies: taxation affects profit; subsidies reduce costs; minimum wage affects labour costs', 'Legislation: consumer protection, health & safety, and employment laws all affect business operations', 'Inflation: rising price levels reduce consumer purchasing power and can increase business costs', 'Exchange rates: strong local currency makes exports more expensive but imports cheaper', 'Sustainability: businesses face pressure to reduce waste, use renewable energy, and cut carbon emissions', 'Multinational corporations: bring investment and jobs to developing nations but may exploit low wages and avoid local tax']
  },
  // â€”â€”â€” NEW: Science Biology â€”â€”â€”
  'sci-bio-topics-2': {
    defs: ['Cell membrane: selectively permeable barrier that controls what enters and leaves the cell', 'Nucleus: control centre of the cell; contains DNA in chromosomes'],
    facts: ['Mitochondria: site of aerobic respiration â€” produces ATP energy for the cell', 'Ribosomes: site of protein synthesis; found in cytoplasm or on rough endoplasmic reticulum', 'Chloroplasts: found in plant cells; contain chlorophyll for photosynthesis', 'Cell wall: made of cellulose in plants; provides structural support and is fully permeable', 'Large central vacuole in plant cells is filled with cell sap; maintains turgor pressure', 'Prokaryotic cells (bacteria): no nucleus, no membrane-bound organelles, smaller than eukaryotic cells']
  },
  'sci-bio-topics-4': {
    defs: ['Carbohydrate: organic molecule made of C, H, O used mainly for energy; monomers are monosaccharides', 'Protein: polymer of amino acids; functions include enzymes, antibodies, structural materials, and hormones'],
    facts: ['Test for glucose: Benedict\'s reagent â€” blue â†’ brick-red precipitate if sugar present', 'Test for starch: iodine solution â€” brown â†’ blue-black if starch present', 'Test for protein: Biuret reagent â€” blue â†’ purple if protein present', 'Test for fat: ethanol emulsion test â€” milky-white layer forms if fat present', 'Lipids (fats and oils): made of glycerol and fatty acids; used for long-term energy storage, insulation, and cell membranes', 'Water: essential for transport, chemical reactions, and temperature regulation (high specific heat capacity)']
  },
  'sci-bio-topics-5': {
    defs: ['Enzyme: biological catalyst that speeds up metabolic reactions without being consumed', 'Active site: specific region of an enzyme molecule where a complementary substrate binds'],
    facts: ['Lock-and-key model: enzyme active site fits exactly with one specific substrate shape', 'Optimum temperature/pH: reaction rate is highest; deviation from optimum reduces activity', 'Denaturation: irreversible change to enzyme shape at high temperature or extreme pH â€” active site altered', 'Amylase: digests starch â†’ maltose; produced in salivary glands and pancreas', 'Protease: digests proteins â†’ amino acids; produced in stomach (pepsin) and pancreas', 'Lipase: digests lipids â†’ glycerol + fatty acids; produced in pancreas', 'Enzymes lower activation energy, increasing reaction rate without changing the overall energy change']
  },
  'sci-bio-topics-6': {
    defs: ['Chlorophyll: green pigment in chloroplasts that absorbs light energy to drive photosynthesis'],
    facts: ['Photosynthesis occurs in chloroplasts, mainly in palisade mesophyll cells of leaves', 'Leaf adaptations: large surface area, thin, transparent cuticle, stomata for gas exchange, veins for transport', 'Limiting factors for photosynthesis: light intensity, COâ‚‚ concentration, and temperature', 'If one factor is limiting, increasing others has no effect on the rate', 'Nitrate ions: needed to make amino acids and proteins; deficiency causes stunted growth', 'Magnesium ions: needed to make chlorophyll; deficiency causes yellow leaves (chlorosis)'],
    formulae: ['6COâ‚‚ + 6Hâ‚‚O + light energy â†’ Câ‚†Hâ‚â‚‚Oâ‚† + 6Oâ‚‚']
  },
  'sci-bio-topics-7': {
    defs: ['Digestion: breaking down large insoluble food molecules into small soluble ones that can be absorbed', 'Peristalsis: wave-like muscular contractions that push food along the digestive tract'],
    facts: ['Mouth: teeth mechanically break food; salivary amylase begins starch digestion', 'Stomach: hydrochloric acid (pH 2) kills bacteria and activates pepsin which digests protein', 'Small intestine (ileum): enzymes from pancreas complete digestion; villi absorb nutrients into blood', 'Villi adaptations for absorption: large surface area, thin walls, good blood supply, microvilli', 'Large intestine (colon): absorbs water; remaining material forms faeces', 'Bile: made in liver, stored in gall bladder; emulsifies fats to increase surface area for lipase']
  },
  'sci-bio-topics-8': {
    defs: ['Transpiration: loss of water vapour from leaves through stomata by evaporation', 'Xylem: vascular tissue transporting water and dissolved minerals from roots upward; dead lignified cells'],
    facts: ['Phloem: living tissue transporting dissolved sugars (sucrose) from leaves to the rest of the plant', 'Root hair cells: increase surface area for absorption of water by osmosis and mineral ions by active transport', 'Transpiration rate increases with: higher temperature, lower humidity, higher wind speed, higher light intensity', 'Guard cells control stomatal opening â€” become turgid in light â†’ stomata open; flaccid â†’ stomata close', 'Water moves up xylem by transpiration pull (cohesion-tension theory)', 'Translocation: movement of sucrose in phloem from source (leaves) to sink (roots, fruits, growing tips)']
  },
  'sci-bio-topics-9': {
    defs: ['Plasma: liquid part of blood (~55%) transporting dissolved substances throughout the body', 'Haemoglobin: iron-containing protein in red blood cells that binds and carries oxygen'],
    facts: ['Red blood cells: biconcave disc shape, no nucleus, packed with haemoglobin, transport Oâ‚‚', 'White blood cells: phagocytes engulf pathogens by phagocytosis; lymphocytes produce antibodies', 'Platelets: cell fragments that release clotting factors to seal wounds', 'Arteries: thick muscular walls, carry blood away from heart at high pressure', 'Veins: thinner walls, carry blood toward heart, contain valves to prevent backflow', 'Capillaries: one cell thick; site of exchange of gases, nutrients, and waste with body tissues', 'Double circulatory system: pulmonary (heart â†’ lungs â†’ heart) and systemic (heart â†’ body â†’ heart)'],
    formulae: ['Cardiac output = heart rate Ã— stroke volume']
  },
  'sci-bio-topics-10': {
    defs: ['Pathogen: microorganism that causes disease (bacteria, virus, fungus, or protozoan)', 'Antibody: protein produced by B-lymphocytes that binds specifically to a matching antigen'],
    facts: ['Bacteria cause disease by producing toxins; viruses reproduce inside host cells and destroy them', 'Antigen: specific protein on the surface of a pathogen that triggers an immune response', 'Active immunity: body produces its own antibodies after infection or vaccination â€” long-lasting', 'Passive immunity: antibodies received from another source (mother\'s milk, injection) â€” temporary', 'Vaccination: introduces weakened/dead pathogens or antigens â†’ immune system makes antibodies + memory cells', 'Antibiotics kill bacteria but are ineffective against viruses; overuse leads to antibiotic resistance', 'MRSA: antibiotic-resistant bacterium â€” example of natural selection producing a resistant strain']
  },
  'sci-bio-topics-11': {
    defs: ['Alveolus (pl. alveoli): tiny air sac in the lungs where gas exchange between air and blood occurs', 'Tidal volume: volume of air inhaled or exhaled with each normal resting breath'],
    facts: ['Alveoli adaptations: very large total surface area, thin walls (one cell thick), moist surface, rich capillary blood supply', 'Breathing in: intercostal muscles and diaphragm contract â†’ thorax volume increases â†’ air rushes in', 'Breathing out: intercostal muscles and diaphragm relax â†’ thorax volume decreases â†’ air pushed out', 'Gas exchange: Oâ‚‚ diffuses from alveoli into blood; COâ‚‚ diffuses from blood into alveoli', 'Vital capacity: maximum volume of air that can be exhaled after a maximum inhalation', 'Smoking: damages cilia, produces excess mucus, destroys alveolar walls (emphysema), causes lung cancer']
  },
  'sci-bio-topics-12': {
    defs: ['Aerobic respiration: release of energy from glucose using oxygen â€” efficient, produces COâ‚‚ and water', 'ATP: adenosine triphosphate â€” the immediate energy currency used by cells for all life processes'],
    facts: ['Aerobic respiration occurs in the mitochondria', 'Anaerobic respiration releases energy from glucose without oxygen â€” less efficient', 'In muscles during intense exercise: anaerobic respiration produces lactic acid â†’ cramp and fatigue', 'Oxygen debt: extra oxygen required after anaerobic exercise to oxidise lactic acid', 'Yeast anaerobic respiration: glucose â†’ ethanol + COâ‚‚ (fermentation, used in baking and brewing)', 'Energy from respiration is used for: muscle contraction, active transport, cell division, maintaining body temperature'],
    formulae: ['Aerobic: Câ‚†Hâ‚â‚‚Oâ‚† + 6Oâ‚‚ â†’ 6COâ‚‚ + 6Hâ‚‚O + ATP energy', 'Anaerobic (muscle): glucose â†’ lactic acid + ATP', 'Anaerobic (yeast): glucose â†’ ethanol + COâ‚‚ + ATP']
  },
  'sci-bio-topics-13': {
    defs: ['Neuron: nerve cell specialised to conduct electrical impulses rapidly over long distances', 'Hormone: chemical messenger secreted by an endocrine gland, transported in blood to a target organ'],
    facts: ['Nervous system: electrical signals along neurons â€” fast, short-lived, localised response', 'Endocrine system: chemical hormones via blood â€” slower, longer-lasting, widespread effect', 'Reflex arc: receptor â†’ sensory neuron â†’ relay neuron (spinal cord) â†’ motor neuron â†’ effector', 'Synapse: junction between neurons; neurotransmitter chemicals diffuse across the synaptic gap', 'Insulin (from pancreas Î² cells): lowers blood glucose by stimulating uptake by liver and muscle cells', 'Glucagon (from pancreas Î± cells): raises blood glucose by stimulating glycogen breakdown in liver', 'ADH (from pituitary): regulates water reabsorption in kidney tubules to control blood water potential']
  },
  'sci-bio-topics-14': {
    defs: ['Drug: chemical substance that alters the way the body or mind functions', 'Antibiotic: drug that kills or inhibits the growth of bacteria (not effective against viruses)'],
    facts: ['Depressants slow the nervous system â€” examples: alcohol, sedatives, heroin', 'Stimulants speed up the nervous system â€” examples: caffeine, nicotine, cocaine', 'Hallucinogens alter sensory perception â€” examples: LSD, cannabis', 'Nicotine: highly addictive; causes increased heart rate and blood pressure; found in tobacco', 'Long-term alcohol use causes liver cirrhosis, damages brain cells, and impairs coordination', 'Antibiotic resistance arises through natural selection: bacteria that survive treatment reproduce and spread the resistance gene', 'Patients must complete the full course of antibiotics to prevent resistant strains from surviving']
  },
  'sci-bio-topics-15': {
    defs: ['Fertilisation: fusion of a male gamete with a female gamete to form a diploid zygote', 'Gamete: a sex cell (sperm or egg) containing the haploid number of chromosomes (23 in humans)'],
    facts: ['Human sperm: haploid, motile, small; egg (ovum): haploid, large, non-motile', 'Menstrual cycle (~28 days): FSH stimulates egg maturation; LH surge triggers ovulation (day 14)', 'Oestrogen: thickens uterine lining; inhibits FSH; used in the combined contraceptive pill', 'In plants: pollination = transfer of pollen; fertilisation occurs in ovule â†’ seed; ovary becomes fruit', 'Asexual reproduction: produces genetically identical clones (e.g. binary fission in bacteria, runners in plants)', 'Sexual reproduction: produces genetic variation in offspring â€” advantageous for adapting to environmental changes']
  },
  'sci-bio-topics-16': {
    defs: ['Gene: a section of DNA that codes for a specific polypeptide (and therefore protein)', 'Allele: one of two or more alternative forms of a gene found at the same locus on homologous chromosomes'],
    facts: ['Chromosomes: thread-like structures in the nucleus made of DNA and protein; humans have 46 (23 pairs)', 'Dominant allele: expressed when one or two copies are present (capital letter, e.g. B)', 'Recessive allele: only expressed when two copies are present (lowercase, e.g. b)', 'Homozygous: two identical alleles (BB or bb); Heterozygous: two different alleles (Bb)', 'Genotype: allele combination an organism carries; Phenotype: observable characteristic expressed', 'Sex determination: XX = female; XY = male â€” sex chromosomes are the 23rd pair', 'Punnett square: grid used to predict the genotype and phenotype ratios of offspring'],
    formulae: ['Probability (%) = (number with trait Ã· total offspring) Ã— 100']
  },
  'sci-bio-topics-17': {
    defs: ['Variation: differences in characteristics between individuals of the same species', 'Natural selection: differential survival and reproduction of individuals with favourable traits'],
    facts: ['Continuous variation: gradual range of values (height, mass) â€” influenced by many genes and environment', 'Discontinuous variation: distinct categories with no intermediate forms (blood group, tongue-rolling)', 'Mutation: random change in DNA base sequence; can be spontaneous or caused by radiation/chemicals', 'Natural selection steps: variation exists â†’ some variants better suited â†’ these survive and reproduce more â†’ traits passed on', 'Selective breeding (artificial selection): humans choose organisms with desired traits to breed â€” reduces genetic diversity', 'Genetic engineering: inserting a specific gene from one organism into another (e.g. human insulin gene into bacteria)']
  },
  'sci-bio-topics-18': {
    defs: ['Ecosystem: the community of living organisms plus the non-living environment they interact with', 'Food chain: a sequence showing how energy and matter are transferred through feeding relationships'],
    facts: ['Producer: autotroph that makes its own food via photosynthesis; always at the start of a food chain', 'Consumer: heterotroph that eats other organisms; primary (eats plants), secondary (eats primary consumers)', 'Decomposer: bacteria and fungi that break down dead organisms, returning nutrients to the soil', 'Only ~10% of energy is transferred to the next trophic level; rest is lost as heat, movement, waste', 'Pyramid of numbers: shows number of organisms at each level; can be inverted (e.g. one tree supporting many insects)', 'Carbon cycle: photosynthesis removes COâ‚‚ from air; respiration, combustion, and decomposition return it'],
    formulae: ['Energy efficiency (%) = (energy in next level Ã· energy in current level) Ã— 100']
  },
  'sci-bio-topics-19': {
    defs: ['Biodiversity: the variety of different species and genetic variation within an ecosystem', 'Eutrophication: excess nutrients (from fertiliser runoff) in water â†’ algal bloom â†’ reduced oxygen â†’ aquatic organisms die'],
    facts: ['Deforestation: destroys habitats, reduces biodiversity, releases stored carbon dioxide, increases soil erosion', 'Greenhouse gases (COâ‚‚, CHâ‚„, water vapour) trap infrared radiation â†’ global warming', 'Global warming causes: rising sea levels, more extreme weather, shifts in species distributions', 'Air pollution: combustion releases COâ‚‚ (warming), SOâ‚‚ (acid rain), CO (toxic), particulates (health)', 'Conservation methods: national parks, captive breeding programmes, seed banks, habitat corridors, international treaties', 'Sustainable agriculture: maintaining soil fertility, reducing pesticide use, protecting native species']
  },
  // â€”â€”â€” NEW: Science Chemistry â€”â€”â€”
  'sci-chem-topics-2': {
    defs: ['Ion: atom or group of atoms that has gained or lost electrons, giving it an overall electric charge', 'Ionic bond: electrostatic attraction between oppositely charged ions in a giant lattice structure'],
    facts: ['Metals lose electrons â†’ positive ions (cations); non-metals gain electrons â†’ negative ions (anions)', 'Ionic compounds: high melting/boiling points; conduct electricity when molten or dissolved (ions free to move)', 'Covalent bond: shared pair of electrons between two non-metal atoms', 'Simple covalent molecules: low melting points due to weak intermolecular forces between molecules', 'Giant covalent structures (diamond, graphite, SiOâ‚‚): very high melting points, strong bonds throughout', 'Metallic bonding: sea of delocalised electrons around positive metal ions â€” conducts electricity and heat well']
  },
  'sci-chem-topics-3': {
    defs: ['Mole: amount of substance containing Avogadro\'s number of particles (6.02 Ã— 10Â²Â³)', 'Molar mass: mass of one mole of a substance in g/mol; numerically equal to relative formula mass (Mr)'],
    facts: ['Relative atomic mass (Ar): average mass of atoms of an element relative to 1/12 the mass of Â¹Â²C', 'Relative formula mass (Mr): sum of Ar values of all atoms in the chemical formula', 'Empirical formula: simplest whole number ratio of atoms (e.g. CHâ‚‚O for glucose)', 'Molecular formula: actual number of atoms per molecule (e.g. Câ‚†Hâ‚â‚‚Oâ‚† for glucose)', 'Percentage yield = (actual yield Ã· theoretical yield) Ã— 100'],
    formulae: ['n = m/M  (moles = mass Ã· molar mass)', 'c = n/V  (concentration = moles Ã· volume in dmÂ³)', 'Avogadro constant: Nâ‚ = 6.02 Ã— 10Â²Â³ molâ»Â¹']
  },
  'sci-chem-topics-4': {
    defs: ['Electrolysis: the breakdown of an ionic compound (electrolyte) using an electric current', 'Electrolyte: ionic substance in solution or molten state that conducts electricity by ion movement'],
    facts: ['Cathode: negative electrode â€” positive ions (cations) gain electrons here (reduction occurs)', 'Anode: positive electrode â€” negative ions (anions) lose electrons here (oxidation occurs)', 'Electroplating: depositing a thin metal layer on an object using electrolysis to improve appearance or protection', 'Electrolysis of water: Hâ‚‚ gas produced at cathode, Oâ‚‚ gas produced at anode (2:1 volume ratio)', 'Electrolysis of brine (NaCl solution): Clâ‚‚ at anode, Hâ‚‚ at cathode, NaOH solution remains', 'Active electrode dissolves if made from the same metal being deposited (used in copper refining)']
  },
  'sci-chem-topics-5': {
    defs: ['Exothermic reaction: releases energy to surroundings â€” temperature of surroundings increases', 'Endothermic reaction: absorbs energy from surroundings â€” temperature of surroundings decreases'],
    facts: ['Bond breaking is endothermic (requires energy); bond forming is exothermic (releases energy)', 'Overall exothermic if energy released (bond forming) > energy absorbed (bond breaking)', 'Examples of exothermic: combustion, neutralisation, respiration, oxidation reactions', 'Examples of endothermic: thermal decomposition, photosynthesis, dissolving ammonium nitrate', 'Activation energy: minimum energy particles must have to react; catalysts provide a lower energy pathway'],
    formulae: ['Q = mcÎ”T  (heat energy = mass Ã— specific heat capacity Ã— temperature change)']
  },
  'sci-chem-topics-6': {
    defs: ['Rate of reaction: change in amount of reactant consumed (or product formed) per unit time', 'Catalyst: substance that increases the rate of a reaction without being used up â€” lowers activation energy'],
    facts: ['Higher concentration â†’ more particles per unit volume â†’ more frequent collisions â†’ faster rate', 'Higher temperature â†’ particles have more kinetic energy â†’ more energetic and more frequent collisions', 'Smaller particle size (larger surface area) â†’ more particles exposed at surface â†’ more collisions', 'Catalysts provide an alternative reaction pathway with a lower activation energy', 'Reversible reaction: can proceed in both forward and reverse directions (shown with â‡Œ)', 'Le Chatelier\'s Principle: a system at equilibrium responds to a change by shifting to oppose that change'],
    formulae: ['Rate = amount of reactant used (or product formed) Ã· time']
  },
  'sci-chem-topics-8': {
    defs: ['Period: a horizontal row in the periodic table â€” elements have the same number of electron shells', 'Group: a vertical column â€” elements have the same number of outer shell electrons â†’ similar chemical properties'],
    facts: ['Group 1 (alkali metals): soft, react with water â†’ metal hydroxide + Hâ‚‚; reactivity increases down group as outer electron is further from nucleus', 'Group 7 (halogens): diatomic molecules; more reactive halogens displace less reactive ones from their salts', 'Group 0 (noble gases): full outer electron shell â†’ unreactive; used in balloons (He) and lighting (Ar)', 'Transition metals: high density, high melting points, good conductors, form coloured compounds, act as catalysts', 'Across a period (left to right): atomic radius decreases, metal to non-metal character changes']
  },
  'sci-chem-topics-9': {
    defs: ['Reactivity series: ranking of metals from most to least reactive (K > Na > Ca > Mg > Al > Zn > Fe > Cu)', 'Ore: rock containing a metal compound in sufficient concentration for economic extraction'],
    facts: ['More reactive metals displace less reactive metals from solutions (displacement reaction)', 'Very reactive metals (Na, K, Ca, Mg, Al): extracted by electrolysis of molten compounds', 'Less reactive metals (Zn, Fe, Cu): extracted by reduction with carbon or carbon monoxide', 'Blast furnace: iron ore + coke + limestone â†’ iron + COâ‚‚; CO reduces Feâ‚‚Oâ‚ƒ', 'Rusting: iron reacts with Oâ‚‚ and water â†’ iron(III) oxide (Feâ‚‚Oâ‚ƒÂ·Hâ‚‚O); only iron and steel rust', 'Rust prevention: painting, galvanising (zinc coating), using stainless steel (alloy), sacrificial protection (zinc block)']
  },
  'sci-chem-topics-10': {
    defs: ['Greenhouse gas: gas that absorbs and re-emits infrared radiation, trapping heat in the atmosphere'],
    facts: ['Main greenhouse gases: COâ‚‚ (from combustion), methane (from farming/landfill), water vapour', 'Global warming effects: rising sea levels, more extreme weather, melting ice caps, habitat loss', 'Acid rain: SOâ‚‚ and NOâ‚‚ from burning fossil fuels dissolve in rain â†’ pH < 5.6 â†’ damages ecosystems', 'Water treatment steps: screening â†’ sedimentation â†’ filtration â†’ chlorination', 'Hard water: contains dissolved CaÂ²âº and MgÂ²âº ions â†’ prevents soap lathering, forms limescale in pipes', 'Carbon monoxide (CO) from incomplete combustion: colourless, odourless, toxic â€” binds to haemoglobin']
  },
  'sci-chem-topics-11': {
    defs: ['Hydrocarbon: organic compound containing only carbon and hydrogen atoms', 'Alkane: saturated hydrocarbon with only single Câ€“C bonds; general formula Câ‚™Hâ‚‚â‚™â‚Šâ‚‚'],
    facts: ['Alkenes: unsaturated hydrocarbons with one C=C double bond; general formula Câ‚™Hâ‚‚â‚™; decolourise bromine water', 'Fractional distillation separates crude oil by boiling point; shorter carbon chains = lower boiling point', 'Cracking: breaks large alkane molecules into smaller, more useful alkanes and alkenes (thermal or catalytic)', 'Addition polymerisation: many alkene monomers (e.g. ethene) join to form a long chain polymer (poly(ethene))', 'Ethanol production: fermentation of sugars using yeast (anaerobic); or addition of steam to ethene (industrial)', 'Carboxylic acids (âˆ’COOH group): weak acids; ethanoic acid is in vinegar; react with alcohols to form esters']
  },
  'sci-chem-topics-12': {
    defs: ['Chromatography: technique for separating components of a mixture based on how they travel through a medium'],
    facts: ['Paper/TLC chromatography: Rf value identifies a substance; pure substance gives one spot at constant Rf', 'Distillation: separates liquids by boiling point; simple for large differences, fractional for close boiling points', 'Filtration: separates an insoluble solid from a liquid mixture', 'Crystallisation: obtains a pure solid from solution by carefully evaporating the solvent', 'Tests: Hâ‚‚ â€” "pop" with lit splint; Oâ‚‚ â€” relights glowing splint; COâ‚‚ â€” turns limewater milky; Clâ‚‚ â€” bleaches damp litmus', 'Flame tests: Li = red, Na = yellow, K = lilac, Ca = orange-red, Cu = green'],
    formulae: ['Rf = distance moved by substance Ã· distance moved by solvent front']
  },
  // â€”â€”â€” NEW: Science Physics â€”â€”â€”
  'sci-phys-topics-2': {
    defs: ['Specific heat capacity: energy required to raise the temperature of 1 kg of a substance by 1Â°C (or 1 K)', 'Latent heat: energy absorbed or released during a change of state with no temperature change'],
    facts: ['Conduction: heat transfer through vibrating particles passing energy along; best in metals', 'Convection: heat transfer in fluids â€” warm fluid less dense, rises; cool fluid sinks, creating convection current', 'Radiation (infrared): electromagnetic wave transfer; travels through vacuum; dark matt surfaces best absorbers/emitters', 'White/shiny surfaces are poor absorbers and poor emitters of infrared radiation', 'Changes of state: melting (solidâ†’liquid), boiling (liquidâ†’gas) absorb energy; freezing, condensing release energy'],
    formulae: ['Q = mcÎ”T  (thermal energy = mass Ã— specific heat capacity Ã— temperature change)', 'Q = mL  (energy during change of state = mass Ã— specific latent heat)']
  },
  'sci-phys-topics-3': {
    defs: ['Transverse wave: oscillation is perpendicular to the direction of energy transfer (e.g. light, water waves)', 'Longitudinal wave: oscillation is parallel to the direction of energy transfer (e.g. sound waves)'],
    facts: ['Wave properties: amplitude (max displacement), wavelength (Î», distance per cycle), frequency (f, cycles per second), speed (v)', 'Reflection: angle of incidence = angle of reflection (both measured from the normal to the surface)', 'Refraction: waves change direction when their speed changes at a boundary (e.g. light into glass)', 'Total internal reflection: occurs when angle of incidence exceeds the critical angle; used in optical fibres', 'EM spectrum (lowest to highest frequency): radio â†’ microwave â†’ infrared â†’ visible â†’ UV â†’ X-ray â†’ gamma ray', 'Sound is a longitudinal wave; travels fastest in solids, then liquids, then gases; cannot travel through a vacuum'],
    formulae: ['v = fÎ»  (wave speed = frequency Ã— wavelength)']
  },
  'sci-phys-topics-5': {
    defs: ['Radioactive decay: spontaneous emission of radiation from an unstable nucleus, changing it to a more stable form', 'Half-life: time for the activity (or number of undecayed nuclei) of a radioactive sample to halve'],
    facts: ['Alpha (Î±): helium nucleus (2p, 2n); stopped by paper/skin; high ionising power; dangerous if swallowed', 'Beta (Î²): fast-moving electron from nucleus; stopped by a few mm aluminium; moderate ionising power', 'Gamma (Î³): high-frequency electromagnetic radiation; needs thick lead/concrete to stop; least ionising, most penetrating', 'Nuclear fission: heavy nucleus (e.g. Â²Â³âµU) splits into two smaller nuclei + neutrons + energy (chain reaction in reactors)', 'Nuclear fusion: two light nuclei merge (e.g. hydrogen isotopes â†’ helium); powers the Sun; requires extreme temperature/pressure', 'Uses: gamma used in cancer radiotherapy and sterilising equipment; alpha used in smoke detectors; beta used in medical tracers'],
    formulae: ['Remaining nuclei after n half-lives: N = Nâ‚€ Ã— (Â½)â¿']
  },
  'sci-phys-topics-6': {
    defs: ['Light-year: distance light travels in one year (~9.46 Ã— 10Â¹âµ m); used to measure interstellar distances', 'Main sequence star: stable star fusing hydrogen into helium in its core, balanced by gravity and radiation pressure'],
    facts: ['Solar system: the Sun plus 8 planets, moons, dwarf planets, asteroids, and comets', 'Galaxy: billions of stars held together by gravity; our galaxy is the Milky Way', 'Universe: contains billions of galaxies; estimated age â‰ˆ 13.8 billion years', 'Red-shift: light from distant galaxies is stretched to longer (redder) wavelengths â€” evidence they are moving away', 'Big Bang theory: the universe began from an extremely hot, dense point ~13.8 billion years ago and has been expanding since', 'Star life cycle (small): nebula â†’ protostar â†’ main sequence â†’ red giant â†’ white dwarf; large stars end as supernovae â†’ neutron star or black hole']
  },
  // â€”â€”â€” NEW: Additional Mathematics â€”â€”â€”
  'am-topics-3': {
    defs: ['Linear inequality: a statement that one linear expression is greater or less than another', 'Modulus function |x|: the absolute value (magnitude) of x â€” always non-negative'],
    facts: ['Solve linear inequality like an equation BUT reverse the inequality sign when multiplying or dividing by a negative number', 'Quadratic inequality: find the roots of the equation first, then use the graph shape to determine the solution set', '|x| < a âŸº âˆ’a < x < a; |x| > a âŸº x < âˆ’a or x > a', 'Set notation for solutions: {x : x > 3}, or interval notation: (3, âˆž)', 'Sketch a graph to identify regions where the inequality is satisfied'],
    formulae: ['|x âˆ’ a| < b âŸº a âˆ’ b < x < a + b']
  },
  'am-topics-4': {
    defs: ['Surd: an irrational root that cannot be simplified to a rational number (e.g. âˆš5, âˆ›7)', 'Rationalise: rewrite a fraction to remove surds from the denominator'],
    facts: ['Laws of indices: aáµ Ã— aâ¿ = aáµâºâ¿; aáµ Ã· aâ¿ = aáµâ»â¿; (aáµ)â¿ = aáµâ¿; aâ° = 1; aâ»â¿ = 1/aâ¿', 'Fractional index: a^(m/n) = â¿âˆš(aáµ); e.g. 8^(2/3) = (âˆ›8)Â² = 4', 'Simplify surds: âˆš(ab) = âˆša Ã— âˆšb', 'Rationalise 1/âˆša by multiplying by âˆša/âˆša', 'Rationalise 1/(a + âˆšb) by multiplying numerator and denominator by the conjugate (a âˆ’ âˆšb)'],
    formulae: ['aáµ Ã— aâ¿ = aáµâºâ¿', '(aáµ)â¿ = aáµâ¿', 'a^(p/q) = áµâˆš(aáµ–)']
  },
  'am-topics-5': {
    defs: ['Remainder Theorem: when polynomial f(x) is divided by (x âˆ’ a), the remainder equals f(a)', 'Factor Theorem: (x âˆ’ a) is a factor of f(x) if and only if f(a) = 0'],
    facts: ['To factorise a cubic: use factor theorem to find one root, divide out the factor, then factorise the remaining quadratic', 'Try factors of the constant term as candidate roots when applying factor theorem', 'Polynomial long division: similar to numerical long division; find how many times leading term divides', 'If f(a) = 0 then (x âˆ’ a) is a factor and a is a root (x-intercept) of the curve y = f(x)'],
    formulae: ['f(x) = (x âˆ’ a) Ã— Q(x) + R  where R = f(a)  (quotient Q(x) plus remainder R)']
  },
  'am-topics-6': {
    defs: ['Simultaneous equations: two or more equations that are all satisfied by the same set of values'],
    facts: ['Linear + linear: solve by elimination (add/subtract equations) or substitution', 'Linear + quadratic: substitute the linear equation into the quadratic to form a single quadratic', 'Number of solutions depends on discriminant: Î” > 0 â†’ two solutions; Î” = 0 â†’ one solution (line tangent to curve); Î” < 0 â†’ no real solutions', 'Graphically: solutions are the coordinates of intersection points of the two graphs', 'Always verify solutions satisfy BOTH original equations'],
    formulae: ['Discriminant Î” = bÂ² âˆ’ 4ac determines the number of real intersection points']
  },
  'am-topics-8': {
    defs: ['Gradient of a straight line: rate of change of y with respect to x; a measure of the line\'s steepness'],
    facts: ['Equation of a line: y = mx + c where m = gradient and c = y-intercept', 'Gradient between two points: m = (yâ‚‚ âˆ’ yâ‚) Ã· (xâ‚‚ âˆ’ xâ‚)', 'Parallel lines have equal gradients', 'Perpendicular lines: product of their gradients equals âˆ’1 (mâ‚ Ã— mâ‚‚ = âˆ’1)', 'Collinear points lie on the same straight line â€” check by computing gradient between consecutive pairs'],
    formulae: ['m = (yâ‚‚ âˆ’ yâ‚) / (xâ‚‚ âˆ’ xâ‚)', 'Distance = âˆš[(xâ‚‚âˆ’xâ‚)Â² + (yâ‚‚âˆ’yâ‚)Â²]', 'Midpoint = ((xâ‚+xâ‚‚)/2, (yâ‚+yâ‚‚)/2)', 'Perpendicular gradient: mâ‚‚ = âˆ’1/mâ‚']
  },
  'am-topics-9': {
    defs: ['Radian: the angle at the centre of a circle subtended by an arc equal in length to the radius'],
    facts: ['Ï€ radians = 180Â°; to convert degrees â†’ radians: multiply by Ï€/180', 'To convert radians â†’ degrees: multiply by 180/Ï€', 'Arc length and sector area formulae require the angle to be in radians', 'Area of a circular segment = sector area âˆ’ triangle area'],
    formulae: ['Arc length: s = rÎ¸  (r = radius, Î¸ in radians)', 'Sector area: A = Â½rÂ²Î¸', 'Area of triangle within sector: Â½rÂ² sin Î¸', 'Segment area: Â½rÂ²(Î¸ âˆ’ sin Î¸)']
  },
  'am-topics-11': {
    defs: ['Permutation: an ordered arrangement of objects from a set', 'Combination: a selection of objects from a set where order does not matter'],
    facts: ['n! (n factorial) = n Ã— (nâˆ’1) Ã— â€¦ Ã— 2 Ã— 1; by definition, 0! = 1', 'Key distinction: permutations count order; combinations do not', 'Arrangements with restrictions: fix the restricted items first, then count arrangements of the rest', 'Arrangements in a circle: (nâˆ’1)! for n distinct objects (fix one position as reference)', 'Identical items: divide total arrangements by the factorial of the count of identical items'],
    formulae: ['nPr = n! / (nâˆ’r)!', 'nCr = n! / (r!(nâˆ’r)!)', 'nCr = nC(nâˆ’r)  (symmetry)']
  },
  'am-topics-12': {
    defs: ['Binomial theorem: a formula for expanding (a + b)â¿ without repeated multiplication'],
    facts: ['Pascal\'s Triangle: each entry is the sum of the two entries directly above; rows give binomial coefficients', 'The general term of the expansion is Táµ£â‚Šâ‚ = â¿Cáµ£ aâ¿â»Ê³ bÊ³ where r starts at 0', 'To find a specific term: set the power of the required variable equal to r and solve', 'Binomial approximation: (1 + x)â¿ â‰ˆ 1 + nx + n(nâˆ’1)/2! xÂ² (valid for |x| < 1, used for small x)'],
    formulae: ['(a + b)â¿ = Î£ â¿Cáµ£ aâ¿â»Ê³ bÊ³  for r = 0 to n', 'General term: T_{r+1} = â¿Cáµ£ aâ¿â»Ê³ bÊ³']
  },
  'am-topics-13': {
    defs: ['Vector: a quantity that has both magnitude (size) and direction', 'Unit vector: a vector with magnitude equal to exactly 1'],
    facts: ['Vectors can be represented as column vectors (x, y) or in i-j notation (xi + yj)', 'Vectors add head-to-tail (triangle law); parallelogram law gives the resultant', 'Scalar multiplication changes the magnitude and can reverse direction', 'Position vector of P: OPâƒ— = vector from origin O to point P', 'Collinear points: APâƒ— = k Ã— ABâƒ— for some scalar k, meaning vectors are parallel and share a point'],
    formulae: ['|a| = âˆš(xÂ² + yÂ²)  for a = (x, y)', 'Unit vector: Ã¢ = a / |a|', 'ABâƒ— = OBâƒ— âˆ’ OAâƒ—']
  },
  'am-topics-17': {
    defs: ['Kinematics: the branch of mechanics studying motion without considering the forces causing it', 'Displacement: the distance moved in a specified direction (a vector quantity)'],
    facts: ['Displacement-time graph: gradient = velocity; straight line = constant velocity; curved = acceleration', 'Velocity-time graph: gradient = acceleration; area under graph = displacement', 'Equations of motion (suvat) are only valid when acceleration is constant', 'For variable acceleration: v = ds/dt (differentiate s for v); a = dv/dt (differentiate v for a)', 'Integrate v with respect to t to find s; integrate a with respect to t to find v (add constant of integration)'],
    formulae: ['v = u + at', 's = ut + Â½atÂ²', 'vÂ² = uÂ² + 2as', 's = Â½(u + v)t', 'v = âˆ«a dt + c;  s = âˆ«v dt + c']
  },
  // â€”â€”â€” NEW: Global Perspectives â€”â€”â€”
  'gp-topics-1': {
    defs: ['Demographic change: shifts in a population\'s size, age structure, or geographic distribution over time'],
    facts: ['Global population exceeded 8 billion in 2022; most growth is concentrated in developing nations', 'Ageing population: more elderly people, fewer young workers â†’ pressure on pensions, healthcare, and social services', 'Youth bulge: large young population â†’ potential economic growth OR pressure on jobs and education', 'Total fertility rate (TFR): average children per woman; TFR below 2.1 means population will eventually decline', 'Urbanisation: over 55% of world population now lives in cities; rapid urbanisation creates infrastructure pressures', 'Migration can partially offset the effects of ageing or declining populations in high-income countries']
  },
  'gp-topics-2': {
    defs: ['Education for All (EFA): UNESCO global initiative to provide quality education to every person worldwide', 'Literacy: the ability to read, write, and use numbers to a functional level in everyday life'],
    facts: ['UN Sustainable Development Goal 4: ensure inclusive and equitable quality education for all by 2030', 'Over 300 million children globally still lack access to adequate schooling', 'Gender gap: girls are disproportionately excluded from education in sub-Saharan Africa and parts of South Asia', 'Education increases earning potential, reduces poverty, improves health outcomes, and strengthens democracy', 'Barriers to education: poverty, conflict, distance to schools, disability, gender norms, child labour', 'Digital education can broaden access but risks widening the digital divide for communities without internet']
  },
  'gp-topics-3': {
    defs: ['Unemployment: the state of being able and willing to work but not having a paid job', 'Gig economy: a labour market characterised by short-term freelance contracts rather than permanent employment'],
    facts: ['Types of unemployment: cyclical (demand falls in recession), structural (skills mismatch), frictional (between jobs)', 'Youth unemployment is particularly high in many countries, limiting economic participation and social inclusion', 'Automation and AI are displacing routine manual and cognitive jobs, while creating demand for digital skills', 'Trade unions protect workers through collective bargaining for fair pay and conditions', 'Multinational corporations create jobs in developing nations but may exploit cheaper labour and fewer regulations', 'Universal Basic Income (UBI): proposed policy to give all citizens a regular unconditional payment â€” debated globally']
  },
  'gp-topics-4': {
    defs: ['Non-renewable energy: finite sources that will be depleted (coal, oil, natural gas, uranium)', 'Renewable energy: sources naturally replenished on a human timescale (solar, wind, hydro, geothermal, tidal)'],
    facts: ['Fossil fuels currently supply ~80% of global energy; combustion releases COâ‚‚, contributing to climate change', 'Nuclear energy: low carbon but produces radioactive waste; risk of accidents (Chernobyl 1986, Fukushima 2011)', 'Solar and wind power are growing rapidly but are intermittent â€” require energy storage or backup systems', 'Energy security: ensuring reliable and affordable energy supplies; drives geopolitical tensions (e.g. oil dependency)', 'Energy poverty: ~770 million people lack access to electricity, limiting education, health, and economic development', 'Fracking: hydraulic fracturing to extract shale gas; controversial due to risks of water contamination and earthquakes']
  },
  'gp-topics-5': {
    defs: ['Globalisation: the increasing economic, political, social, and cultural interconnection of the world', 'Free trade: the exchange of goods and services between countries without tariffs, quotas, or other trade barriers'],
    facts: ['Multinational corporations (MNCs) operate across many countries; may transfer technology but can avoid local taxes', 'Global supply chains: products are assembled from components made in many different countries', 'Cultural globalisation: spread of ideas, music, food, and media globally; risks cultural homogenisation', 'WTO (World Trade Organization): oversees international trade rules and resolves trade disputes', 'Anti-globalisation arguments: increases inequality, exploits developing nations, damages local industries', 'Benefits of globalisation: economic growth, technology transfer, cultural exchange, lower consumer prices']
  },
  'gp-topics-6': {
    defs: ['Rule of law: the principle that all people and institutions are subject to and accountable under the law', 'Restorative justice: approach that focuses on rehabilitating offenders and repairing harm rather than just punishing'],
    facts: ['Crime rates vary widely between countries due to inequality, poverty, policing levels, and cultural factors', 'Organised transnational crime includes drug trafficking, human trafficking, and cybercrime', 'Capital punishment is used in ~55 countries; debated on grounds of deterrence, human rights, and wrongful execution', 'Cybercrime is the fastest-growing crime type globally, including fraud, hacking, and identity theft', 'Drug policy debate: prohibition vs harm-reduction (e.g. Portugal\'s decriminalisation showed reduced drug harm)', 'High recidivism rates in punitive prison systems suggest rehabilitation programmes are more effective long-term']
  },
  'gp-topics-7': {
    defs: ['Migration: the movement of people from one place to another with the intention of settling there temporarily or permanently', 'Refugee: a person forced to flee their home country due to persecution, armed conflict, or natural disaster'],
    facts: ['UNHCR (2022): over 100 million people are forcibly displaced â€” the highest number ever recorded', 'Economic migrants move for better employment opportunities and living standards', 'Brain drain: highly skilled workers leave developing countries, creating a talent shortage at home', 'Remittances: money sent home by migrants; crucial for many developing economies (exceeds foreign aid globally)', 'Climate migration: rising sea levels, droughts, and extreme weather are increasing displacement', 'EU freedom of movement: allows citizens to live and work in any member state â€” a model of managed migration']
  },
  'gp-topics-8': {
    defs: ['Absolute poverty: lacking the basic necessities for survival â€” World Bank line: less than $2.15/day (2022)', 'Relative poverty: having an income significantly below the average in one\'s own society, limiting full participation'],
    facts: ['Gini coefficient measures income inequality: 0 = perfect equality; 1 = total inequality', 'Extreme global poverty declined for decades but COVID-19 reversed progress in many regions', 'Root causes of poverty: lack of education, poor governance, conflict, geographic isolation, and colonial history', 'The richest 1% own more wealth than the bottom 50% of the global population combined (Oxfam, 2023)', 'Microfinance: small loans to entrepreneurs in developing countries (e.g. Grameen Bank, Bangladesh)', '"Trade not aid" argument: sustainable development requires fair trade rules, not just charity']
  },
  'gp-topics-9': {
    defs: ['Commercialisation of sport: the transformation of sport into a profit-driven industry through sponsorship, broadcasting, and branding', 'Doping: the use of prohibited substances or methods to enhance athletic performance'],
    facts: ['Sport as "soft power": nations use sporting success to build international prestige and diplomacy', 'Mega-events (Olympics, World Cup): boost tourism and national pride but can displace communities and drain public funds', 'Physical activity has proven mental and physical health benefits; governments invest in sport for public health', 'Gender inequality in sport persists: women receive less pay, media coverage, and investment than men', 'E-sports (competitive gaming) are growing rapidly and challenging traditional definitions of sport', 'WADA (World Anti-Doping Agency) enforces global anti-doping rules and coordinates testing across all sports']
  },
  'gp-topics-10': {
    defs: ['Sustainable development: development that meets the needs of the present without compromising future generations\'s ability to meet their needs', 'Carbon footprint: total greenhouse gas emissions caused directly and indirectly by an individual, organisation, or product'],
    facts: ['UN Sustainable Development Goals (SDGs): 17 goals adopted by all 193 UN member states in 2015; deadline 2030', 'Paris Agreement (2015): nations committed to limiting global warming to 1.5â€“2Â°C above pre-industrial levels', 'Circular economy: design products to be reused, repaired, and recycled rather than discarded as waste', 'Tragedy of the commons: shared resources (fishing stocks, clean air) are overexploited without collective management rules', 'Climate change effects: rising sea levels, more intense storms, droughts, biodiversity loss, food insecurity', 'Individual vs systemic change: debate over whether personal lifestyle choices or government/corporate policy is the primary driver of sustainability']
  },
  'gp-topics-11': {
    defs: ['Digital divide: the gap between people who have access to modern information technology and those who do not', 'Artificial intelligence: computer systems that perform tasks normally requiring human intelligence'],
    facts: ['Over 5 billion internet users globally (2024) but ~2.7 billion remain offline, mostly in developing countries', 'Social media connects people globally but amplifies misinformation and creates echo chambers', 'Surveillance capitalism: business model of collecting user data to target advertising (e.g. Google, Meta)', 'Automation threatens routine jobs while creating new demand for digital, creative, and social skills', 'AI ethics concerns: algorithmic bias, privacy violations, lack of accountability, autonomous weapons', 'Cybersecurity is an increasing threat to individuals, businesses, critical infrastructure, and national security']
  },
  'gp-topics-12': {
    defs: ['Culture: the shared values, beliefs, customs, behaviours, and artefacts that characterise a group of people', 'Cultural imperialism: the domination of one culture over others through media, trade, and political influence'],
    facts: ['Cultural identity provides a sense of belonging and community but can also lead to exclusion of others', 'UNESCO World Heritage Sites: protect places of outstanding cultural or natural significance for humanity', 'Diaspora communities: groups living outside their country of origin who maintain their cultural traditions', 'Religion is a major source of cultural identity; religious extremism can be a source of conflict', 'Traditional practices may be valued cultural heritage or may violate human rights (e.g. child marriage, FGM)', 'Youth culture often drives social and cultural change, sometimes creating tension with older generations']
  },
  'gp-topics-13': {
    defs: ['Infrastructure: the fundamental physical systems a society needs to function (roads, power grids, water supply, internet)', 'Sustainable transport: methods of moving people and goods that minimise environmental impact'],
    facts: ['Lack of infrastructure limits economic development and access to education and healthcare in rural areas', 'Belt and Road Initiative (China): large-scale infrastructure investment in Asia, Africa, and Europe; debated as development vs "debt trap diplomacy"', 'Electric vehicles reduce local air pollution but depend on clean electricity generation and require rare mineral mining', 'Aviation emits ~2.5% of global COâ‚‚; it is difficult to decarbonise; carbon offset schemes are controversial', 'Investment in public transport is more energy-efficient per passenger than private car use', 'Smart cities use sensor networks and data analytics to manage traffic, waste, and energy more efficiently']
  },
  'gp-topics-14': {
    defs: ['Food security: when all people, at all times, have physical, social, and economic access to sufficient, safe, and nutritious food', 'Water scarcity: the lack of sufficient available freshwater resources to meet the demands of water users'],
    facts: ['~828 million people are chronically hungry (FAO 2022); about one-third of all food produced globally is wasted', 'Industrial agriculture produces high yields but causes soil degradation, water overuse, and pesticide pollution', 'GM crops can increase yield and pest resistance; controversial due to ecological risks and corporate control', 'Only 3% of Earth\'s water is fresh; agriculture uses ~70% of all freshwater withdrawals', 'Drip irrigation delivers water directly to plant roots â€” reduces agricultural water use by up to 70%', 'Virtual water: water embedded in exported food/products; water-stressed nations effectively "export" their scarce water']
  },
  'gp-topics-15': {
    defs: ['Armed conflict: organised use of violence between states or non-state groups for political, territorial, or resource objectives', 'Peacebuilding: the long-term process of addressing root causes of conflict and creating conditions for lasting peace'],
    facts: ['UN Security Council: 5 permanent members (USA, UK, France, Russia, China) each with veto power over resolutions', 'Proxy war: a conflict where external powers support opposing sides without direct military involvement (e.g. Syria, Yemen)', 'Civilian casualties: modern conflicts increasingly harm civilian populations; protected by Geneva Conventions', 'Terrorism: use of violence to achieve political/ideological aims; responses include policing and addressing root causes', 'Nuclear deterrence (MAD): theory that mutual assured destruction prevents major powers from going to war', 'Post-conflict reconstruction requires transitional justice, economic rebuilding, and social reconciliation']
  },
  'gp-topics-16': {
    defs: ['Pandemic: an epidemic of infectious disease that spreads across multiple countries or continents', 'Universal Health Coverage (UHC): ensuring all people receive health services they need without financial hardship'],
    facts: ['COVID-19 pandemic (from 2020): demonstrated global interconnectedness; accelerated vaccine and mRNA technology development', 'Non-communicable diseases (NCDs): heart disease, cancer, diabetes â€” now the leading causes of death worldwide', 'Communicable diseases (HIV/AIDS, malaria, TB): still cause millions of deaths annually, mainly in low-income countries', 'WHO (World Health Organization): coordinates global health responses and sets international health standards', 'Vaccine hesitancy: refusal or reluctance to vaccinate despite availability â€” a major barrier to disease eradication', 'Social determinants of health: poverty, education level, clean water access, and sanitation affect health outcomes more than healthcare access alone']
  },
  'gp-topics-17': {
    defs: ['Human rights: the basic rights and freedoms to which every person is entitled regardless of nationality, sex, ethnicity, or religion', 'Universal Declaration of Human Rights (UDHR): landmark UN document (1948) listing 30 fundamental human rights for all people'],
    facts: ['Civil and political rights: right to life, fair trial, free speech, freedom from torture, right to vote', 'Economic, social, and cultural rights: right to work, education, healthcare, and an adequate standard of living', 'Amnesty International and Human Rights Watch: NGOs that monitor and campaign against human rights abuses', 'Sovereignty vs intervention: debate over when outside actors are justified in intervening in a state\'s internal affairs', 'LGBTQ+ rights: legal in most Western nations but criminalised in approximately 70 countries as of 2024', 'Intersectionality: multiple forms of discrimination (e.g. race + gender + class) compound each other']
  },
  'gp-topics-18': {
    defs: ['Lingua franca: a language used as a common means of communication between groups with different native languages', 'Language endangerment: a language is at risk of dying out because fewer people, especially children, are learning it'],
    facts: ['Approximately 7,000 languages exist today; roughly half are endangered and may disappear within a century', 'English as a global lingua franca facilitates international trade and science but creates a power imbalance', 'Language loss means cultural loss: each language encodes unique knowledge, metaphors, and ways of understanding the world', 'Sign languages: hundreds of distinct national sign languages exist globally; separate from spoken languages', 'Multilingualism is linked to cognitive flexibility, cultural empathy, and economic advantages', 'AI translation technology is improving rapidly but still struggles with nuance, idiom, and cultural context']
  }
};

// ========== RENDER TOPICS ==========
const subjectTopics = {
  ict:      ['ict-theory-topics', 'ict-practical-topics'],
  cs:       ['cs-topics1', 'cs-topics2'],
  business: ['bus-topics'],
  science:  ['sci-bio-topics', 'sci-chem-topics', 'sci-phys-topics'],
  addmath:  ['am-topics'],
  gp:       ['gp-topics']
};

function getTopicState() {
  // migrate old igcse-checked format
  const old = localStorage.getItem('igcse-checked');
  if (old && !localStorage.getItem('igcse-topics')) {
    const oldData = JSON.parse(old);
    const migrated = {};
    Object.keys(oldData).forEach(k => { if (oldData[k]) migrated[k] = 2; });
    localStorage.setItem('igcse-topics', JSON.stringify(migrated));
    localStorage.removeItem('igcse-checked');
  }
  return JSON.parse(localStorage.getItem('igcse-topics') || '{}');
}

function renderTopics() {
  const saved = getTopicState();
  const userNotes = getUserNotes();
  Object.keys(topicData).forEach(listId => {
    const el = document.getElementById(listId);
    if (!el) return;
    el.innerHTML = topicData[listId].map(([num, name]) => {
      const key = listId + '-' + num + '-' + name.substring(0,10);
      const safeKey = key.replace(/[^a-z0-9]/gi, '-');
      const state = saved[key] || 0;
      const cls = state === 1 ? 'shaky' : state === 2 ? 'confident' : '';
      const noteKey = listId.replace('-topics','').replace('ict-theory','ict-theory').replace('ict-practical','ict-practical') + '-topics-' + num;
      const notes = topicNotes[noteKey] || topicNotes[listId + '-' + num] || null;
      const notesHtml = notes ? `<div class="topic-notes" id="tn-${safeKey}">
        ${notes.defs ? `<div class="tn-label">Key Definitions</div><ul>${notes.defs.map(d=>`<li>${d}</li>`).join('')}</ul>` : ''}
        ${notes.formulae ? `<div class="tn-label">Formulae</div><ul>${notes.formulae.map(f=>`<li><span class="formula">${f}</span></li>`).join('')}</ul>` : ''}
        ${notes.facts ? `<div class="tn-label">Key Facts</div><ul>${notes.facts.map(f=>`<li>${f}</li>`).join('')}</ul>` : ''}
      </div>` : '';
      const hasNote = !!userNotes[key];
      const escapedKey = key.replace(/'/g, "\\'");
      const userNoteHtml = `<textarea class="topic-note-area${hasNote ? ' open' : ''}" id="una-${safeKey}" onclick="event.stopPropagation()" oninput="saveTopicNote('${escapedKey}',this)" placeholder="Your personal notes...">${userNotes[key] ? userNotes[key].replace(/</g,'&lt;') : ''}</textarea>`;
      return `<div class="topic-item" onclick="expandTopic(this)">
        <span class="topic-num">${num}</span>
        <span class="topic-name">${name}</span>
        <button class="topic-note-btn${hasNote ? ' has-note' : ''}" data-key="${key}" onclick="toggleTopicNote(this,event)" title="Personal notes">ðŸ“</button>
        <div class="topic-check ${cls}" data-key="${key}" onclick="toggleCheck(this, event)"></div>
        ${notesHtml}
        ${userNoteHtml}
      </div>`;
    }).join('');
  });
}

function expandTopic(item) {
  const notes = item.querySelector('.topic-notes');
  if (notes) notes.classList.toggle('open');
}

function toggleCheck(el, e) {
  e.stopPropagation();
  const saved = getTopicState();
  const cur = saved[el.dataset.key] || 0;
  const next = cur >= 2 ? 0 : cur + 1;
  el.className = 'topic-check' + (next === 1 ? ' shaky' : next === 2 ? ' confident' : '');
  if (next > 0) {
    saved[el.dataset.key] = next;
  } else {
    delete saved[el.dataset.key];
  }
  localStorage.setItem('igcse-topics', JSON.stringify(saved));
  renderConfidenceBars();
  recordActivity(0);
}

function renderConfidenceBars() {
  const saved = getTopicState();
  Object.keys(subjectTopics).forEach(subjId => {
    const bar = document.getElementById('cb-' + subjId);
    if (!bar) return;
    let total = 0, shaky = 0, confident = 0;
    subjectTopics[subjId].forEach(listId => {
      (topicData[listId] || []).forEach(([num, name]) => {
        const key = listId + '-' + num + '-' + name.substring(0,10);
        total++;
        const s = saved[key] || 0;
        if (s === 1) shaky++;
        else if (s === 2) confident++;
      });
    });
    const none = total - shaky - confident;
    bar.innerHTML = `
      <div class="cb-none" style="flex:${none}"></div>
      <div class="cb-shaky" style="flex:${shaky}"></div>
      <div class="cb-confident" style="flex:${confident}"></div>`;
  });
}

renderTopics();
renderConfidenceBars();

// ========== EXAM TRACKER ==========
renderTracker();

// ========== PAST PAPERS HUB ==========
const pastPapers = [
  { id: 'ict',      name: 'ICT', code: '0417',
    links: [
      { label: 'Cambridge Official â€” Past Papers', desc: 'Requires free CIE account', url: 'https://www.cambridgeinternational.org/programmes-and-qualifications/cambridge-igcse-information-and-communication-technology-0417/past-papers/', icon: 'ðŸ›' },
      { label: 'PapaCambridge â€” ICT 0417', desc: 'Free PDFs, all sessions', url: 'https://papacambridge.com/cambridge-igcse/information-communication-technology-0417/', icon: 'ðŸ“„' },
      { label: 'GCE Guide â€” ICT 0417', desc: 'Papers + mark schemes', url: 'https://gceguide.com/igcse/ict/0417/', icon: 'ðŸ“„' }
    ]
  },
  { id: 'cs',       name: 'Computer Science', code: '0478',
    links: [
      { label: 'Cambridge Official â€” Past Papers', desc: 'Requires free CIE account', url: 'https://www.cambridgeinternational.org/programmes-and-qualifications/cambridge-igcse-computer-science-0478/past-papers/', icon: 'ðŸ›' },
      { label: 'PapaCambridge â€” CS 0478', desc: 'Free PDFs, all sessions', url: 'https://papacambridge.com/cambridge-igcse/computer-science-0478/', icon: 'ðŸ“„' },
      { label: 'GCE Guide â€” CS 0478', desc: 'Papers + mark schemes', url: 'https://gceguide.com/igcse/computer-science/0478/', icon: 'ðŸ“„' }
    ]
  },
  { id: 'business', name: 'Business Studies', code: '0450',
    links: [
      { label: 'Cambridge Official â€” Past Papers', desc: 'Requires free CIE account', url: 'https://www.cambridgeinternational.org/programmes-and-qualifications/cambridge-igcse-business-studies-0450/past-papers/', icon: 'ðŸ›' },
      { label: 'PapaCambridge â€” Business 0450', desc: 'Free PDFs, all sessions', url: 'https://papacambridge.com/cambridge-igcse/business-studies-0450/', icon: 'ðŸ“„' },
      { label: 'GCE Guide â€” Business 0450', desc: 'Papers + mark schemes', url: 'https://gceguide.com/igcse/business-studies/0450/', icon: 'ðŸ“„' }
    ]
  },
  { id: 'engfirst', name: 'English First Language', code: '0500',
    links: [
      { label: 'Cambridge Official â€” Past Papers', desc: 'Requires free CIE account', url: 'https://www.cambridgeinternational.org/programmes-and-qualifications/cambridge-igcse-english-first-language-0500/past-papers/', icon: 'ðŸ›' },
      { label: 'PapaCambridge â€” English 0500', desc: 'Free PDFs, all sessions', url: 'https://papacambridge.com/cambridge-igcse/english-first-language-0500/', icon: 'ðŸ“„' },
      { label: 'GCE Guide â€” English 0500', desc: 'Papers + mark schemes', url: 'https://gceguide.com/igcse/english/0500/', icon: 'ðŸ“„' }
    ]
  },
  { id: 'englit',   name: 'English Literature', code: '0475',
    links: [
      { label: 'Cambridge Official â€” Past Papers', desc: 'Requires free CIE account', url: 'https://www.cambridgeinternational.org/programmes-and-qualifications/cambridge-igcse-english-literature-0475/past-papers/', icon: 'ðŸ›' },
      { label: 'PapaCambridge â€” Literature 0475', desc: 'Free PDFs, all sessions', url: 'https://papacambridge.com/cambridge-igcse/literature-english-0475/', icon: 'ðŸ“„' },
      { label: 'GCE Guide â€” Literature 0475', desc: 'Papers + mark schemes', url: 'https://gceguide.com/igcse/english-literature/0475/', icon: 'ðŸ“„' }
    ]
  },
  { id: 'science',  name: 'Co-ordinated Sciences', code: '0654',
    links: [
      { label: 'Cambridge Official â€” Past Papers', desc: 'Requires free CIE account', url: 'https://www.cambridgeinternational.org/programmes-and-qualifications/cambridge-igcse-co-ordinated-sciences-double-award-0654/past-papers/', icon: 'ðŸ›' },
      { label: 'PapaCambridge â€” Science 0654', desc: 'Free PDFs, all sessions', url: 'https://papacambridge.com/cambridge-igcse/co-ordinated-sciences-double-award-0654/', icon: 'ðŸ“„' },
      { label: 'GCE Guide â€” Science 0654', desc: 'Papers + mark schemes', url: 'https://gceguide.com/igcse/sciences/co-ordinated-sciences/0654/', icon: 'ðŸ“„' }
    ]
  },
  { id: 'addmath',  name: 'Additional Mathematics', code: '0606',
    links: [
      { label: 'Cambridge Official â€” Past Papers', desc: 'Requires free CIE account', url: 'https://www.cambridgeinternational.org/programmes-and-qualifications/cambridge-igcse-additional-mathematics-0606/past-papers/', icon: 'ðŸ›' },
      { label: 'PapaCambridge â€” Add Maths 0606', desc: 'Free PDFs, all sessions', url: 'https://papacambridge.com/cambridge-igcse/additional-mathematics-0606/', icon: 'ðŸ“„' },
      { label: 'GCE Guide â€” Add Maths 0606', desc: 'Papers + mark schemes', url: 'https://gceguide.com/igcse/additional-mathematics/0606/', icon: 'ðŸ“„' }
    ]
  },
  { id: 'gp',       name: 'Global Perspectives', code: '0457',
    links: [
      { label: 'Cambridge Official â€” Past Papers', desc: 'Requires free CIE account', url: 'https://www.cambridgeinternational.org/programmes-and-qualifications/cambridge-igcse-global-perspectives-0457/past-papers/', icon: 'ðŸ›' },
      { label: 'PapaCambridge â€” Global Persp. 0457', desc: 'Free PDFs, all sessions', url: 'https://papacambridge.com/cambridge-igcse/global-perspectives-0457/', icon: 'ðŸ“„' },
      { label: 'GCE Guide â€” Global Perspectives 0457', desc: 'Papers + mark schemes', url: 'https://gceguide.com/igcse/global-perspectives/0457/', icon: 'ðŸ“„' }
    ]
  }
];

document.getElementById('ppGrid').innerHTML = pastPapers.map(s => `
  <div class="pp-subject">
    <h4>${s.name}</h4>
    <div class="pp-code">${s.code}</div>
    <div class="pp-links">
      ${s.links.map(l => `
        <a class="pp-link" href="${l.url}" target="_blank" rel="noopener">
          <span class="pp-icon">${l.icon}</span>
          <span>
            <div>${l.label}</div>
            <div class="pp-desc">${l.desc}</div>
          </span>
        </a>`).join('')}
    </div>
  </div>`).join('');

// ========== SCORE TRACKER ==========
const gradeBoundaries = {
  ict:      { astar: 82, a: 68, b: 54, c: 42 },
  cs:       { astar: 83, a: 69, b: 55, c: 43 },
  business: { astar: 82, a: 68, b: 54, c: 42 },
  engfirst: { astar: 85, a: 72, b: 59, c: 47 },
  englit:   { astar: 87, a: 74, b: 61, c: 48 },
  science:  { astar: 83, a: 70, b: 57, c: 44 },
  addmath:  { astar: 81, a: 66, b: 51, c: 37 },
  gp:       { astar: 80, a: 65, b: 52, c: 40 }
};

const subjNames = {
  ict:'ICT', cs:'Computer Science', business:'Business Studies',
  engfirst:'English 1st Lang', englit:'English Lit',
  science:'Co-ord Sciences', addmath:'Add Maths', gp:'Global Perspectives'
};

function getGrade(pct, bounds) {
  if (pct >= bounds.astar) return { g: 'A*', cls: 'grade-astar' };
  if (pct >= bounds.a)     return { g: 'A',  cls: 'grade-a' };
  if (pct >= bounds.b)     return { g: 'B',  cls: '' };
  if (pct >= bounds.c)     return { g: 'C',  cls: '' };
  return { g: 'U', cls: '' };
}

const paperOptions = {
  ict:      [
    { label: 'Paper 1 â€” Theory',                                    max: 80  },
    { label: 'Paper 2 â€” Document Production, Databases & Pres.',    max: 70  },
    { label: 'Paper 3 â€” Spreadsheets & Data Manipulation',          max: 70  }
  ],
  cs:       [
    { label: 'Paper 1 â€” Computer Systems',                          max: 75  },
    { label: 'Paper 2 â€” Algorithms, Programming & Logic',           max: 75  }
  ],
  business: [
    { label: 'Paper 1 â€” Short Answer & Data Response',              max: 80  },
    { label: 'Paper 2 â€” Case Study',                                max: 80  }
  ],
  engfirst: [
    { label: 'Paper 1 â€” Reading',                                   max: 80  },
    { label: 'Paper 2 â€” Directed Writing & Composition',            max: 80  }
  ],
  englit:   [
    { label: 'Paper 1 â€” Poetry & Prose',                            max: 50  },
    { label: 'Paper 2 â€” Drama',                                     max: 50  }
  ],
  science:  [
    { label: 'Paper 2 â€” Multiple Choice (Extended)',                max: 40  },
    { label: 'Paper 4 â€” Theory (Extended)',                         max: 120 },
    { label: 'Paper 5/6 â€” Practical / Alt to Practical',           max: 60  }
  ],
  addmath:  [
    { label: 'Paper 1 â€” Non-Calculator',                            max: 80  },
    { label: 'Paper 2 â€” Calculator',                                max: 80  }
  ],
  gp:       [
    { label: 'Component 1 â€” Written Exam',                          max: 70  },
    { label: 'Component 2 â€” Individual Report',                     max: 60  },
    { label: 'Component 3 â€” Team Project',                          max: 70  }
  ]
};

function onSubjectChange() {
  const subj = document.getElementById('sf-subject').value;
  const paperSel = document.getElementById('sf-paper');
  paperSel.innerHTML = (paperOptions[subj] || [])
    .map(p => `<option value="${p.label}" data-max="${p.max}">${p.label}</option>`)
    .join('');
  onPaperChange();
}

function onPaperChange() {
  const paperSel = document.getElementById('sf-paper');
  const opt = paperSel.options[paperSel.selectedIndex];
  if (opt) document.getElementById('sf-max').value = opt.dataset.max;
}

function loadScores() { return JSON.parse(localStorage.getItem('igcse-scores') || '[]'); }
function saveScores(s) { localStorage.setItem('igcse-scores', JSON.stringify(s)); }

function logScore() {
  const subj = document.getElementById('sf-subject').value;
  const paper = document.getElementById('sf-paper').value;
  const session = document.getElementById('sf-session').value.trim();
  const score = parseInt(document.getElementById('sf-score').value);
  const max = parseInt(document.getElementById('sf-max').value);
  if (!paper || !session || isNaN(score) || isNaN(max) || max <= 0 || score < 0) {
    alert('Please fill in all fields with valid values.'); return;
  }
  const scores = loadScores();
  scores.push({ subj, paper, session, score, max, date: new Date().toISOString().slice(0,10) });
  saveScores(scores);
  document.getElementById('sf-session').value = '';
  document.getElementById('sf-score').value = '';
  onSubjectChange(); // reset paper dropdown + max
  renderScores();
}

function deleteScore(idx) {
  const scores = loadScores();
  scores.splice(idx, 1);
  saveScores(scores);
  renderScores();
}

function renderScores() {
  const scores = loadScores();
  const bySubj = {};
  scores.forEach((s, i) => {
    if (!bySubj[s.subj]) bySubj[s.subj] = [];
    bySubj[s.subj].push({ ...s, idx: i });
  });

  const el = document.getElementById('scoreResults');
  if (!Object.keys(bySubj).length) {
    el.innerHTML = '<p style="color:var(--text3);margin-top:8px">No scores logged yet. Complete a past paper and log your result above.</p>';
    renderAstarPanel();
    renderTimetable();
    return;
  }

  el.innerHTML = Object.keys(bySubj).map(subjId => {
    const entries = bySubj[subjId];
    const bounds = gradeBoundaries[subjId] || { astar:85, a:70, b:55, c:42 };
    const rows = entries.map(e => {
      const pct = Math.round(e.score / e.max * 100);
      const grade = getGrade(pct, bounds);
      const pctCls = pct >= bounds.a ? 'good' : pct >= bounds.c ? 'ok' : 'low';
      return `<tr>
        <td>${e.session}</td>
        <td>${e.paper}</td>
        <td>${e.score}/${e.max}</td>
        <td class="pct ${pctCls}">${pct}%</td>
        <td><span class="grade-chip grade-${grade.g.replace('*','star').toLowerCase()}" style="background:${pct>=bounds.astar?'var(--green)':pct>=bounds.a?'var(--blue)':pct>=bounds.b?'var(--accent)':pct>=bounds.c?'var(--orange)':'var(--red)'};color:var(--bg)">${grade.g}</span></td>
        <td><button class="del-btn" onclick="deleteScore(${e.idx})">âœ•</button></td>
      </tr>`;
    }).join('');
    const avg = Math.round(entries.reduce((s,e)=>s+e.score/e.max*100,0)/entries.length);
    const avgGrade = getGrade(avg, bounds);
    return `<div class="score-subject-block">
      <h4>${subjNames[subjId] || subjId} â€” avg ${avg}% (predicted ${avgGrade.g})</h4>
      <table class="score-table">
        <tr><th>Session</th><th>Paper</th><th>Score</th><th>%</th><th>Grade</th><th></th></tr>
        ${rows}
      </table>
    </div>`;
  }).join('');
  renderAstarPanel();
  renderTimetable();
}

function renderAstarPanel() {
  const el = document.getElementById('astarPanel');
  if (!el) return;
  const cards = Object.entries(TT_SUBJECTS).map(([id, s]) => {
    const avg = getSubjAvgPct(id);
    const bounds = gradeBoundaries[id] || { astar:85, a:70 };
    if (avg === null) {
      return `<div class="astar-card no-data">
        <div class="astar-subj">${s.name}</div>
        <div class="astar-pct" style="color:var(--text3)">â€”</div>
        <div class="astar-gap">No scores logged</div>
        <div class="astar-bar"><div class="astar-bar-fill" style="width:0;background:var(--border)"></div></div>
      </div>`;
    }
    const pct = Math.round(avg);
    const gap = Math.round(bounds.astar - avg);
    const cls = avg >= bounds.astar ? 'on-track' : avg >= bounds.a ? 'close' : 'at-risk';
    const barColor = avg >= bounds.astar ? 'var(--green)' : avg >= bounds.a ? 'var(--accent)' : 'var(--red)';
    const barW = Math.min(100, Math.round(avg / bounds.astar * 100));
    const gapText = avg >= bounds.astar
      ? `âœ“ On track for A* (threshold ${bounds.astar}%)`
      : `${gap > 0 ? gap+'% below' : 'At'} A* threshold (${bounds.astar}%)`;
    return `<div class="astar-card ${cls}">
      <div class="astar-subj">${s.name}</div>
      <div class="astar-pct ${cls}">${pct}%</div>
      <div class="astar-gap">${gapText}</div>
      <div class="astar-bar"><div class="astar-bar-fill" style="width:${barW}%;background:${barColor}"></div></div>
    </div>`;
  }).join('');
  const hasAny = Object.keys(TT_SUBJECTS).some(id => getSubjAvgPct(id) !== null);
  el.innerHTML = `<h4 style="font-family:'Syne',sans-serif;font-size:18px;margin-bottom:10px">A* Tracker</h4>
    <p style="color:var(--text3);font-size:12px;margin-bottom:16px">${hasAny
      ? 'Based on your logged past paper scores. Green = on track, amber = close, red = needs work.'
      : 'Log past paper scores below to track your A* trajectory per subject.'}</p>
    <div class="astar-grid">${cards}</div>`;
}

// ========== GRADE IMPORT ==========
function toggleImportPanel() {
  document.getElementById('importPanel').classList.toggle('open');
}

function onImportFile(e) {
  const file = e.target.files[0];
  if (!file) return;
  const url = URL.createObjectURL(file);
  const preview = document.getElementById('importPreview');
  if (file.type.startsWith('image/')) {
    preview.innerHTML = `<img src="${url}" alt="grades preview">`;
  } else if (file.type === 'application/pdf') {
    preview.innerHTML = `<embed src="${url}" type="application/pdf">`;
  } else {
    preview.innerHTML = `<div class="placeholder">Preview not available.<br>Use the form on the right to enter your scores.</div>`;
  }
}

function buildImportTable() {
  const rows = Object.entries(subjNames).map(([id, name]) => {
    const papers = (paperOptions[id] || []).map(p => `<option value="${p.label}" data-max="${p.max}">${p.label}</option>`).join('');
    const firstMax = (paperOptions[id] || [])[0]?.max || '';
    return `<tr>
      <td style="font-size:11px;color:var(--text2);white-space:nowrap">${name.length > 14 ? name.slice(0,12)+'â€¦' : name}</td>
      <td><select class="imp-paper" data-subj="${id}" onchange="onImpPaperChange(this)">${papers}</select></td>
      <td><input class="imp-score" type="number" min="0" placeholder="â€”" data-subj="${id}" style="width:50px"></td>
      <td><input class="imp-max" type="number" min="1" value="${firstMax}" data-subj="${id}" style="width:50px"></td>
      <td><input class="imp-session" type="text" placeholder="Jun 24" data-subj="${id}" style="width:64px"></td>
    </tr>`;
  }).join('');
  const tbl = document.getElementById('importTable');
  if (tbl) tbl.innerHTML = `<tr><th>Subject</th><th>Paper</th><th>Score</th><th>Max</th><th>Session</th></tr>${rows}`;
}

function onImpPaperChange(sel) {
  const opt = sel.options[sel.selectedIndex];
  const maxIn = sel.closest('tr')?.querySelector('.imp-max');
  if (maxIn && opt) maxIn.value = opt.dataset.max || '';
}

function importAllScores() {
  const rows = document.querySelectorAll('#importTable tr:not(:first-child)');
  const scores = loadScores();
  let count = 0;
  rows.forEach(row => {
    const subj  = row.querySelector('.imp-score').dataset.subj;
    const paper = row.querySelector('.imp-paper').value;
    const sv    = row.querySelector('.imp-score').value;
    const mv    = row.querySelector('.imp-max').value;
    const sess  = row.querySelector('.imp-session').value.trim();
    const score = parseFloat(sv), max = parseFloat(mv);
    if (!sv || !sess || isNaN(score) || isNaN(max) || max <= 0 || score < 0) return;
    scores.push({ subj, paper, session: sess, score, max, date: new Date().toISOString().slice(0,10) });
    count++;
  });
  if (!count) { alert('No complete rows found. Fill in Score, Max, and Session for each row you want to import.'); return; }
  saveScores(scores);
  renderScores();
  renderTimetable();
  alert(`${count} score${count > 1 ? 's' : ''} imported!`);
  document.getElementById('importPanel').classList.remove('open');
}

function clearImportForm() {
  document.querySelectorAll('.imp-score,.imp-session').forEach(el => el.value = '');
}

// ========== TIMETABLE ==========
const TT_SUBJECTS = {
  ict:      { name:'ICT',        short:'ICT',  color:'#60a0f0', bg:'rgba(96,160,240,0.18)',  topics:21, exam:'2026-04-01' },
  science:  { name:'Science',    short:'Sci',  color:'#f06060', bg:'rgba(240,96,96,0.18)',   topics:35, exam:'2026-05-07' },
  addmath:  { name:'Add Maths',  short:'AM',   color:'#40d0d0', bg:'rgba(64,208,208,0.18)',  topics:17, exam:'2026-05-18' },
  cs:       { name:'Comp Sci',   short:'CS',   color:'#a070f0', bg:'rgba(160,112,240,0.18)', topics:10, exam:'2026-05-13' },
  business: { name:'Business',   short:'Biz',  color:'#40d080', bg:'rgba(64,208,128,0.18)',  topics:8,  exam:'2026-05-11' },
  engfirst: { name:'Eng 1st',    short:'EFL',  color:'#f0c040', bg:'rgba(240,192,64,0.18)',  topics:6,  exam:'2026-05-06' },
  englit:   { name:'Eng Lit',    short:'Lit',  color:'#f060a0', bg:'rgba(240,96,160,0.18)',  topics:6,  exam:'2026-05-08' },
  gp:       { name:'Global Per', short:'GP',   color:'#40c0a0', bg:'rgba(64,192,160,0.18)',  topics:10, exam:'2026-05-06' }
};

const EXAM_EVENTS = [
  { date:'2026-04-01', label:'ICT P2 Practical' },
  { date:'2026-04-02', label:'ICT P3 Practical' },
  { date:'2026-04-16', label:'ICT P2 (var 2)'   },
  { date:'2026-04-21', label:'ICT P3 (var 2)'   },
  { date:'2026-05-06', label:'EFL P1 Â· GP C1'   },
  { date:'2026-05-07', label:'ICT P1 Â· Sci P4'  },
  { date:'2026-05-08', label:'Eng Lit P1'        },
  { date:'2026-05-11', label:'Biz P1 Â· Lit P2'  },
  { date:'2026-05-12', label:'Science P5/6'      },
  { date:'2026-05-13', label:'CS P1'             },
  { date:'2026-05-15', label:'EFL P2'            },
  { date:'2026-05-18', label:'Biz P2 Â· AM P1'   },
  { date:'2026-05-20', label:'CS P2'             },
  { date:'2026-05-26', label:'Add Maths P2'      },
  { date:'2026-06-03', label:'Science P2 MCQ'    }
];

const SLOT_NAMES  = ['9:00 AM', '10:15 AM', '11:30 AM', '1:30 PM', '3:30 PM', '7:00 PM'];
const SLOT_RANGES = ['9:00â€“10:00 AM', '10:15â€“11:15 AM', '11:30 AMâ€“12:30 PM', '1:30â€“2:30 PM', '3:30â€“4:30 PM', '7:00â€“8:00 PM'];

const TT_TOPIC_AREAS = {
  ict:      ['Databases','Spreadsheets','Document Production','Networks & Security','Hardware & Software','Data Representation','Presentation','Web Authoring'],
  cs:       ['Algorithms','Pseudocode & Tracing','Data Structures','Binary & Hex','Networks','Security','Boolean Logic','OOP Concepts'],
  business: ['Business Ownership','Marketing Mix','Market Research','Financial Statements','HR & Motivation','Operations Management'],
  engfirst: ['Reading Comprehension','Summary Writing','Descriptive Composition','Argumentative Writing','Directed Writing','Language Analysis'],
  englit:   ['Poetry Analysis','Prose Techniques','Drama Close Reading','Themes & Context','Character Study','Unseen Texts'],
  science:  ['Cell Biology','Nutrition & Respiration','Genetics & Variation','Atomic Structure','Chemical Reactions','Forces & Motion','Waves & Optics','Electricity'],
  addmath:  ['Algebra & Surds','Quadratics','Trigonometry','Differentiation','Integration','Vectors','Logarithms','Coordinate Geometry'],
  gp:       ['Perspectives Framework','Source Analysis','Argument Construction','Counter-Claims','Research Methods','Team Project Skills']
};

function ttDateStr(d) {
  return d.toISOString().slice(0,10);
}
function ttExamOnDay(dateStr) {
  return EXAM_EVENTS.find(e => e.date === dateStr);
}
function getSubjAvgPct(subjId) {
  const entries = loadScores().filter(e => e.subj === subjId);
  return entries.length ? entries.reduce((t, e) => t + e.score / e.max * 100, 0) / entries.length : null;
}
function ttPriority(subjId, fromDate) {
  const s = TT_SUBJECTS[subjId];
  const exam = new Date(s.exam + 'T00:00:00');
  const days = Math.max(1, Math.ceil((exam - fromDate) / 86400000));
  if (days <= 0) return 0;
  let w = s.topics / Math.pow(days, 0.55);
  if (subjId === 'ict' && days < 47) w *= 3.5;
  // Grade adaptation: avg 40% â†’ Ã—1.6 boost, avg 70% â†’ Ã—1.0, avg 82%+ â†’ Ã—0.8 reduction
  const avg = getSubjAvgPct(subjId);
  if (avg !== null) w *= Math.min(1.6, Math.max(0.8, 1.6 - (avg - 40) * 0.02));
  return w;
}
// deterministic shuffle using date seed
function ttShuffle(arr, seed) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = (seed * 1664525 + 1013904223 + i * 22695477) % (i + 1);
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}
function ttDaySchedule(date) {
  const ds = ttDateStr(date);
  if (ttExamOnDay(ds)) return 'exam';
  const dow = date.getDay(); // 0=Sun
  if (dow === 0) return 'rest';
  const slots = dow === 6 ? 4 : 6;
  const seed = date.getDate() * 31 + date.getMonth() * 373;
  const subjIds = Object.keys(TT_SUBJECTS);
  const scored = subjIds
    .map(id => ({ id, p: ttPriority(id, date) }))
    .filter(x => x.p > 0)
    .sort((a, b) => b.p - a.p);
  const top = scored.slice(0, slots).map(x => x.id);
  const pool = ttShuffle(top, seed);
  const picked = [];
  for (let i = 0; i < slots; i++) picked.push(pool[i % pool.length]);
  return picked.map(id => ({ subj: id }));
}

let ttWeekOffset = 0;
function ttWeekStart(offset) {
  const today = new Date(); today.setHours(0,0,0,0);
  const dow = today.getDay();
  const monday = new Date(today); monday.setDate(today.getDate() - (dow === 0 ? 6 : dow - 1));
  monday.setDate(monday.getDate() + offset * 7);
  return monday;
}
function ttPrev() { ttWeekOffset--; renderTimetable(); }
function ttNext() { ttWeekOffset++; renderTimetable(); }

function renderTimetable() {
  const ws = ttWeekStart(ttWeekOffset);
  const we = new Date(ws); we.setDate(ws.getDate() + 6);
  const today = new Date(); today.setHours(0,0,0,0);

  // label
  const fmt = d => d.toLocaleDateString('en-GB',{day:'numeric',month:'short'});
  document.getElementById('ttLabel').textContent = `${fmt(ws)} â€“ ${fmt(we)}`;

  // grade-adaptive note
  const hasGrades = Object.keys(TT_SUBJECTS).some(id => getSubjAvgPct(id) !== null);
  const noteEl = document.getElementById('ttGradeNote');
  if (noteEl) noteEl.textContent = hasGrades
    ? 'âœ“ Adapted to your scores â€” subjects below target are prioritised more'
    : 'Log past paper scores in Progress â†’ timetable will adapt to your performance';

  // legend
  document.getElementById('ttLegend').innerHTML = Object.entries(TT_SUBJECTS)
    .map(([,s]) => `<div class="tt-legend-item"><div class="tt-legend-dot" style="background:${s.color}"></div>${s.name}</div>`)
    .join('');

  // build grid: row 0 = headers, rows 1-3 = slots
  const DAYS = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
  let html = '';

  // header row
  html += '<div></div>'; // corner
  for (let d = 0; d < 7; d++) {
    const date = new Date(ws); date.setDate(ws.getDate() + d);
    const isToday = ttDateStr(date) === ttDateStr(today);
    const isPast  = date < today;
    const cls = isToday ? 'today' : isPast ? 'past' : '';
    html += `<div class="tt-header ${cls}">
      <div class="tt-date">${date.getDate()}</div>
      <div class="tt-dow">${DAYS[d]}</div>
    </div>`;
  }

  // slot rows
  for (let slot = 0; slot < SLOT_NAMES.length; slot++) {
    html += `<div class="tt-slot-label">${SLOT_NAMES[slot]}</div>`;
    for (let d = 0; d < 7; d++) {
      const date = new Date(ws); date.setDate(ws.getDate() + d);
      const ds = ttDateStr(date);
      const isPast = date < today;
      const sched = ttDaySchedule(date);

      if (sched === 'exam') {
        if (slot === 2) {
          const ev = ttExamOnDay(ds);
          html += `<div class="tt-cell tt-exam-day${isPast?' past':''}"><span>${ev.label}</span></div>`;
        } else {
          html += `<div class="tt-cell empty"></div>`;
        }
      } else if (sched === 'rest') {
        if (slot === 2) {
          html += `<div class="tt-cell rest">Rest Day â˜•</div>`;
        } else {
          html += `<div class="tt-cell empty"></div>`;
        }
      } else if (!sched[slot]) {
        html += `<div class="tt-cell empty"></div>`;
      } else {
        const { subj } = sched[slot];
        const s = TT_SUBJECTS[subj];
        const areas = TT_TOPIC_AREAS[subj] || [];
        const fPool = [...areas, 'Past Paper Practice', 'Mark Scheme Review', 'Flashcard Drill'];
        const cSeed = date.getDate() * 31 + date.getMonth() * 373 + slot * 41 + (subj.charCodeAt(0) * 7);
        const focus = fPool[Math.abs(cSeed) % fPool.length];
        html += `<div class="tt-cell${isPast?' past':''}" style="background:${s.bg};border-color:${s.color}33;color:#fff">
          <div><div class="tt-subj" style="color:${s.color}">${s.short}</div>
          <div class="tt-focus">${focus}</div></div>
          <div class="tt-dur">${SLOT_RANGES[slot]}</div>
        </div>`;
      }
    }
  }

  document.getElementById('ttGrid').innerHTML = html;
}

// Seed school report grades on first load (RC1 Dec 2025)
if (!localStorage.getItem('igcse-scores')) {
  localStorage.setItem('igcse-scores', JSON.stringify([
    { subj:'ict',      paper:'Paper 1 â€” Theory',                          session:'School RC1 Dec 2025', score:72,  max:80,  date:'2025-12-01' },
    { subj:'cs',       paper:'Paper 1 â€” Computer Systems',                session:'School RC1 Dec 2025', score:68,  max:75,  date:'2025-12-01' },
    { subj:'addmath',  paper:'Paper 1 â€” Non-Calculator',                  session:'School RC1 Dec 2025', score:60,  max:80,  date:'2025-12-01' },
    { subj:'business', paper:'Paper 1 â€” Short Answer & Data Response',    session:'School RC1 Dec 2025', score:60,  max:80,  date:'2025-12-01' },
    { subj:'engfirst', paper:'Paper 1 â€” Reading',                         session:'School RC1 Dec 2025', score:60,  max:80,  date:'2025-12-01' },
    { subj:'englit',   paper:'Paper 1 â€” Poetry & Prose',                  session:'School RC1 Dec 2025', score:35,  max:50,  date:'2025-12-01' },
    { subj:'gp',       paper:'Component 1 â€” Written Exam',                session:'School RC1 Dec 2025', score:49,  max:70,  date:'2025-12-01' },
    { subj:'science',  paper:'Paper 4 â€” Theory (Extended)',               session:'School RC1 Dec 2025', score:84,  max:120, date:'2025-12-01' }
  ]));
}
renderScores();      // also calls renderAstarPanel() and renderTimetable()
onSubjectChange();   // populate paper dropdown on load
buildImportTable();  // pre-populate import form rows

// ========== GRADE CALCULATOR ==========
const subjColors = { ict:'var(--blue)', cs:'var(--purple)', business:'var(--green)',
  engfirst:'var(--accent)', englit:'var(--pink)', science:'var(--red)',
  addmath:'var(--cyan)', gp:'var(--teal)' };

function renderGradeCalc() {
  const el = document.getElementById('gcGrid');
  if (!el) return;
  const scores = JSON.parse(localStorage.getItem('igcse-scores') || '[]');
  el.innerHTML = Object.keys(paperOptions).map(subj => {
    const papers = paperOptions[subj];
    const bounds = gradeBoundaries[subj];
    const totalMax = papers.reduce((s, p) => s + p.max, 0);
    const paperRows = papers.map((p, i) => {
      // pre-fill with best logged score for this paper
      const logged = scores.filter(s => s.subj === subj &&
        s.paper.toLowerCase().includes(p.label.split('â€”')[0].trim().toLowerCase()));
      const best = logged.length ? Math.max(...logged.map(s => s.score)) : '';
      return `<div class="gc-paper-row">
        <span class="gc-paper-label">${p.label.split('â€”')[1]?.trim() || p.label}</span>
        <input class="gc-paper-input" type="number" min="0" max="${p.max}"
          id="gc-${subj}-${i}" value="${best}" placeholder="â€”" oninput="updateGcCard('${subj}')">
        <span class="gc-paper-max">/${p.max}</span>
      </div>`;
    }).join('');
    return `<div class="gc-card" id="gcc-${subj}">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:2px">
        <span style="width:8px;height:8px;border-radius:50%;background:${subjColors[subj]};flex-shrink:0;display:inline-block"></span>
        <h4>${subjNames[subj]}</h4>
      </div>
      <div class="gc-subcode">${(subjects[subj]||{}).code||''} Â· Total: ${totalMax} marks</div>
      ${paperRows}
      <div class="gc-results" id="gcr-${subj}"></div>
    </div>`;
  }).join('');
  Object.keys(paperOptions).forEach(s => updateGcCard(s));
}

function updateGcCard(subj) {
  const papers = paperOptions[subj];
  const bounds = gradeBoundaries[subj];
  const totalMax = papers.reduce((s, p) => s + p.max, 0);
  let enteredTotal = 0, enteredMax = 0;
  let allEntered = true;
  papers.forEach((p, i) => {
    const inp = document.getElementById(`gc-${subj}-${i}`);
    if (!inp) return;
    const v = inp.value.trim();
    if (v !== '' && v !== 'â€”') { enteredTotal += Math.min(parseFloat(v)||0, p.max); enteredMax += p.max; }
    else allEntered = false;
  });
  const remainingMax = totalMax - enteredMax;
  const el = document.getElementById(`gcr-${subj}`);
  if (!el) return;
  if (enteredMax === 0) { el.innerHTML = '<div style="font-size:12px;color:var(--text3)">Enter scores above to see what you need</div>'; return; }
  const gradeRows = [
    { g: 'A*', cls: 'astar', pct: bounds.astar },
    { g: 'A',  cls: 'a',     pct: bounds.a },
    { g: 'B',  cls: 'b',     pct: bounds.b },
    { g: 'C',  cls: 'c',     pct: bounds.c }
  ].map(({ g, cls, pct }) => {
    const needed = Math.ceil(totalMax * pct / 100) - enteredTotal;
    let label, extraCls = '';
    if (needed <= 0) { label = 'Already achieved âœ“'; extraCls = 'achieved'; }
    else if (remainingMax <= 0) { label = 'No papers remaining'; extraCls = 'impossible'; }
    else if (needed > remainingMax) { label = `Need ${needed}/${remainingMax} â€” not achievable`; extraCls = 'impossible'; }
    else { const needPct = Math.round(needed / remainingMax * 100); label = `Need <strong>${needed}/${remainingMax}</strong> on remaining (${needPct}%)`; }
    return `<div class="gc-grade-row">
      <span class="gc-grade-chip ${cls}">${g}</span>
      <span class="gc-need ${extraCls}">${label}</span>
    </div>`;
  }).join('');
  const currentPct = Math.round(enteredTotal / enteredMax * 100);
  el.innerHTML = `<div style="font-size:11px;color:var(--text3);margin-bottom:8px">
    Entered so far: ${enteredTotal}/${enteredMax} (${currentPct}%)
  </div>${gradeRows}`;
}

// ========== FORMULA SHEET ==========
const fsSubjInfo = {
  ict:      { name:'ICT', color:'var(--blue)' },
  cs:       { name:'Computer Science', color:'var(--purple)' },
  business: { name:'Business Studies', color:'var(--green)' },
  science:  { name:'Sciences', color:'var(--red)' },
  addmath:  { name:'Add Maths', color:'var(--cyan)' }
};

function renderFormulaSheet() {
  const el = document.getElementById('formulaSheet');
  if (!el) return;
  // group formulae by subject
  const grouped = {};
  Object.entries(topicNotes).forEach(([noteKey, notes]) => {
    if (!notes.formulae || !notes.formulae.length) return;
    const tdKey = noteKey.replace(/-\d+$/, '');
    let subj = null;
    for (const [s, keys] of Object.entries(subjectTopics)) { if (keys.includes(tdKey)) { subj = s; break; } }
    if (!subj) return;
    if (!grouped[subj]) grouped[subj] = [];
    grouped[subj].push({ topic: getTopicName(noteKey), formulae: notes.formulae });
  });
  el.innerHTML = Object.entries(grouped).map(([subj, groups]) => {
    const info = fsSubjInfo[subj] || { name: subj, color: 'var(--text3)' };
    const cards = groups.map(g => `<div class="fs-card">
      <div class="fs-card-title">${g.topic}</div>
      ${g.formulae.map(f => `<div class="fs-formula">${f}</div>`).join('')}
    </div>`).join('');
    return `<div class="fs-subject">
      <div class="fs-subject-title">
        <span class="fs-subject-dot" style="background:${info.color}"></span>
        ${info.name}
      </div>
      <div class="fs-cards">${cards}</div>
    </div>`;
  }).join('');
}

// ========== SHARED FLASHCARD UTILITIES ==========
function getTopicName(noteKey) {
  const tdKey = noteKey.replace(/-\d+$/, '');
  const num = noteKey.match(/-(\d+)$/)[1];
  const list = topicData[tdKey] || [];
  // match exact string OR strip letter prefix (e.g. 'B1' â†’ '1', 'P4' â†’ '4')
  const entry = list.find(([n]) => String(n) === num || String(n).replace(/^[A-Za-z]+/, '') === num);
  return entry ? entry[1] : noteKey;
}

function getFlashcards(subjFilter) {
  const cards = [];
  Object.entries(topicNotes).forEach(([noteKey, notes]) => {
    const tdKey = noteKey.replace(/-\d+$/, '');
    let subj = null;
    for (const [s, keys] of Object.entries(subjectTopics)) { if (keys.includes(tdKey)) { subj = s; break; } }
    if (!subj) return;
    if (subjFilter && subjFilter !== 'all' && subj !== subjFilter) return;
    const topicName = getTopicName(noteKey);
    (notes.defs || []).forEach((def, i) => {
      const term = def.split(':')[0].trim();
      const q = `Define: ${term}`;
      cards.push({ id: `${noteKey}-d${i}`, subj, topicName, type: 'def', question: q, answer: def, name: q });
    });
    (notes.formulae || []).forEach((f, i) => {
      const label = f.split('=')[0].trim();
      const q = `${label} = ?`;
      cards.push({ id: `${noteKey}-m${i}`, subj, topicName, type: 'formula', question: q, answer: f, name: q });
    });
    (notes.facts || []).forEach((fact, i) => {
      cards.push({ id: `${noteKey}-f${i}`, subj, topicName, type: 'fact', question: topicName, answer: fact, name: fact.length > 60 ? fact.slice(0, 57) + 'â€¦' : fact });
    });
  });
  return cards;
}

// ========== FLASHCARDS ==========
let fcDeck = [], fcIndex = 0, fcQuizMode = false;

function initFlashcards() {
  const subj = document.getElementById('fcSubject')?.value || 'all';
  fcDeck = getFlashcards(subj);
  fcIndex = 0;
  fcQuizMode = false;
  showCard();
}

function startQuiz() {
  const subj = document.getElementById('fcSubject')?.value || 'all';
  const all = getFlashcards(subj);
  // prioritise due/new cards, fill rest randomly
  const sr = getSRData();
  const now = Date.now();
  const due = all.filter(c => { const d = sr[c.id]; return !d || d.next <= now; });
  const shuffle = arr => arr.sort(() => Math.random() - 0.5);
  fcDeck = shuffle(due).concat(shuffle(all.filter(c => { const d = sr[c.id]; return d && d.next > now; }))).slice(0, 5);
  fcIndex = 0;
  fcQuizMode = true;
  showCard();
}

function shuffleFlashcards() {
  fcDeck = fcDeck.sort(() => Math.random() - 0.5);
  fcIndex = 0;
  showCard();
}

function showCard() {
  if (!fcDeck.length) {
    document.getElementById('fcFront').innerHTML = '<div class="fc-topic-name">No cards available</div>';
    document.getElementById('fcBack').innerHTML = '';
    document.getElementById('fcCounter').textContent = '0 / 0';
    document.getElementById('fcRate').style.display = 'none';
    return;
  }
  const card = fcDeck[fcIndex];
  document.getElementById('fcInner').classList.remove('flipped');
  const typeLabels = { def: 'ðŸ“– Definition', formula: 'ðŸ”¢ Formula', fact: 'ðŸ’¡ Key Fact' };
  document.getElementById('fcFront').innerHTML = `
    <div class="fc-subj-tag">${subjNames[card.subj] || card.subj}</div>
    <div class="fc-topic-label">${card.topicName}</div>
    <span class="fc-type-badge fc-type-${card.type}">${typeLabels[card.type] || card.type}</span>
    <div class="fc-question-text">${card.question}</div>
    <div class="fc-tap-hint">Tap to reveal â†’</div>`;
  const answerHtml = card.type === 'formula'
    ? `<div class="fc-type-badge fc-type-formula" style="margin-bottom:12px">Answer</div><span class="fc-answer-formula">${card.answer}</span>`
    : `<div class="fc-type-badge fc-type-${card.type}" style="margin-bottom:12px">Answer</div><div class="fc-answer-content">${card.answer}</div>`;
  document.getElementById('fcBack').innerHTML = answerHtml;
  document.getElementById('fcCounter').textContent = `${fcIndex + 1} / ${fcDeck.length}`;
  document.getElementById('fcRate').style.display = 'none';
}

function flipCard() {
  const inner = document.getElementById('fcInner');
  inner.classList.toggle('flipped');
  if (inner.classList.contains('flipped')) {
    document.getElementById('fcRate').style.display = fcQuizMode ? 'flex' : 'none';
  }
}

function nextCard() { if (fcDeck.length) { fcIndex = (fcIndex + 1) % fcDeck.length; showCard(); } }
function prevCard() { if (fcDeck.length) { fcIndex = (fcIndex - 1 + fcDeck.length) % fcDeck.length; showCard(); } }

function rateCard(passed) {
  const card = fcDeck[fcIndex];
  updateSR(card.id, passed);
  recordActivity(0);
  // advance to next
  fcIndex = (fcIndex + 1) % fcDeck.length;
  showCard();
  renderReviewQueue();
}

// ========== SPACED REPETITION ==========
const SR_KEY = 'igcse-sr';

function getSRData() { return JSON.parse(localStorage.getItem(SR_KEY) || '{}'); }
function saveSRData(d) { localStorage.setItem(SR_KEY, JSON.stringify(d)); }

function updateSR(topicId, passed) {
  const d = getSRData();
  const prev = d[topicId] || { interval: 1, next: 0 };
  const newInterval = passed ? Math.min(prev.interval * 2, 30) : 1;
  d[topicId] = { interval: newInterval, next: Date.now() + newInterval * 86400000, lastPassed: passed };
  saveSRData(d);
  syncTopicConfidence();
}

function renderReviewQueue() {
  const el = document.getElementById('rqContent');
  if (!el) return;
  const sr = getSRData();
  const now = Date.now();
  const all = getFlashcards('all');
  const due = [], upcoming = [];
  all.forEach(card => {
    const d = sr[card.id];
    if (!d) return; // never reviewed â€” not scheduled yet
    if (d.next <= now) due.push({ ...card, overdue: Math.floor((now - d.next) / 86400000) });
    else upcoming.push({ ...card, daysLeft: Math.ceil((d.next - now) / 86400000) });
  });
  const totalReviewed = Object.keys(sr).length;
  const totalCards = all.length;
  const statsHtml = `<div class="rq-stats">
    <div class="rq-stat"><strong>${due.length}</strong>Due today</div>
    <div class="rq-stat"><strong>${totalReviewed}</strong>Scheduled</div>
    <div class="rq-stat"><strong>${totalCards - totalReviewed}</strong>Not yet started</div>
  </div>`;
  if (!due.length && !upcoming.length) {
    el.innerHTML = statsHtml + `<div class="rq-empty">Nothing due yet â€” complete some flashcards in Quiz mode to build your review schedule.</div>`;
    return;
  }
  const makeItem = (c, badge) => `<div class="rq-item" onclick="jumpToFlashcard('${c.id}')">
    <span class="rq-item-dot" style="background:${subjColors[c.subj]}"></span>
    <span class="rq-item-name">${c.name}</span>
    <span class="rq-item-subj" style="font-size:11px;color:var(--text3)">${subjNames[c.subj]||c.subj}</span>
    ${badge}
  </div>`;
  let html = statsHtml;
  if (due.length) html += `<div class="rq-section"><div class="rq-section-title">Due Today (${due.length})</div>
    <div class="rq-items">${due.map(c => makeItem(c, `<span class="rq-item-overdue">${c.overdue > 0 ? c.overdue+'d overdue' : 'Today'}</span>`)).join('')}</div></div>`;
  const soon = upcoming.filter(c => c.daysLeft <= 3);
  if (soon.length) html += `<div class="rq-section"><div class="rq-section-title">Coming Up (next 3 days)</div>
    <div class="rq-items">${soon.map(c => makeItem(c, `<span class="rq-item-interval">in ${c.daysLeft}d</span>`)).join('')}</div></div>`;
  el.innerHTML = html;
}

function jumpToFlashcard(topicId) {
  const tdKey = topicId.replace(/-\d+$/, '');
  let subj = null;
  for (const [s, keys] of Object.entries(subjectTopics)) { if (keys.includes(tdKey)) { subj = s; break; } }
  navigateTo('flashcards');
  const sel = document.getElementById('fcSubject');
  if (sel && subj) { sel.value = subj; }
  fcDeck = getFlashcards(subj || 'all');
  const idx = fcDeck.findIndex(c => c.id.startsWith(topicId + '-'));
  fcIndex = Math.max(0, idx);
  fcQuizMode = true;
  showCard();
}

// ========== POMODORO TIMER ==========
const POMO_KEY = 'igcse-pomodoro';
let pomoTimer = null, pomoSeconds = 25 * 60, pomoRunning = false, pomoPhaseWork = true, pomoSession = 0;

function getPomoData() { return JSON.parse(localStorage.getItem(POMO_KEY) || '{}'); }
function savePomoData(d) { localStorage.setItem(POMO_KEY, JSON.stringify(d)); }

function togglePomo() {
  const w = document.getElementById('pomodoroWidget');
  const visible = w.style.display !== 'none';
  w.style.display = visible ? 'none' : 'block';
  document.getElementById('pomoSidebarBtn').classList.toggle('active', !visible);
  if (!visible) renderPomoStats();
}
function hidePomo() {
  document.getElementById('pomodoroWidget').style.display = 'none';
  document.getElementById('pomoSidebarBtn').classList.remove('active');
}

function pomoStartStop() {
  if (pomoRunning) {
    clearInterval(pomoTimer);
    pomoRunning = false;
    document.getElementById('pomoStartBtn').textContent = 'â–¶ Resume';
  } else {
    pomoRunning = true;
    document.getElementById('pomoStartBtn').textContent = 'â¸ Pause';
    pomoTimer = setInterval(() => {
      pomoSeconds--;
      updatePomoDisplay();
      if (pomoSeconds <= 0) {
        clearInterval(pomoTimer);
        pomoRunning = false;
        if (pomoPhaseWork) {
          // log completed session
          const subj = document.getElementById('pomoSubject').value;
          const data = getPomoData();
          data[subj] = (data[subj] || 0) + 25;
          savePomoData(data);
          recordActivity(25);
          pomoSession++;
          pomoPhaseWork = false;
          pomoSeconds = 5 * 60;
          document.getElementById('pomoPhase').textContent = 'Break';
          document.getElementById('pomoTitle').textContent = 'â˜• Take a break';
        } else {
          pomoPhaseWork = true;
          pomoSeconds = 25 * 60;
          document.getElementById('pomoPhase').textContent = 'Focus';
          document.getElementById('pomoTitle').textContent = 'Study Session';
        }
        document.getElementById('pomoStartBtn').textContent = 'â–¶ Start';
        renderPomoStats();
      }
    }, 1000);
  }
}

function pomoReset() {
  clearInterval(pomoTimer);
  pomoRunning = false;
  pomoPhaseWork = true;
  pomoSeconds = 25 * 60;
  document.getElementById('pomoStartBtn').textContent = 'â–¶ Start';
  document.getElementById('pomoPhase').textContent = 'Focus';
  document.getElementById('pomoTitle').textContent = 'Study Session';
  updatePomoDisplay();
}

function updatePomoDisplay() {
  const m = Math.floor(pomoSeconds / 60), s = pomoSeconds % 60;
  document.getElementById('pomoTime').textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function renderPomoStats() {
  const el = document.getElementById('pomoStats');
  if (!el) return;
  const data = getPomoData();
  const lines = Object.entries(data).map(([s, m]) => `${subjNames[s]||s}: ${Math.round(m/60*10)/10}h`);
  el.innerHTML = lines.length ? `Today's sessions: ${pomoSession} Â· ` + lines.join(' Â· ') : `Sessions today: ${pomoSession}`;
}

// ========== F5: EXAM STRATEGY ==========
const examStrategy = {
  ict:      'Use correct terminology in every answer and name files exactly as instructed â€” marks are lost for wrong file formats and imprecise naming.',
  cs:       'Write pseudocode in Cambridge notation with DECLARE statements and proper indentation; show every trace table step with a ruler.',
  business: 'Use the company name and data from the case study in every answer â€” generic theory scores limited marks.',
  engfirst: 'Plan your composition for 5 minutes; open with something striking and vary sentence length throughout.',
  englit:   'Avoid plot summary â€” analyse language choices and link technique â†’ effect â†’ theme in every paragraph.',
  science:  'Show all working for calculations even if the final answer is wrong; method marks are available.',
  addmath:  'Show all algebraic steps â€” unsupported calculator answers score zero; leave answers in exact form on Paper 1.',
  gp:       'Focus on skills not content â€” always give reasoned judgements with evidence from the sources provided.'
};

// ========== F1: STREAK TRACKING ==========
const STREAK_KEY = 'igcse-streak';

function getTodayKey() {
  return new Date().toISOString().slice(0, 10);
}

function recordActivity(mins) {
  const data = JSON.parse(localStorage.getItem(STREAK_KEY) || '{}');
  const today = getTodayKey();
  if (!data[today]) data[today] = { minutes: 0, actions: 0 };
  data[today].minutes += mins;
  data[today].actions += 1;
  localStorage.setItem(STREAK_KEY, JSON.stringify(data));
  renderStreak();
}

function renderStreak() {
  const gridEl = document.getElementById('streakGrid');
  const statsEl = document.getElementById('streakStats');
  if (!gridEl || !statsEl) return;
  const data = JSON.parse(localStorage.getItem(STREAK_KEY) || '{}');
  const todayKey = getTodayKey();

  // Build 84-day window (12 weeks), starting from the Monday 12 weeks ago
  const today = new Date();
  const dow = today.getDay(); // 0=Sun
  const daysToMonday = dow === 0 ? 6 : dow - 1;
  const startDate = new Date(today);
  startDate.setDate(startDate.getDate() - daysToMonday - 77);
  const days = [];
  for (let i = 0; i < 84; i++) {
    const d = new Date(startDate);
    d.setDate(startDate.getDate() + i);
    days.push(d.toISOString().slice(0, 10));
  }

  // Current streak (consecutive days back from today)
  let currentStreak = 0;
  for (let i = 0; i < 365; i++) {
    const d = new Date(today);
    d.setDate(d.getDate() - i);
    const k = d.toISOString().slice(0, 10);
    if (data[k] && data[k].actions > 0) {
      currentStreak++;
    } else {
      if (i > 0) break;
    }
  }

  // Longest streak
  const allActive = Object.keys(data).filter(k => data[k].actions > 0).sort();
  let longest = 0, runLen = 0, prevD = null;
  allActive.forEach(k => {
    const d = new Date(k + 'T00:00:00');
    if (prevD) {
      const diff = Math.round((d - prevD) / 86400000);
      runLen = diff === 1 ? runLen + 1 : 1;
    } else { runLen = 1; }
    longest = Math.max(longest, runLen);
    prevD = d;
  });

  const activeDays = Object.keys(data).filter(k => data[k] && data[k].actions > 0).length;
  statsEl.innerHTML = `
    <div class="streak-stat"><div class="ss-val">${currentStreak}</div><div class="ss-lbl">Current Streak</div></div>
    <div class="streak-stat"><div class="ss-val">${longest}</div><div class="ss-lbl">Longest Streak</div></div>
    <div class="streak-stat"><div class="ss-val">${activeDays}</div><div class="ss-lbl">Active Days</div></div>`;

  gridEl.innerHTML = days.map(k => {
    const a = data[k] ? data[k].actions : 0;
    let lvl = 0;
    if (a >= 1 && a <= 2) lvl = 1;
    else if (a >= 3 && a <= 5) lvl = 2;
    else if (a >= 6 && a <= 9) lvl = 3;
    else if (a >= 10) lvl = 4;
    const isToday = k === todayKey;
    const isFuture = k > todayKey;
    if (isFuture) return `<div class="streak-cell" style="opacity:0.2" title="${k}"></div>`;
    return `<div class="streak-cell${lvl ? ' l'+lvl : ''}${isToday ? ' today' : ''}" title="${k}: ${a} actions"></div>`;
  }).join('');
}

// ========== F2: SYNC TOPIC CONFIDENCE ==========
function syncTopicConfidence() {
  const sr = getSRData();
  const allCards = getFlashcards('all');
  const byNote = {};
  allCards.forEach(card => {
    const noteKey = card.id.replace(/-[dmf]\d+$/, '');
    if (!byNote[noteKey]) byNote[noteKey] = [];
    byNote[noteKey].push(card);
  });
  const topicState = getTopicState();
  Object.entries(byNote).forEach(([noteKey, cards]) => {
    const tdKey = noteKey.replace(/-\d+$/, '');
    const numMatch = noteKey.match(/-(\d+)$/);
    if (!numMatch || !topicData[tdKey]) return;
    const num = numMatch[1];
    const entry = topicData[tdKey].find(([n]) => String(n) === num || String(n).replace(/^[A-Za-z]+/, '') === num);
    if (!entry) return;
    const key = tdKey + '-' + num + '-' + entry[1].substring(0, 10);
    const reviewed = cards.filter(c => sr[c.id] !== undefined);
    if (reviewed.length === 0) return;
    const passedLast = cards.filter(c => sr[c.id] && sr[c.id].lastPassed === true);
    const newState = passedLast.length === cards.length ? 2 : 1;
    if (newState > (topicState[key] || 0)) topicState[key] = newState;
  });
  localStorage.setItem('igcse-topics', JSON.stringify(topicState));
  renderConfidenceBars();
}

// ========== F3: MOCK EXAM MODE ==========
let mockMode = false, mockQueue = [], mockIndex = 0, mockResults = [], mockTimerInterval = null;

function startMockExam() {
  const all = getFlashcards('all');
  const sr = getSRData();
  const now = Date.now();
  const due = all.filter(c => { const d = sr[c.id]; return !d || d.next <= now; });
  const rest = all.filter(c => { const d = sr[c.id]; return d && d.next > now; });
  const shuffle = a => [...a].sort(() => Math.random() - 0.5);
  mockQueue = shuffle(due).concat(shuffle(rest)).slice(0, 20);
  if (mockQueue.length === 0) { alert('No flashcards available. Add some notes first.'); return; }
  mockIndex = 0;
  mockResults = [];
  mockMode = true;
  showMockCard();
}

function showMockCard() {
  clearInterval(mockTimerInterval);
  const card = mockQueue[mockIndex];
  if (!card) { showMockResults(); return; }
  let timeLeft = 30;

  // Build mock UI replacing #fcDeck contents
  const deckEl = document.getElementById('fcDeck');
  deckEl.innerHTML = `
    <div class="mock-header">
      <h4>ðŸ“ Mock Exam</h4>
      <div class="mock-progress">Card ${mockIndex + 1} of ${mockQueue.length}</div>
    </div>
    <div class="mock-timer-bar"><div class="mock-timer-fill" id="mockTimerFill" style="width:100%"></div></div>
    <div class="fc-card" id="fcCard" onclick="flipCard()" style="cursor:pointer">
      <div class="fc-inner" id="fcInner">
        <div class="fc-front" id="fcFront"></div>
        <div class="fc-back" id="fcBack"></div>
      </div>
    </div>
    <div class="mock-btns">
      <button class="btn-rate fail" onclick="mockAnswer(false)">âœ— Don't know</button>
      <button class="btn-rate pass" onclick="mockAnswer(true)">âœ“ Know it</button>
    </div>`;

  // Render card faces
  const typeBadge = card.type === 'def' ? 'fc-type-def' : card.type === 'formula' ? 'fc-type-formula' : 'fc-type-fact';
  const typeLabel = card.type === 'def' ? 'Definition' : card.type === 'formula' ? 'Formula' : 'Key Fact';
  document.getElementById('fcFront').innerHTML = `
    <span class="fc-type-badge ${typeBadge}">${typeLabel}</span>
    <div class="fc-topic-label">${card.topicName}</div>
    <div class="fc-question-text">${card.question}</div>
    <div class="fc-tap-hint">Tap to reveal</div>`;
  const answerHtml = card.type === 'formula'
    ? `<code class="fc-answer-formula">${card.answer}</code>`
    : `<div class="fc-answer-content">${card.answer}</div>`;
  document.getElementById('fcBack').innerHTML = `
    <span class="fc-type-badge ${typeBadge}">${typeLabel}</span>
    <div class="fc-topic-label">${card.topicName}</div>
    <div class="fc-back-label">Answer</div>
    ${answerHtml}`;
  document.getElementById('fcInner').classList.remove('flipped');

  // Start 30s countdown
  const fillEl = document.getElementById('mockTimerFill');
  mockTimerInterval = setInterval(() => {
    timeLeft--;
    if (fillEl) fillEl.style.width = Math.max(0, (timeLeft / 30) * 100) + '%';
    if (timeLeft <= 0) {
      clearInterval(mockTimerInterval);
      mockAnswer(false); // auto-fail on timeout
    }
  }, 1000);
}

function mockAnswer(passed) {
  clearInterval(mockTimerInterval);
  const card = mockQueue[mockIndex];
  mockResults.push({ card, passed });
  updateSR(card.id, passed);
  recordActivity(0);
  mockIndex++;
  if (mockIndex < mockQueue.length) {
    showMockCard();
  } else {
    showMockResults();
  }
}

function showMockResults() {
  mockMode = false;
  const correct = mockResults.filter(r => r.passed).length;
  const total = mockResults.length;
  const pct = Math.round((correct / total) * 100);

  // Breakdown by type
  const byType = { def: [0,0], formula: [0,0], fact: [0,0] };
  mockResults.forEach(r => {
    const t = r.card.type;
    byType[t][0] += r.passed ? 1 : 0;
    byType[t][1]++;
  });
  const typeRows = Object.entries(byType).filter(([,v]) => v[1] > 0).map(([t,[c,tot]]) =>
    `<tr><td>${t === 'def' ? 'Definitions' : t === 'formula' ? 'Formulae' : 'Key Facts'}</td><td>${c}/${tot}</td><td>${Math.round(c/tot*100)}%</td></tr>`).join('');

  // Save to mock log
  const log = JSON.parse(localStorage.getItem('igcse-mock-log') || '[]');
  log.push({ date: new Date().toISOString(), total, correct, pct, breakdown: { def: byType.def, formula: byType.formula, fact: byType.fact } });
  localStorage.setItem('igcse-mock-log', JSON.stringify(log));

  const deckEl = document.getElementById('fcDeck');
  deckEl.innerHTML = `
    <div class="mock-results">
      <h4>Mock Exam Complete</h4>
      <div class="mock-score-big">${correct}/${total}</div>
      <div style="font-size:16px;color:var(--text2);margin-bottom:8px">${pct}%</div>
      <table class="mock-breakdown">
        <tr><th>Type</th><th>Score</th><th>%</th></tr>
        ${typeRows}
      </table>
      <button class="btn-eb-primary" onclick="endMockExam()" style="margin-top:8px">Back to Flashcards</button>
    </div>`;
}

function endMockExam() {
  mockMode = false;
  initFlashcards();
  renderReviewQueue();
}

// ========== F4: EXAM DAY BRIEFING ==========
function renderTracker() {
  const grid = document.getElementById('trackerGrid');
  const now = new Date();
  grid.innerHTML = Object.keys(subjects).map(key => {
    const s = subjects[key];
    const examsHtml = s.exams.map((ex, exIdx) => {
      let badgeHtml = '';
      if (ex.iso) {
        const examDate = new Date(ex.iso + 'T00:00:00');
        const daysLeft = Math.ceil((examDate - now) / (1000*60*60*24));
        let badgeClass = daysLeft <= 0 ? 'done' : daysLeft < 60 ? 'urgent' : daysLeft < 90 ? 'soon' : 'ok';
        badgeHtml = daysLeft <= 0
          ? '<span class="days-badge done">Done</span>'
          : `<span class="days-badge ${badgeClass}">${daysLeft}d</span>`;
      } else {
        badgeHtml = '<span class="days-badge ok" style="opacity:0.5">CW</span>';
      }
      return `<div class="tracker-exam" onclick="openExamBriefing('${key}',${exIdx})">
        <div>
          <div style="font-weight:500">${ex.paper}</div>
          <div class="te-date">${ex.date} Â· ${ex.session} Â· ${ex.duration}${ex.code !== 'â€”' ? ' Â· <span style="opacity:0.6">' + ex.code + '</span>' : ''}</div>
        </div>
        ${badgeHtml}
      </div>`;
    }).join('');
    return `<div class="tracker-subject">
      <div class="ts-name">${s.name}</div>
      <div class="ts-code">${s.code}</div>
      ${examsHtml}
    </div>`;
  }).join('');
}

function openExamBriefing(subjKey, examIdx) {
  const s = subjects[subjKey];
  const ex = s.exams[examIdx];
  const topicState = getTopicState();
  const listIds = subjectTopics[subjKey] || [];

  // Collect all topics for this subject, sorted by state (weakest first)
  const allTopics = [];
  listIds.forEach(lid => {
    (topicData[lid] || []).forEach(([num, name]) => {
      const k = lid + '-' + num + '-' + name.substring(0, 10);
      allTopics.push({ name, state: topicState[k] || 0 });
    });
  });
  allTopics.sort((a, b) => a.state - b.state);
  const weakest = allTopics.slice(0, 5);

  const weakChips = weakest.length
    ? weakest.map(t => `<span class="eb-chip ${t.state === 0 ? 'weak' : 'amber'}">${t.name}</span>`).join('')
    : '<span style="color:var(--text3);font-size:13px">No topics found â€” open the subject to check them off.</span>';

  // Collect formulae
  const formulae = [];
  listIds.forEach(lid => {
    (topicData[lid] || []).forEach(([num]) => {
      const nk = lid + '-' + num;
      const notes = topicNotes[nk] || topicNotes[lid.replace('-topics','') + '-topics-' + num] || null;
      if (notes && notes.formulae) formulae.push(...notes.formulae);
    });
  });
  const formulaeHtml = formulae.length
    ? formulae.slice(0, 8).map(f => `<span class="eb-formula">${f}</span>`).join('')
    : '<span style="color:var(--text3);font-size:13px">No formulae in notes for this subject.</span>';

  const strategy = examStrategy[subjKey] || 'Read each question carefully and manage your time across all parts.';

  document.getElementById('ebContent').innerHTML = `
    <div class="eb-subject">${s.code} Â· ${ex.session}</div>
    <div class="eb-title">${s.name} â€” ${ex.paper}</div>
    <div class="eb-meta">${ex.date} Â· ${ex.duration}</div>
    <div class="eb-section">
      <div class="eb-section-label">Weakest Topics (revise these first)</div>
      <div class="eb-chips">${weakChips}</div>
    </div>
    <div class="eb-section">
      <div class="eb-section-label">Key Formulae</div>
      <div>${formulaeHtml}</div>
    </div>
    <div class="eb-section">
      <div class="eb-section-label">Exam Strategy</div>
      <div class="eb-strategy">${strategy}</div>
    </div>
    <div class="eb-actions">
      <button class="btn-eb-primary" onclick="navigateTo('${subjKey}');closeExamBriefing()">Start Focused Review</button>
      <button class="btn-secondary" onclick="closeExamBriefing()">Close</button>
    </div>`;

  document.getElementById('examBriefing').classList.remove('hidden');
}

function closeExamBriefing() {
  document.getElementById('examBriefing').classList.add('hidden');
}

function closeExamBriefingOverlay(e) {
  if (e.target === document.getElementById('examBriefing')) closeExamBriefing();
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closeExamBriefing(); });

// ========== F5: PAST PAPER LOG ==========
function getPaperLog() { return JSON.parse(localStorage.getItem('igcse-paper-log') || '[]'); }
function savePaperLog(d) { localStorage.setItem('igcse-paper-log', JSON.stringify(d)); }

function sparkline(vals) {
  if (vals.length < 2) return '';
  const w = 60, h = 20, pad = 2;
  const min = Math.min(...vals), max = Math.max(...vals);
  const range = max - min || 1;
  const pts = vals.map((v, i) => {
    const x = pad + (i / (vals.length - 1)) * (w - pad * 2);
    const y = h - pad - ((v - min) / range) * (h - pad * 2);
    return `${x.toFixed(1)},${y.toFixed(1)}`;
  }).join(' ');
  return `<svg width="${w}" height="${h}" viewBox="0 0 ${w} ${h}" style="vertical-align:middle">
    <polyline points="${pts}" fill="none" stroke="var(--accent)" stroke-width="1.5" stroke-linejoin="round"/>
    ${vals.map((v, i) => {
      const x = pad + (i / (vals.length - 1)) * (w - pad * 2);
      const y = h - pad - ((v - min) / range) * (h - pad * 2);
      return `<circle cx="${x.toFixed(1)}" cy="${y.toFixed(1)}" r="2" fill="var(--accent)"/>`;
    }).join('')}
  </svg>`;
}

function renderPaperLog(subj) {
  const panelIds = { ict:'ict-paperlog', cs:'cs-paperlog', business:'bus-paperlog',
    engfirst:'ef-paperlog', englit:'el-paperlog', science:'sci-paperlog',
    addmath:'am-paperlog', gp:'gp-paperlog' };
  const el = document.getElementById(panelIds[subj]);
  if (!el) return;
  const papers = (paperOptions[subj] || []).map(p => `<option value="${p.label}" data-max="${p.max}">${p.label}</option>`).join('');
  const log = getPaperLog().filter(e => e.subj === subj);

  // Group by paper for sparklines
  const byPaper = {};
  log.forEach(e => { (byPaper[e.paper] = byPaper[e.paper] || []).push(e); });

  const rows = log.length ? log.map((e, i) => {
    const pct = Math.round((e.score / e.max) * 100);
    const cls = pct >= 70 ? 'good' : pct >= 50 ? 'ok' : 'low';
    const paperHistory = byPaper[e.paper] || [];
    const trendSvg = paperHistory.length >= 3 && paperHistory[paperHistory.length - 1] === e
      ? sparkline(paperHistory.map(h => Math.round(h.score / h.max * 100))) : '';
    return `<tr>
      <td>${e.year || 'â€”'}</td>
      <td style="max-width:200px">${e.paper}</td>
      <td>${e.score}/${e.max}</td>
      <td><span class="pct ${cls}">${pct}%</span></td>
      <td>${e.date || 'â€”'}</td>
      <td>${trendSvg}</td>
      <td><button class="del-btn score-table" onclick="deletePaperAttempt(${getPaperLog().indexOf(e)})" title="Delete">Ã—</button></td>
    </tr>`;
  }).join('') : `<tr><td colspan="7" class="pl-empty">No attempts logged yet for ${subjNames[subj] || subj}.</td></tr>`;

  el.innerHTML = `
    <h3>Paper Log â€” ${subjNames[subj] || subj}</h3>
    <div class="pl-form">
      <label>Year<input id="pl-year-${subj}" type="text" placeholder="2024"></label>
      <label>Paper<select id="pl-paper-${subj}" onchange="document.getElementById('pl-max-${subj}').value=this.options[this.selectedIndex].dataset.max">${papers}</select></label>
      <label>Score<input id="pl-score-${subj}" type="number" min="0" placeholder="62"></label>
      <label>Out of<input id="pl-max-${subj}" type="number" min="1" placeholder="80" value="${(paperOptions[subj]||[])[0]?.max||''}"></label>
      <button class="btn-pl-log" onclick="logPaperAttempt('${subj}')">Log Attempt</button>
    </div>
    <table class="pl-table">
      <tr><th>Year</th><th>Paper</th><th>Score</th><th>%</th><th>Date</th><th>Trend</th><th></th></tr>
      ${rows}
    </table>`;

  // Set initial max from first paper option
  const paperSel = document.getElementById(`pl-paper-${subj}`);
  const maxInp = document.getElementById(`pl-max-${subj}`);
  if (paperSel && maxInp) maxInp.value = paperSel.options[paperSel.selectedIndex]?.dataset.max || '';
}

function logPaperAttempt(subj) {
  const year  = document.getElementById(`pl-year-${subj}`)?.value.trim();
  const paper = document.getElementById(`pl-paper-${subj}`)?.value;
  const score = parseFloat(document.getElementById(`pl-score-${subj}`)?.value);
  const max   = parseFloat(document.getElementById(`pl-max-${subj}`)?.value);
  if (!paper || isNaN(score) || isNaN(max) || max <= 0) { alert('Please fill in Score and Out of fields.'); return; }
  const log = getPaperLog();
  log.push({ subj, paper, year, score, max, date: new Date().toLocaleDateString() });
  savePaperLog(log);
  renderPaperLog(subj);
}

function deletePaperAttempt(idx) {
  const log = getPaperLog();
  log.splice(idx, 1);
  savePaperLog(log);
  // Re-render the visible paper log panel
  const panels = ['ict','cs','business','engfirst','englit','science','addmath','gp'];
  panels.forEach(s => {
    const panelIds = { ict:'ict-paperlog', cs:'cs-paperlog', business:'bus-paperlog',
      engfirst:'ef-paperlog', englit:'el-paperlog', science:'sci-paperlog',
      addmath:'am-paperlog', gp:'gp-paperlog' };
    const el = document.getElementById(panelIds[s]);
    if (el && el.classList.contains('active')) renderPaperLog(s);
  });
}

// ========== F6: PER-TOPIC PERSONAL NOTES ==========
function getUserNotes() { return JSON.parse(localStorage.getItem('igcse-topic-notes') || '{}'); }
function saveUserNotes(d) { localStorage.setItem('igcse-topic-notes', JSON.stringify(d)); }

let noteDebounceTimers = {};

function toggleTopicNote(btn, e) {
  e.stopPropagation();
  const key = btn.dataset.key;
  const safeKey = key.replace(/[^a-z0-9]/gi, '-');
  const area = document.getElementById('una-' + safeKey);
  if (!area) return;
  area.classList.toggle('open');
  if (area.classList.contains('open')) area.focus();
}

function saveTopicNote(key, area) {
  clearTimeout(noteDebounceTimers[key]);
  noteDebounceTimers[key] = setTimeout(() => {
    const notes = getUserNotes();
    const val = area.value.trim();
    if (val) { notes[key] = area.value; } else { delete notes[key]; }
    saveUserNotes(notes);
    // Update button highlight
    const safeKey = key.replace(/[^a-z0-9]/gi, '-');
    const btn = document.querySelector(`.topic-note-btn[data-key="${CSS.escape(key)}"]`);
    if (btn) btn.classList.toggle('has-note', !!val);
  }, 500);
}

// ========== F7: PRINT REVISION SHEET ==========
function printRevisionSheet(subj) {
  const s = subjects[subj] || {};
  const name = subjNames[subj] || subj;
  const code = s.code || '';
  const examDates = (s.exams || []).map(e => `${e.paper}: ${e.date}`).join('<br>');
  const listIds = subjectTopics[subj] || [];
  const topicState = getTopicState();

  // Collect all notes for this subject
  const defs = [], formulae = [], facts = [], topicsList = [];
  listIds.forEach(lid => {
    (topicData[lid] || []).forEach(([num, topicName]) => {
      const nk1 = lid + '-' + num;
      const nk2 = lid.replace('-topics','') + '-topics-' + num;
      const notes = topicNotes[nk1] || topicNotes[nk2] || null;
      if (notes) {
        if (notes.defs) notes.defs.forEach(d => defs.push({ topic: topicName, text: d }));
        if (notes.formulae) notes.formulae.forEach(f => formulae.push({ topic: topicName, text: f }));
        if (notes.facts) notes.facts.forEach(f => facts.push({ topic: topicName, text: f }));
      }
      const key = lid + '-' + num + '-' + topicName.substring(0, 10);
      const state = topicState[key] || 0;
      topicsList.push({ num, name: topicName, state });
    });
  });

  const stateLabel = s => s === 2 ? 'âœ“' : s === 1 ? '~' : 'â—‹';
  const defsHtml = defs.length ? `<h2>Definitions</h2><table border="1" cellpadding="6" cellspacing="0" style="width:100%;border-collapse:collapse">
    <tr><th>Topic</th><th>Term &amp; Definition</th></tr>
    ${defs.map(d => `<tr><td style="width:30%">${d.topic}</td><td>${d.text}</td></tr>`).join('')}
    </table>` : '';

  const formulaeHtml = formulae.length ? `<h2>Formulae</h2><div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
    ${formulae.map(f => `<div style="padding:6px;border:1px solid #ccc;font-family:monospace;font-size:11pt">${f.text}</div>`).join('')}
    </div>` : '';

  const factsHtml = facts.length ? `<h2>Key Facts</h2><ul>
    ${facts.map(f => `<li><strong>${f.topic}:</strong> ${f.text}</li>`).join('')}
    </ul>` : '';

  const topicsHtml = topicsList.length ? `<h2>Topics Checklist</h2><table border="1" cellpadding="5" cellspacing="0" style="width:100%;border-collapse:collapse">
    <tr><th>#</th><th>Topic</th><th>Status</th></tr>
    ${topicsList.map(t => `<tr><td>${t.num}</td><td>${t.name}</td><td style="text-align:center">${stateLabel(t.state)}</td></tr>`).join('')}
    </table>` : '';

  const html = `<!DOCTYPE html><html><head><meta charset="UTF-8">
    <title>${name} Revision Sheet</title>
    <style>
      body { font-family: Georgia, serif; font-size: 11pt; color: #111; line-height: 1.5; margin: 20mm; }
      h1 { font-size: 20pt; margin-bottom: 4px; }
      h2 { font-size: 14pt; margin-top: 20px; margin-bottom: 8px; border-bottom: 1px solid #333; padding-bottom: 4px; }
      table { border-color: #aaa; }
      th { background: #eee; }
      ul { padding-left: 20px; }
      li { margin-bottom: 4px; }
      @media print { body { margin: 10mm; } }
    </style></head><body>
    <h1>${name} â€” Revision Sheet</h1>
    <p style="color:#555;font-size:10pt">Syllabus code: ${code} &nbsp;|&nbsp; Generated: ${new Date().toLocaleDateString()}</p>
    ${examDates ? `<p style="font-size:10pt"><strong>Exam dates:</strong><br>${examDates}</p>` : ''}
    ${defsHtml}${formulaeHtml}${factsHtml}${topicsHtml}
    </body></html>`;

  const win = window.open('', '_blank');
  if (!win) { alert('Pop-up blocked â€” please allow pop-ups for this page.'); return; }
  win.document.write(html);
  win.document.close();
  setTimeout(() => win.print(), 300);
}

// ========== ZONE PICKER ==========
function applyZone(z) {
  if (!zoneExams[z]) return;
  localStorage.setItem('igcse-zone', z);
  const ze = zoneExams[z];
  subjects.ict.exams = [...ICT_PRACTICALS, ...ze.ict];
  subjects.cs.exams = ze.cs;
  subjects.business.exams = ze.business;
  subjects.engfirst.exams = ze.engfirst;
  subjects.englit.exams = ze.englit;
  subjects.science.exams = ze.science;
  subjects.addmath.exams = ze.addmath;
  subjects.gp.exams = [...ze.gp, ...GP_COURSEWORK];
  const chip = document.getElementById('zoneChip');
  if (chip) chip.textContent = ZONE_INFO[z].label;
  const zoneLabel = document.getElementById('zoneLabel');
  if (zoneLabel) zoneLabel.textContent = `${ZONE_INFO[z].label} â€” ${ZONE_INFO[z].region} â–¾`;
  // Highlight selected option
  document.querySelectorAll('.zone-option').forEach(el => {
    el.classList.toggle('selected', el.getAttribute('onclick') === `applyZone('${z}')`);
  });
  renderTracker();
  document.getElementById('zoneModal').classList.add('hidden');
}
function initZone() {
  const saved = localStorage.getItem('igcse-zone');
  if (saved && zoneExams[saved]) {
    applyZone(saved);
  } else {
    document.getElementById('zoneModal').classList.remove('hidden');
  }
}
function closeZoneModalOverlay(e) {
  if (e.target === e.currentTarget && localStorage.getItem('igcse-zone')) {
    document.getElementById('zoneModal').classList.add('hidden');
  }
}

// ========== INIT NEW FEATURES ==========
renderGradeCalc();
renderFormulaSheet();
initFlashcards();
renderReviewQueue();
renderPomoStats();
renderStreak();
initZone();
</script>
</body>
</html>
